/*
@license
Webix Reports v.8.1.1
This software is covered by Webix Commercial License.
Usage without proper license is prohibited.
(c) XB Software Ltd.
*/
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).reports={})}(this,(function(t){"use strict";
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation.

    Permission to use, copy, modify, and/or distribute this software for any
    purpose with or without fee is hereby granted.

    THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
    REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
    AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
    INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
    LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
    OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
    PERFORMANCE OF THIS SOFTWARE.
    ***************************************************************************** */var e=function(t,i){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(t,i)};function i(t,i){function n(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}var n=function(){return(n=Object.assign||function(t){for(var e,i=1,n=arguments.length;i<n;i++)for(var r in e=arguments[i])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t}).apply(this,arguments)};function r(){for(var t=0,e=0,i=arguments.length;e<i;e++)t+=arguments[e].length;var n=Array(t),r=0;for(e=0;e<i;e++)for(var o=arguments[e],s=0,a=o.length;s<a;s++,r++)n[r]=o[s];return n}var o=function(){},s=function(){function t(t,e){this.webixJet=!0,this.webix=t,this._events=[],this._subs={},this._data={},e&&e.params&&t.extend(this._data,e.params)}return t.prototype.getRoot=function(){return this._root},t.prototype.destructor=function(){this._detachEvents(),this._destroySubs(),this._events=this._container=this.app=this._parent=this._root=null},t.prototype.setParam=function(t,e,i){if(this._data[t]!==e&&(this._data[t]=e,this._segment.update(t,e,0),i))return this.show(null)},t.prototype.getParam=function(t,e){var i=this._data[t];if(void 0!==i||!e)return i;var n=this.getParentView();return n?n.getParam(t,e):void 0},t.prototype.getUrl=function(){return this._segment.suburl()},t.prototype.getUrlString=function(){return this._segment.toString()},t.prototype.getParentView=function(){return this._parent},t.prototype.$$=function(t){if("string"==typeof t){var e=this.getRoot();return e.queryView((function(i){return(i.config.id===t||i.config.localId===t)&&i.$scope===e.$scope}),"self")}return t},t.prototype.on=function(t,e,i){var n=t.attachEvent(e,i);return this._events.push({obj:t,id:n}),n},t.prototype.contains=function(t){for(var e in this._subs){var i=this._subs[e].view;if(i===t||i.contains(t))return!0}return!1},t.prototype.getSubView=function(t){var e=this.getSubViewInfo(t);if(e)return e.subview.view},t.prototype.getSubViewInfo=function(t){var e=this._subs[t||"default"];return e?{subview:e,parent:this}:"_top"===t?(this._subs[t]={url:"",id:null,popup:!0},this.getSubViewInfo(t)):this._parent?this._parent.getSubViewInfo(t):null},t.prototype._detachEvents=function(){for(var t=this._events,e=t.length-1;e>=0;e--)t[e].obj.detachEvent(t[e].id)},t.prototype._destroySubs=function(){for(var t in this._subs){var e=this._subs[t].view;e&&e.destructor()}this._subs={}},t.prototype._init_url_data=function(){var t=this._segment.current();this._data={},this.webix.extend(this._data,t.params,!0)},t.prototype._getDefaultSub=function(){if(this._subs.default)return this._subs.default;for(var t in this._subs){var e=this._subs[t];if(!e.branch&&e.view&&"_top"!==t){var i=e.view._getDefaultSub();if(i)return i}}},t.prototype._routed_view=function(){var t=this.getParentView();if(!t)return!0;var e=t._getDefaultSub();return!(!e&&e!==this)&&t._routed_view()},t}();function a(t){"/"===t[0]&&(t=t.substr(1));for(var e=t.split("/"),i=[],n=0;n<e.length;n++){var r=e[n],o={},s=r.indexOf(":");if(-1===s&&(s=r.indexOf("?")),-1!==s)for(var a=0,u=r.substr(s+1).split(/[\:\?\&]/g);a<u.length;a++){var l=u[a].split("=");o[l[0]]=decodeURIComponent(l[1])}i[n]={page:s>-1?r.substr(0,s):r,params:o,isNew:!0}}return i}function u(t){for(var e=[],i=0,n=t;i<n.length;i++){var r=n[i];e.push("/"+r.page);var o=l(r.params);o&&e.push("?"+o)}return e.join("")}function l(t){var e=[];for(var i in t)"object"!=typeof t[i]&&(e.length&&e.push("&"),e.push(i+"="+encodeURIComponent(t[i])));return e.join("")}var c=function(){function t(t,e){this._next=1,this.route="string"==typeof t?{url:a(t),path:t}:t,this.index=e}return t.prototype.current=function(){return this.route.url[this.index]},t.prototype.next=function(){return this.route.url[this.index+this._next]},t.prototype.suburl=function(){return this.route.url.slice(this.index)},t.prototype.shift=function(e){var i=new t(this.route,this.index+this._next);return i.setParams(i.route.url,e,i.index),i},t.prototype.setParams=function(t,e,i){if(e){var n=t[i].params;for(var r in e)n[r]=e[r]}},t.prototype.refresh=function(){for(var t=this.route.url,e=this.index+1;e<t.length;e++)t[e].isNew=!0},t.prototype.toString=function(){var t=u(this.suburl());return t?t.substr(1):""},t.prototype._join=function(t,e){var i=this.route.url;if(null===t)return i;var n=this.route.url,r=!0;if(i=n.slice(0,this.index+(e?this._next:0)),t){i=i.concat(a(t));for(var o=0;o<i.length;o++)n[o]&&(i[o].view=n[o].view),r&&n[o]&&i[o].page===n[o].page?i[o].isNew=!1:i[o].isNew&&(r=!1)}return i},t.prototype.append=function(t){var e=this._join(t,!0);return this.route.path=u(e),this.route.url=e,this.route.path},t.prototype.show=function(t,e,i){var n=this,r=this._join(t.url,i);return this.setParams(r,t.params,this.index+(i?this._next:0)),new Promise((function(t,i){var s=u(r),a={url:r,redirect:s,confirm:Promise.resolve()},l=e?e.app:null;if(l&&!l.callEvent("app:guard",[a.redirect,e,a]))return void i(new o);a.confirm.catch((function(t){return i(t)})).then((function(){if(null!==a.redirect){if(a.redirect!==s)return l.show(a.redirect),void i(new o);n.route.path=s,n.route.url=r,t()}else i(new o)}))}))},t.prototype.size=function(t){this._next=t},t.prototype.split=function(){var e={url:this.route.url.slice(this.index+1),path:""};return e.url.length&&(e.path=u(e.url)),new t(e,0)},t.prototype.update=function(t,e,i){var n=this.route.url[this.index+(i||0)];if(!n)return this.route.url.push({page:"",params:{}}),this.update(t,e,i);""===t?n.page=e:n.params[t]=e,this.route.path=u(this.route.url)},t}(),p=function(t){function e(e,i){var n=t.call(this,e.webix)||this;return n.app=e,n._children=[],n}return i(e,t),e.prototype.ui=function(t,e){var i=(e=e||{}).container||t.container,n=this.app.createView(t);return this._children.push(n),n.render(i,this._segment,this),"object"!=typeof t||t instanceof s?n:n.getRoot()},e.prototype.show=function(t,e){if(e=e||{},"object"==typeof t){for(var i in t)this.setParam(i,t[i]);t=null}else{if("/"===t.substr(0,1))return this.app.show(t,e);if(0===t.indexOf("./")&&(t=t.substr(2)),0===t.indexOf("../")){var n=this.getParentView();return n?n.show(t.substr(3),e):this.app.show("/"+t.substr(3))}var r=this.getSubViewInfo(e.target);if(r){if(r.parent!==this)return r.parent.show(t,e);if(e.target&&"default"!==e.target)return this._renderFrameLock(e.target,r.subview,{url:t,params:e.params})}else if(t)return this.app.show("/"+t,e)}return this._show(this._segment,{url:t,params:e.params},this)},e.prototype._show=function(t,e,i){var n=this;return t.show(e,i,!0).then((function(){return n._init_url_data(),n._urlChange()})).then((function(){t.route.linkRouter&&(n.app.getRouter().set(t.route.path,{silent:!0}),n.app.callEvent("app:route",[t.route.path]))}))},e.prototype.init=function(t,e){},e.prototype.ready=function(t,e){},e.prototype.config=function(){this.app.webix.message("View:Config is not implemented")},e.prototype.urlChange=function(t,e){},e.prototype.destroy=function(){},e.prototype.destructor=function(){this.destroy(),this._destroyKids(),this._root&&(this._root.destructor(),t.prototype.destructor.call(this))},e.prototype.use=function(t,e){t(this.app,this,e)},e.prototype.refresh=function(){this.getUrl();return this.destroy(),this._destroyKids(),this._destroySubs(),this._detachEvents(),this._container.tagName&&this._root.destructor(),this._segment.refresh(),this._render(this._segment)},e.prototype.render=function(t,e,i){var n=this;"string"==typeof e&&(e=new c(e,0)),this._segment=e,this._parent=i,this._init_url_data();var r="string"==typeof(t=t||document.body)?this.webix.toNode(t):t;return this._container!==r?(this._container=r,this._render(e)):this._urlChange().then((function(){return n.getRoot()}))},e.prototype._render=function(t){var e=this,i=this.config();return i.then?i.then((function(i){return e._render_final(i,t)})):this._render_final(i,t)},e.prototype._render_final=function(t,e){var i,n=this,r=null,o=null,s=!1;if(this._container.tagName?o=this._container:(r=this._container).popup?(o=document.body,s=!0):o=this.webix.$$(r.id),!this.app||!o)return Promise.reject(null);var a=this._segment.current(),u={ui:{}};this.app.copyConfig(t,u.ui,this._subs),this.app.callEvent("app:render",[this,e,u]),u.ui.$scope=this,!r&&a.isNew&&a.view&&a.view.destructor();try{if(r&&!s){var l=o,c=l.getParentView();c&&"multiview"===c.name&&!u.ui.id&&(u.ui.id=l.config.id)}this._root=this.app.webix.ui(u.ui,o);var p=this._root;s&&p.setPosition&&!p.isVisible()&&p.show(),r&&(r.view&&r.view!==this&&r.view!==this.app&&r.view.destructor(),r.id=this._root.config.id,this.getParentView()||!this.app.app?r.view=this:r.view=this.app),a.isNew&&(a.view=this,a.isNew=!1),i=Promise.resolve(this._init(this._root,e)).then((function(){return n._urlChange().then((function(){return n._initUrl=null,n.ready(n._root,e.suburl())}))}))}catch(t){i=Promise.reject(t)}return i.catch((function(t){return n._initError(n,t)}))},e.prototype._init=function(t,e){return this.init(t,e.suburl())},e.prototype._urlChange=function(){var t=this;this.app.callEvent("app:urlchange",[this,this._segment]);var e=[];for(var i in this._subs){var n=this._subs[i],r=this._renderFrameLock(i,n,null);r&&e.push(r)}return Promise.all(e).then((function(){return t.urlChange(t._root,t._segment.suburl())}))},e.prototype._renderFrameLock=function(t,e,i){if(!e.lock){var n=this._renderFrame(t,e,i);n&&(e.lock=n.then((function(){return e.lock=null}),(function(){return e.lock=null})))}return e.lock},e.prototype._renderFrame=function(t,e,i){var n=this;if("default"===t){if(this._segment.next()){var r=i?i.params:null;return e.params&&(r=this.webix.extend(r||{},e.params)),this._createSubView(e,this._segment.shift(r))}e.view&&e.popup&&(e.view.destructor(),e.view=null)}if(null!==i&&(e.url=i.url,e.params&&(i.params=this.webix.extend(i.params||{},e.params))),e.route){if(null!==i)return e.route.show(i,e.view).then((function(){return n._createSubView(e,e.route)}));if(e.branch)return}var o=e.view;if(!o&&e.url){if("string"==typeof e.url)return e.route=new c(e.url,0),i&&e.route.setParams(e.route.route.url,i.params,0),e.params&&e.route.setParams(e.route.route.url,e.params,0),this._createSubView(e,e.route);"function"!=typeof e.url||o instanceof e.url||(o=new(this.app._override(e.url))(this.app,"")),o||(o=e.url)}if(o)return o.render(e,e.route||this._segment,this)},e.prototype._initError=function(t,e){return this.app&&this.app.error("app:error:initview",[e,t]),!0},e.prototype._createSubView=function(t,e){var i=this;return this.app.createFromURL(e.current()).then((function(n){return n.render(t,e,i)}))},e.prototype._destroyKids=function(){for(var t=this._children,e=t.length-1;e>=0;e--)t[e]&&t[e].destructor&&t[e].destructor();this._children=[]},e}(s),h=function(t){function e(e,i){var n=t.call(this,e,i)||this;return n._ui=i.ui,n}return i(e,t),e.prototype.config=function(){return this._ui},e}(p),f=function(){function t(t,e,i){this.path="",this.app=i}return t.prototype.set=function(t,e){this.path=t;var i=this.app;i.app.getRouter().set(i._segment.append(this.path),{silent:!0})},t.prototype.get=function(){return this.path},t}(),d=!0,v=function(t){function e(e){var i=this,n=(e||{}).webix||window.webix;return e=n.extend({name:"App",version:"1.0",start:"/home"},e,!0),(i=t.call(this,n,e)||this).config=e,i.app=i.config.app,i.ready=Promise.resolve(),i._services={},i.webix.extend(i,i.webix.EventSystem),i}return i(e,t),e.prototype.getUrl=function(){return this._subSegment.suburl()},e.prototype.getUrlString=function(){return this._subSegment.toString()},e.prototype.getService=function(t){var e=this._services[t];return"function"==typeof e&&(e=this._services[t]=e(this)),e},e.prototype.setService=function(t,e){this._services[t]=e},e.prototype.destructor=function(){this.getSubView().destructor(),t.prototype.destructor.call(this)},e.prototype.copyConfig=function(t,e,i){if((t instanceof s||"function"==typeof t&&t.prototype instanceof s)&&(t={$subview:t}),void 0!==t.$subview)return this.addSubView(t,e,i);var n=t instanceof Array;for(var r in e=e||(n?[]:{}),t){var o=t[r];if("function"==typeof o&&o.prototype instanceof s&&(o={$subview:o}),!o||"object"!=typeof o||o instanceof this.webix.DataCollection||o instanceof RegExp||o instanceof Map)e[r]=o;else if(o instanceof Date)e[r]=new Date(o);else{var a=this.copyConfig(o,o instanceof Array?[]:{},i);null!==a&&(n?e.push(a):e[r]=a)}}return e},e.prototype.getRouter=function(){return this.$router},e.prototype.clickHandler=function(t,e){if(t&&(e=e||t.target||t.srcElement)&&e.getAttribute){var i=e.getAttribute("trigger");if(i)return this._forView(e,(function(t){return t.app.trigger(i)})),t.cancelBubble=!0,t.preventDefault();var n=e.getAttribute("route");if(n)return this._forView(e,(function(t){return t.show(n)})),t.cancelBubble=!0,t.preventDefault()}var r=e.parentNode;r&&this.clickHandler(t,r)},e.prototype.getRoot=function(){return this.getSubView().getRoot()},e.prototype.refresh=function(){var t=this;return this._subSegment?this.getSubView().refresh().then((function(e){return t.callEvent("app:route",[t.getUrl()]),e})):Promise.resolve(null)},e.prototype.loadView=function(t){var e=this,i=this.config.views,n=null;if(""===t)return Promise.resolve(this._loadError("",new Error("Webix Jet: Empty url segment")));try{i&&"string"==typeof(n="function"==typeof i?i(t):i[t])&&(t=n,n=null),n||("_hidden"===t?n={hidden:!0}:"_blank"===t?n={}:(t=t.replace(/\./g,"/"),n=this.require("jet-views",t)))}catch(e){n=this._loadError(t,e)}return n.then||(n=Promise.resolve(n)),n=n.then((function(t){return t.__esModule?t.default:t})).catch((function(i){return e._loadError(t,i)}))},e.prototype._forView=function(t,e){var i=this.webix.$$(t);i&&e(i.$scope)},e.prototype._loadViewDynamic=function(t){return null},e.prototype.createFromURL=function(t){var e=this;return t.isNew||!t.view?this.loadView(t.page).then((function(i){return e.createView(i,name,t.params)})):Promise.resolve(t.view)},e.prototype._override=function(t){var e=this.config.override;if(e){for(var i=void 0;t;)i=t,t=e.get(t);return i}return t},e.prototype.createView=function(t,i,n){if("function"==typeof(t=this._override(t))){if(t.prototype instanceof e)return new t({app:this,name:i,params:n,router:f});if(t.prototype instanceof s)return new t(this,{name:i,params:n});t=t(this)}return t instanceof s?t:new h(this,{name:i,ui:t})},e.prototype.show=function(t,e){return t&&this.app&&0==t.indexOf("//")?this.app.show(t.substr(1),e):this.render(this._container,t||this.config.start,e)},e.prototype.trigger=function(t){for(var e=[],i=1;i<arguments.length;i++)e[i-1]=arguments[i];this.apply(t,e)},e.prototype.apply=function(t,e){this.callEvent(t,e)},e.prototype.action=function(t){return this.webix.bind((function(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];this.apply(t,e)}),this)},e.prototype.on=function(t,e){this.attachEvent(t,e)},e.prototype.use=function(t,e){t(this,null,e)},e.prototype.error=function(t,e){if(this.callEvent(t,e),this.callEvent("app:error",e),this.config.debug)for(var i=0;i<e.length;i++)if(console.error(e[i]),e[i]instanceof Error){var n=e[i].message;0===n.indexOf("Module build failed")?(n=n.replace(/\x1b\[[0-9;]*m/g,""),document.body.innerHTML="<pre style='font-size:16px; background-color: #ec6873; color: #000; padding:10px;'>"+n+"</pre>"):(n+="<br><br>Check console for more details",this.webix.message({type:"error",text:n,expire:-1}))}},e.prototype.render=function(t,e,i){var n=this;this._container="string"==typeof t?this.webix.toNode(t):t||document.body;var r=null;!this.$router?(d&&"tagName"in this._container&&(this.webix.event(document.body,"click",(function(t){return n.clickHandler(t)})),d=!1),"string"==typeof e&&(e=new c(e,0)),this._subSegment=this._first_start(e),this._subSegment.route.linkRouter=!0):r="string"==typeof e?e:this.app?e.split().route.path||this.config.start:e.toString();var o=i?i.params:this.config.params||null,s=this.getSubView(),a=this._subSegment,u=a.show({url:r,params:o},s).then((function(){return n.createFromURL(a.current())})).then((function(e){return e.render(t,a)})).then((function(t){return n.$router.set(a.route.path,{silent:!0}),n.callEvent("app:route",[n.getUrl()]),t}));return this.ready=this.ready.then((function(){return u})),u},e.prototype.getSubView=function(){if(this._subSegment){var t=this._subSegment.current().view;if(t)return t}return new p(this,{})},e.prototype.require=function(t,e){return null},e.prototype._first_start=function(t){var e=this;this._segment=t;if(this.$router=new this.config.router((function(t){return setTimeout((function(){e.show(t).catch((function(t){if(!(t instanceof o))throw t}))}),1)}),this.config,this),this._container===document.body&&!1!==this.config.animation){var i=this._container;this.webix.html.addCss(i,"webixappstart"),setTimeout((function(){e.webix.html.removeCss(i,"webixappstart"),e.webix.html.addCss(i,"webixapp")}),10)}if(t){if(this.app){var n=t.current().view;t.current().view=this,t.next()?(t.refresh(),t=t.split()):t=new c(this.config.start,0),t.current().view=n}}else{var r=this.$router.get();r||(r=this.config.start,this.$router.set(r,{silent:!0})),t=new c(r,0)}return t},e.prototype._loadError=function(t,e){return this.error("app:error:resolve",[e,t]),{template:" "}},e.prototype.addSubView=function(t,e,i){var n=!0!==t.$subview?t.$subview:null,r=t.name||(n?this.webix.uid():"default");return e.id=t.id||"s"+this.webix.uid(),(i[r]={id:e.id,url:n,branch:t.branch,popup:t.popup,params:t.params}).popup?null:e},e}(s),g=function(){function t(t,e){var i=this;this.config=e||{},this._detectPrefix(),this.cb=t,window.onpopstate=function(){return i.cb(i.get())}}return t.prototype.set=function(t,e){var i=this;if(this.config.routes){var n=t.split("?",2);for(var r in this.config.routes)if(this.config.routes[r]===n[0]){t=r+(n.length>1?"?"+n[1]:"");break}}this.get()!==t&&window.history.pushState(null,null,this.prefix+this.sufix+t),e&&e.silent||setTimeout((function(){return i.cb(t)}),1)},t.prototype.get=function(){var t=this._getRaw().replace(this.prefix,"").replace(this.sufix,"");if(t="/"!==t&&"#"!==t?t:"",this.config.routes){var e=t.split("?",2),i=this.config.routes[e[0]];i&&(t=i+(e.length>1?"?"+e[1]:""))}return t},t.prototype._detectPrefix=function(){var t=this.config.routerPrefix;this.sufix="#"+(void 0===t?"!":t),this.prefix=document.location.href.split("#",2)[0]},t.prototype._getRaw=function(){return document.location.href},t}(),m=!1;function y(t){if(!m&&t){m=!0;var e=window;e.Promise||(e.Promise=t.promise);var i=t.version.split(".");10*i[0]+1*i[1]<53&&(t.ui.freeze=function(e){var i=e();return i&&i.then?i.then((function(e){return t.ui.$freeze=!1,t.ui.resize(),e})):(t.ui.$freeze=!1,t.ui.resize()),i});var n=t.ui.baselayout.prototype.addView,r=t.ui.baselayout.prototype.removeView,o={addView:function(t,e){if(this.$scope&&this.$scope.webixJet&&!t.queryView){var i=this.$scope,r={};t=i.app.copyConfig(t,{},r),n.apply(this,[t,e]);var o=function(t){i._renderFrame(t,r[t],null).then((function(){i._subs[t]=r[t]}))};for(var s in r)o(s);return t.id}return n.apply(this,arguments)},removeView:function(){if(r.apply(this,arguments),this.$scope&&this.$scope.webixJet){var e=this.$scope._subs;for(var i in e){var n=e[i];t.$$(n.id)||(n.view.destructor(),delete e[i])}}}};t.extend(t.ui.layout.prototype,o,!0),t.extend(t.ui.baselayout.prototype,o,!0),t.protoUI({name:"jetapp",$init:function(e){this.$app=new this.app(e);var i=t.uid().toString();e.body={id:i},this.$ready.push((function(){this.callEvent("onInit",[this.$app]),this.$app.render({id:i})}))}},t.ui.proxy,t.EventSystem)}}var w=function(t){function e(e){var i;return e.router=e.router||g,y((i=t.call(this,e)||this).webix),i}return i(e,t),e.prototype.require=function(t,e){return require(t+"/"+e)},e}(v),b=(function(t){function e(){return null!==t&&t.apply(this,arguments)||this}i(e,t),e.prototype._detectPrefix=function(){this.prefix="",this.sufix=this.config.routerPrefix||""},e.prototype._getRaw=function(){return document.location.pathname+(document.location.search||"")}}(g),function(){function t(t,e){this.path="",this.cb=t}return t.prototype.set=function(t,e){var i=this;this.path=t,e&&e.silent||setTimeout((function(){return i.cb(t)}),1)},t.prototype.get=function(){return this.path},t}());function _(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function S(t,e,i){for(var n in t)_(t,n)&&e.call(i||t,t[n],n,t)}function x(t){t="Warning: "+t,"undefined"!=typeof console&&console.error(t);try{throw new Error(t)}catch(t){}}var $=String.prototype.replace,C=String.prototype.split,k=function(t){var e=t%10;return 11!==t&&1===e?0:2<=e&&e<=4&&!(t>=12&&t<=14)?1:2},A={arabic:function(t){if(t<3)return t;var e=t%100;return e>=3&&e<=10?3:e>=11?4:5},bosnian_serbian:k,chinese:function(){return 0},croatian:k,french:function(t){return t>1?1:0},german:function(t){return 1!==t?1:0},russian:k,lithuanian:function(t){return t%10==1&&t%100!=11?0:t%10>=2&&t%10<=9&&(t%100<11||t%100>19)?1:2},czech:function(t){return 1===t?0:t>=2&&t<=4?1:2},polish:function(t){if(1===t)return 0;var e=t%10;return 2<=e&&e<=4&&(t%100<10||t%100>=20)?1:2},icelandic:function(t){return t%10!=1||t%100==11?1:0},slovenian:function(t){var e=t%100;return 1===e?0:2===e?1:3===e||4===e?2:3}},V={arabic:["ar"],bosnian_serbian:["bs-Latn-BA","bs-Cyrl-BA","srl-RS","sr-RS"],chinese:["id","id-ID","ja","ko","ko-KR","lo","ms","th","th-TH","zh"],croatian:["hr","hr-HR"],german:["fa","da","de","en","es","fi","el","he","hi-IN","hu","hu-HU","it","nl","no","pt","sv","tr"],french:["fr","tl","pt-br"],russian:["ru","ru-RU"],lithuanian:["lt"],czech:["cs","cs-CZ","sk"],polish:["pl"],icelandic:["is"],slovenian:["sl-SL"]};function E(t){var e,i=(e={},S(V,(function(t,i){S(t,(function(t){e[t]=i}))})),e);return i[t]||i[C.call(t,/-/,1)[0]]||i.en}function L(t){return t.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}var I=/\$/g,P=/%\{(.*?)\}/g;function F(t,e,i,n){if("string"!=typeof t)throw new TypeError("Polyglot.transformPhrase expects argument #1 to be string");if(null==e)return t;var r=t,o=n||P,s="number"==typeof e?{smart_count:e}:e;if(null!=s.smart_count&&r){var a=C.call(r,"||||");r=(a[function(t,e){return A[E(t)](e)}(i||"en",s.smart_count)]||a[0]).replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"")}return r=$.call(r,o,(function(t,e){return _(s,e)&&null!=s[e]?$.call(s[e],I,"$$"):t}))}function M(t){var e=t||{};this.phrases={},this.extend(e.phrases||{}),this.currentLocale=e.locale||"en";var i=e.allowMissing?F:null;this.onMissingKey="function"==typeof e.onMissingKey?e.onMissingKey:i,this.warn=e.warn||x,this.tokenRegex=function(t){var e=t&&t.prefix||"%{",i=t&&t.suffix||"}";if("||||"===e||"||||"===i)throw new RangeError('"||||" token is reserved for pluralization');return new RegExp(L(e)+"(.*?)"+L(i),"g")}(e.interpolation)}M.prototype.locale=function(t){return t&&(this.currentLocale=t),this.currentLocale},M.prototype.extend=function(t,e){S(t,(function(t,i){var n=e?e+"."+i:i;"object"==typeof t?this.extend(t,n):this.phrases[n]=t}),this)},M.prototype.unset=function(t,e){"string"==typeof t?delete this.phrases[t]:S(t,(function(t,i){var n=e?e+"."+i:i;"object"==typeof t?this.unset(t,n):delete this.phrases[n]}),this)},M.prototype.clear=function(){this.phrases={}},M.prototype.replace=function(t){this.clear(),this.extend(t)},M.prototype.t=function(t,e){var i,n,r=null==e?{}:e;if("string"==typeof this.phrases[t])i=this.phrases[t];else if("string"==typeof r._)i=r._;else if(this.onMissingKey){n=(0,this.onMissingKey)(t,r,this.currentLocale,this.tokenRegex)}else this.warn('Missing translation for key: "'+t+'"'),n=t;return"string"==typeof i&&(n=F(i,r,this.currentLocale,this.tokenRegex)),n},M.prototype.has=function(t){return _(this.phrases,t)},M.transformPhrase=function(t,e,i){return F(t,e,i)};var R=M;var T=window.webix;T&&y(T);var D=function(t,e,i){var n=(i=i||{}).storage,r=n?n.get("lang")||"en":i.lang||"en";function o(e,o,s){o.__esModule&&(o=o.default);var u={phrases:o};i.polyglot&&t.webix.extend(u,i.polyglot);var l=a.polyglot=new R(u);if(l.locale(e),a._=t.webix.bind(l.t,l),r=e,n&&n.put("lang",r),i.webix){var c=i.webix[e];c&&t.webix.i18n.setLocale(c)}return s?Promise.resolve():t.refresh()}function s(e,n){if(!1!==i.path){var r=(i.path?i.path+"/":"")+e;o(e,t.require("jet-locales",r),n)}}var a={getLang:function(){return r},setLang:s,setLangData:o,_:null,polyglot:null};t.setService("locale",a),s(r,!0)},j=window;j.Promise||(j.Promise=j.webix.promise);var O=1;function G(t){var e=!1;return function(){if(e)return t.apply(this,arguments);e=!0}}var q=null;function B(t,e){q=t,e(),q=null}function N(t,e,i){Object.defineProperty(e,i,{get:function(){return t[i]},set:function(e){return t[i]=e}})}function H(t,e){e=e||{};var i={},n={},r=function(t,e){var r=O++;return i[r]={mask:t,handler:e},e("*"===t?n:n[t],void 0,t),r},o=[],s=!1,a=function(t,e,n,r){if(s)o.push([t,e,n,r]);else for(var a=Object.keys(i),u=0;u<a.length;u++){var l=i[a[u]];l&&("*"!==l.mask&&l.mask!==t||l.handler(n,e,t,r))}};return Object.defineProperty(n,"$changes",{value:{attachEvent:r,detachEvent:function(t){delete i[t]}},enumerable:!1,configurable:!1}),Object.defineProperty(n,"$observe",{value:r,enumerable:!1,configurable:!1}),Object.defineProperty(n,"$batch",{value:function(t){if("function"!=typeof t){var e=t;t=function(){for(var t in e)n[t]=e[t]}}for(s=!0,t(n),s=!1;o.length;){var i=o.shift();a.apply(this,i)}},enumerable:!1,configurable:!1}),Object.defineProperty(n,"$extend",{value:function(t,i){for(var r in i=i||e,t)if(t.hasOwnProperty(r)){var o=t[r];i.nested&&"object"==typeof o&&o?n[r]=H(o,i):z(n,o,r,a)}},enumerable:!1,configurable:!1}),n.$extend(t,e),n}function z(t,e,i,n){Object.defineProperty(t,i,{get:function(){return e},set:function(t){if(null===e||null===t?e!==t:e.valueOf()!=t.valueOf()){var r=e;e=t,n(i,r,t,q)}},enumerable:!0,configurable:!1})}var U=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.prototype.config=function(){return{type:"wide",margin:5,cols:[{}]}},e.prototype.init=function(){this.State=this.getParam("state",!0),this.Charts=this.app.getService("charts"),this.Local=this.app.getService("local")},e.prototype.ready=function(){var t=this;this.Host=this.getRoot(),this.on(this.State.$changes,"module",(function(e){return t.Show(e)}))},e.prototype.Show=function(t){var e=this,i=this.Host;if(t&&"chart"===t.type&&this.CheckColumns(t.columns)){var n=this.GetChartConfig(t);if(!n.view)return;this.GetChartData(t).then((function(r){var o=r[0],s=r[1];"rows"==t.meta.chart.seriesFrom&&(o=e.ConvertDataBySeries(o)),n.data=e.FormatLabels(o.slice(0,e.Charts.numLimit),s),webix.ui([n],i),e.Chart=i.getChildViews()[0]}))}else webix.ui([{template:" "}],i),this.Chart=null},e.prototype.FormatLabels=function(t,e){var i=this.State.module.meta.chart.labelColumn,n=i&&e.length?e.find((function(t){return t.field==i})):null;if(n)t.forEach((function(t){var e=n.data.find((function(e){return e.id==t[i]}));t[i]=e?e.value:t[i]}));else{var r=(this.State.module.fields||this.State.module.columns).find((function(t){return t.id==i}));r&&"date"==r.type&&t.forEach((function(t){t[i]=webix.i18n.dateFormatStr(new Date(t[i]))}))}return t},e.prototype.CheckColumns=function(t){return t.length&&-1==t.indexOf(webix.undefined)},e.prototype.GetChartConfig=function(t){var e=this,i=t.columns,r=t.meta;if(!i||!r.chart)return{};var o=r.chart,s=o.chartType,a=o.labelColumn,u=o.legendPosition,l=o.series,c=o.axises;if(!l)return{};var p=[];l.forEach((function(t){if(!1!==t.show){var i=t.chartType||s;p.push(n(n({},e.ApplyTypeConfig(t,i)),{value:function(e){return e[t.id]}}))}}));var h={view:"chart",type:s,localId:"chart",series:p,padding:{left:80,right:40,top:50,bottom:80},on:{onAfterRender:function(){return e.CorrectLabels()}},legend:this.GetLegendConfig(l,s,u)};return c&&(h.xAxis=n({template:function(t){return"<div class='webix_rpt_chart_label'>"+(t[a]||"")+"</div>"}},c.x),h.yAxis=n({},c.y),c.y.logarithmic&&(h.scale="logarithmic"),c.x.verticalLabels&&(h.css="webix_rpt_vertical_chart_labels")),"right"==h.legendPosition?h.padding.right=h.legend.width+10:h.padding.bottom=90,h},e.prototype.GetLegendConfig=function(t,e,i){if("none"==i)return null;var n=[],r=[],o=this.Charts.itemSupport;t.forEach((function(i){!1!==i.show&&(n.push({text:i.meta.name,color:i.meta.color,markerType:-1!=o.indexOf(t.chartType||e)?"item":"square"}),r.push(i.name))}));var s={values:n,margin:8};return"right"==i?(s.width=webix.html.getTextSize(r).width+30,s.valign="middle",s.align="right"):(s.layout="x",s.valign="bottom",s.align="center"),s},e.prototype.GetChartData=function(t){return Promise.all([this.Local.getData(this.Local.getDataConfig(t),"edit"==this.State.mode),this.Local.getOptions(t.columns)])},e.prototype.ApplyTypeConfig=function(t,e){var i=t.meta;return-1!=this.Charts.itemSupport.indexOf(e)?{fill:i.area?i.color:null,alpha:i.area?.2:1,item:{type:i.markerType,radius:"no"==i.markerType?0:3,borderColor:i.color,color:i.fillMarker?i.color:"#ffffff"},line:{color:i.color,width:i.area?1:2},disableItems:!!i.area}:"area"==e||"splineArea"==e?{border:!0,alpha:.3,color:i.color}:{color:i.color}},e.prototype.ConvertDataBySeries=function(t){var e=this.State.module.meta.chart,i=e.labelColumn,n=e.baseColumn,r=e.dataColumn;if(!(i&&n&&r))return[];var o=[];return t.forEach((function(t){var e=o.find((function(e){return e[i]==t[i]}));e||((e={})[i]=t[i]),e[t[n]]||(e[t[n]]=t[r]),o.push(e)})),o},e.prototype.CorrectLabels=function(){var t=this.$$("chart");if(t&&!t.config.offset){var e=t.$view.querySelector(".webix_axis_item_x");e&&(e.className+=" webix_rpt_chart_label0")}},e}(p);function Q(t,e,i,n){return function t(e,i,n){if("*"===i){var r=n.elements;for(var o in r)void 0!==e[o]&&t(e,o,r[o]);return}n.getList||n.attachEvent("onTimedKeyPress",(function(){var t=this.getValue();this.config.value!==t&&(this.config.value=t,this.callEvent("onChange",[t]))}));n.attachEvent("onChange",(function(){var t=this;B(this,(function(){var n;(n=t.getValue())!==e[i]&&(e[i]=n)}))}))}(t,e,i),function(t,e,i,n){var r=function(t,n,r,o){if("*"===r){var s=i.elements;for(var a in s)void 0!==t[a]&&s[a].setValue(t[a])}else if("*"===e){var u=i.elements[r];u&&u!=o&&u.setValue(t)}else o!=i&&i.setValue(t)};return n?n.on(t.$changes,e,r):t.$changes.attachEvent(e,r)}(t,e,i,n)}webix.protoUI({name:"input-list",getValue:function(){return this._value||[]},setValue:function(t){this._value=t,this.clearAll(),this.parse([].concat(t))}},webix.ui.list);var J,K,W={table:"<span class='rpi-table'></span>",chart:"<span class='rpi-poll'></span>",heatmap:"<span class='rpi-chart-tree'></span>"},Z=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.prototype.config=function(){var t=this,e=this._=this.app.getService("locale")._;return{view:"form",scroll:"auto",elementsConfig:{labelWidth:130,labelPosition:"top"},elements:[{rows:[{view:"label",label:e("Report name")},{view:"text",name:"name",localId:"name"}]},{rows:[{view:"label",label:e("Description")},{view:"textarea",labelPosition:"top",height:150,name:"desc"}]},{rows:[{view:"label",label:e("Data source")},{view:"combo",name:"data",options:[]}]},{view:"input-list",name:"joins",template:this.JoinListTemplate.bind(this),data:[],autoheight:!0,borderless:!0,onClick:{webix_rpt_action_remove:function(e,i){return t.RemoveJoin(i)}}},{view:"button",localId:"add",label:e("Join data"),click:function(){return t.ShowJoins()}},{},{view:"button",label:e("Delete report"),localId:"delete",inputWidth:170,align:"left",css:"webix_rpt_delete",click:function(){return t.app.callEvent("onMenuAction",[null,"delete"])}}]}},e.prototype.init=function(){var t=this,e=this.getRoot().elements;this.State=this.getParam("state",!0),this.AppState=this.app.getParam("state"),this.Local=this.app.getService("local"),this.Models=this.Local.getModels(!0);var i=Object.keys(this.Models);e.data.getList().parse(i.map((function(e){var i=t.Models[e];return{id:i.id,value:i.name}}))),Q(this.State,"*",this.getRoot(),this),this.on(this.State.$changes,"id",(function(e){return t.ShowDeleteButton(e)})),this.on(this.AppState.$changes,"toolbar",(function(e){return t.ShowDeleteButton(e)})),this.SourcesList=this.ui({view:"popup",body:{view:"list",autoheight:!0,type:{template:this.JoinTemplate.bind(this)},click:function(e){var i=t.SourcesList.getBody().getItem(e);t.AddJoin(i),t.SourcesList.hide()}}})},e.prototype.AddJoin=function(t){var e=this.Local.addJoin(t.tid,this.State);e.joins=r(this.State.joins,[t]),this.State.$batch(e)},e.prototype.RemoveJoin=function(t){var e=this.Local.cleanLinkedModels(t,this.State);e.block?(e.block.filter&&webix.alert(this._("Please delete the related query filter first")),e.block.group&&webix.alert(this._("Please delete the related group rule first"))):this.State.$batch(e)},e.prototype.JoinTemplate=function(t){var e=this.Models[t.sid],i=this.Models[t.tid],n=t.sf||t.tf,r=(t.sf?e:i).data.find((function(t){return t.id===n})).name;return i.name+" <span class='webix_rpt_sources_path'>"+e.name+(t.sf?" ("+r+")":"")+" -> "+i.name+(t.tf?" ("+r+")":"")+"</span>"},e.prototype.JoinListTemplate=function(t){return"<span style='float:right' class='webix_icon webix_rpt_action_remove rpi-delete'></span>"+this.JoinTemplate(t)},e.prototype.ShowJoins=function(){var t=this.Local.getLinkedModels([this.State.data].concat(this.State.joins.map((function(t){return t.tid}))),!0),e=this.SourcesList.getBody();e.clearAll(),e.parse(t),this.SourcesList.show(this.$$("add").$view)},e.prototype.ShowDeleteButton=function(){this.State.id&&this.AppState.toolbar?this.$$("delete").show():this.$$("delete").hide()},e}(p);function Y(t){var e=new webix.promise.defer,i=webix.ui({view:"popup",head:!1,position:t.master?"":"center",body:{view:"form",padding:{top:5,left:20,right:20,bottom:20},rows:[{view:"label",label:t.text},{margin:10,cols:[{view:"text",name:"name",value:t.value,width:230,css:"fm-prompt-input"},{view:"button",value:t.button,width:100,hotkey:"enter",click:function(){var t=this.getTopParentView(),i=t.getBody().getValues().name;e.resolve(i),t.close()}}]}]},on:{onShow:function(){var e=this.getBody().elements.name.getInputNode();e.focus(),t.selectMask?t.selectMask(e):e.select()},onHide:function(){e.reject("prompt cancelled"),this.destructor()}}}),n=t.master?{x:50}:null;return webix.delay((function(){return i.show(t.master,n)})),e}webix.protoUI({name:"query-select",$cssName:"richselect",$init:function(){webix.extend(this.on_click,{webix_rpt_qselect_icon:function(){return this.callEvent("onClearClick",[]),!1}})}},webix.ui.richselect),J=void 0,K=function(t){var e=function(t,i){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,i)};function i(t,i){function n(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}var n=function(){return(n=Object.assign||function(t){for(var e,i=1,n=arguments.length;i<n;i++)for(var r in e=arguments[i])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t}).apply(this,arguments)},r=function(){},o=function(){function t(t,e){this.webixJet=!0,this.webix=t,this._events=[],this._subs={},this._data={},e&&e.params&&t.extend(this._data,e.params)}return t.prototype.getRoot=function(){return this._root},t.prototype.destructor=function(){this._detachEvents(),this._destroySubs(),this._events=this._container=this.app=this._parent=this._root=null},t.prototype.setParam=function(t,e,i){if(this._data[t]!==e&&(this._data[t]=e,this._segment.update(t,e,0),i))return this.show(null)},t.prototype.getParam=function(t,e){var i=this._data[t];if(void 0!==i||!e)return i;var n=this.getParentView();return n?n.getParam(t,e):void 0},t.prototype.getUrl=function(){return this._segment.suburl()},t.prototype.getUrlString=function(){return this._segment.toString()},t.prototype.getParentView=function(){return this._parent},t.prototype.$$=function(t){if("string"==typeof t){var e=this.getRoot();return e.queryView((function(i){return(i.config.id===t||i.config.localId===t)&&i.$scope===e.$scope}),"self")}return t},t.prototype.on=function(t,e,i){var n=t.attachEvent(e,i);return this._events.push({obj:t,id:n}),n},t.prototype.contains=function(t){for(var e in this._subs){var i=this._subs[e].view;if(i===t||i.contains(t))return!0}return!1},t.prototype.getSubView=function(t){var e=this.getSubViewInfo(t);if(e)return e.subview.view},t.prototype.getSubViewInfo=function(t){var e=this._subs[t||"default"];return e?{subview:e,parent:this}:"_top"===t?(this._subs[t]={url:"",id:null,popup:!0},this.getSubViewInfo(t)):this._parent?this._parent.getSubViewInfo(t):null},t.prototype._detachEvents=function(){for(var t=this._events,e=t.length-1;e>=0;e--)t[e].obj.detachEvent(t[e].id)},t.prototype._destroySubs=function(){for(var t in this._subs){var e=this._subs[t].view;e&&e.destructor()}this._subs={}},t.prototype._init_url_data=function(){var t=this._segment.current();this._data={},this.webix.extend(this._data,t.params,!0)},t.prototype._getDefaultSub=function(){if(this._subs.default)return this._subs.default;for(var t in this._subs){var e=this._subs[t];if(!e.branch&&e.view&&"_top"!==t){var i=e.view._getDefaultSub();if(i)return i}}},t.prototype._routed_view=function(){var t=this.getParentView();if(!t)return!0;var e=t._getDefaultSub();return!(!e&&e!==this)&&t._routed_view()},t}();function s(t){"/"===t[0]&&(t=t.substr(1));for(var e=t.split("/"),i=[],n=0;n<e.length;n++){var r=e[n],o={},s=r.indexOf(":");if(-1===s&&(s=r.indexOf("?")),-1!==s)for(var a=0,u=r.substr(s+1).split(/[\:\?\&]/g);a<u.length;a++){var l=u[a].split("=");o[l[0]]=decodeURIComponent(l[1])}i[n]={page:s>-1?r.substr(0,s):r,params:o,isNew:!0}}return i}function a(t){for(var e=[],i=0,n=t;i<n.length;i++){var r=n[i];e.push("/"+r.page);var o=u(r.params);o&&e.push("?"+o)}return e.join("")}function u(t){var e=[];for(var i in t)"object"!=typeof t[i]&&(e.length&&e.push("&"),e.push(i+"="+encodeURIComponent(t[i])));return e.join("")}var l=function(){function t(t,e){this._next=1,this.route="string"==typeof t?{url:s(t),path:t}:t,this.index=e}return t.prototype.current=function(){return this.route.url[this.index]},t.prototype.next=function(){return this.route.url[this.index+this._next]},t.prototype.suburl=function(){return this.route.url.slice(this.index)},t.prototype.shift=function(e){var i=new t(this.route,this.index+this._next);return i.setParams(i.route.url,e,i.index),i},t.prototype.setParams=function(t,e,i){if(e){var n=t[i].params;for(var r in e)n[r]=e[r]}},t.prototype.refresh=function(){for(var t=this.route.url,e=this.index+1;e<t.length;e++)t[e].isNew=!0},t.prototype.toString=function(){var t=a(this.suburl());return t?t.substr(1):""},t.prototype._join=function(t,e){var i=this.route.url;if(null===t)return i;var n=this.route.url,r=!0;if(i=n.slice(0,this.index+(e?this._next:0)),t){i=i.concat(s(t));for(var o=0;o<i.length;o++)n[o]&&(i[o].view=n[o].view),r&&n[o]&&i[o].page===n[o].page?i[o].isNew=!1:i[o].isNew&&(r=!1)}return i},t.prototype.append=function(t){var e=this._join(t,!0);return this.route.path=a(e),this.route.url=e,this.route.path},t.prototype.show=function(t,e,i){var n=this,o=this._join(t.url,i);return this.setParams(o,t.params,this.index+(i?this._next:0)),new Promise((function(t,i){var s=a(o),u={url:o,redirect:s,confirm:Promise.resolve()},l=e?e.app:null;!l||l.callEvent("app:guard",[u.redirect,e,u])?u.confirm.catch((function(t){return i(t)})).then((function(){if(null!==u.redirect){if(u.redirect!==s)return l.show(u.redirect),void i(new r);n.route.path=s,n.route.url=o,t()}else i(new r)})):i(new r)}))},t.prototype.size=function(t){this._next=t},t.prototype.split=function(){var e={url:this.route.url.slice(this.index+1),path:""};return e.url.length&&(e.path=a(e.url)),new t(e,0)},t.prototype.update=function(t,e,i){var n=this.route.url[this.index+(i||0)];if(!n)return this.route.url.push({page:"",params:{}}),this.update(t,e,i);""===t?n.page=e:n.params[t]=e,this.route.path=a(this.route.url)},t}(),c=function(t){function e(e,i){var n=t.call(this,e.webix)||this;return n.app=e,n._children=[],n}return i(e,t),e.prototype.ui=function(t,e){var i=(e=e||{}).container||t.container,n=this.app.createView(t);return this._children.push(n),n.render(i,this._segment,this),"object"!=typeof t||t instanceof o?n:n.getRoot()},e.prototype.show=function(t,e){if(e=e||{},"object"==typeof t){for(var i in t)this.setParam(i,t[i]);t=null}else{if("/"===t.substr(0,1))return this.app.show(t,e);if(0===t.indexOf("./")&&(t=t.substr(2)),0===t.indexOf("../")){var n=this.getParentView();return n?n.show(t.substr(3),e):this.app.show("/"+t.substr(3))}var r=this.getSubViewInfo(e.target);if(r){if(r.parent!==this)return r.parent.show(t,e);if(e.target&&"default"!==e.target)return this._renderFrameLock(e.target,r.subview,{url:t,params:e.params})}else if(t)return this.app.show("/"+t,e)}return this._show(this._segment,{url:t,params:e.params},this)},e.prototype._show=function(t,e,i){var n=this;return t.show(e,i,!0).then((function(){return n._init_url_data(),n._urlChange()})).then((function(){t.route.linkRouter&&(n.app.getRouter().set(t.route.path,{silent:!0}),n.app.callEvent("app:route",[t.route.path]))}))},e.prototype.init=function(t,e){},e.prototype.ready=function(t,e){},e.prototype.config=function(){this.app.webix.message("View:Config is not implemented")},e.prototype.urlChange=function(t,e){},e.prototype.destroy=function(){},e.prototype.destructor=function(){this.destroy(),this._destroyKids(),this._root&&(this._root.destructor(),t.prototype.destructor.call(this))},e.prototype.use=function(t,e){t(this.app,this,e)},e.prototype.refresh=function(){return this.getUrl(),this.destroy(),this._destroyKids(),this._destroySubs(),this._detachEvents(),this._container.tagName&&this._root.destructor(),this._segment.refresh(),this._render(this._segment)},e.prototype.render=function(t,e,i){var n=this;"string"==typeof e&&(e=new l(e,0)),this._segment=e,this._parent=i,this._init_url_data();var r="string"==typeof(t=t||document.body)?this.webix.toNode(t):t;return this._container!==r?(this._container=r,this._render(e)):this._urlChange().then((function(){return n.getRoot()}))},e.prototype._render=function(t){var e=this,i=this.config();return i.then?i.then((function(i){return e._render_final(i,t)})):this._render_final(i,t)},e.prototype._render_final=function(t,e){var i,n=this,r=null,o=null,s=!1;if(this._container.tagName?o=this._container:(r=this._container).popup?(o=document.body,s=!0):o=this.webix.$$(r.id),!this.app||!o)return Promise.reject(null);var a=this._segment.current(),u={ui:{}};this.app.copyConfig(t,u.ui,this._subs),this.app.callEvent("app:render",[this,e,u]),u.ui.$scope=this,!r&&a.isNew&&a.view&&a.view.destructor();try{if(r&&!s){var l=o,c=l.getParentView();c&&"multiview"===c.name&&!u.ui.id&&(u.ui.id=l.config.id)}this._root=this.app.webix.ui(u.ui,o);var p=this._root;s&&p.setPosition&&!p.isVisible()&&p.show(),r&&(r.view&&r.view!==this&&r.view!==this.app&&r.view.destructor(),r.id=this._root.config.id,this.getParentView()||!this.app.app?r.view=this:r.view=this.app),a.isNew&&(a.view=this,a.isNew=!1),i=Promise.resolve(this._init(this._root,e)).then((function(){return n._urlChange().then((function(){return n._initUrl=null,n.ready(n._root,e.suburl())}))}))}catch(t){i=Promise.reject(t)}return i.catch((function(t){return n._initError(n,t)}))},e.prototype._init=function(t,e){return this.init(t,e.suburl())},e.prototype._urlChange=function(){var t=this;this.app.callEvent("app:urlchange",[this,this._segment]);var e=[];for(var i in this._subs){var n=this._subs[i],r=this._renderFrameLock(i,n,null);r&&e.push(r)}return Promise.all(e).then((function(){return t.urlChange(t._root,t._segment.suburl())}))},e.prototype._renderFrameLock=function(t,e,i){if(!e.lock){var n=this._renderFrame(t,e,i);n&&(e.lock=n.then((function(){return e.lock=null}),(function(){return e.lock=null})))}return e.lock},e.prototype._renderFrame=function(t,e,i){var n=this;if("default"===t){if(this._segment.next()){var r=i?i.params:null;return e.params&&(r=this.webix.extend(r||{},e.params)),this._createSubView(e,this._segment.shift(r))}e.view&&e.popup&&(e.view.destructor(),e.view=null)}if(null!==i&&(e.url=i.url,e.params&&(i.params=this.webix.extend(i.params||{},e.params))),e.route){if(null!==i)return e.route.show(i,e.view).then((function(){return n._createSubView(e,e.route)}));if(e.branch)return}var o=e.view;if(!o&&e.url){if("string"==typeof e.url)return e.route=new l(e.url,0),i&&e.route.setParams(e.route.route.url,i.params,0),e.params&&e.route.setParams(e.route.route.url,e.params,0),this._createSubView(e,e.route);"function"!=typeof e.url||o instanceof e.url||(o=new(this.app._override(e.url))(this.app,"")),o||(o=e.url)}if(o)return o.render(e,e.route||this._segment,this)},e.prototype._initError=function(t,e){return this.app&&this.app.error("app:error:initview",[e,t]),!0},e.prototype._createSubView=function(t,e){var i=this;return this.app.createFromURL(e.current()).then((function(n){return n.render(t,e,i)}))},e.prototype._destroyKids=function(){for(var t=this._children,e=t.length-1;e>=0;e--)t[e]&&t[e].destructor&&t[e].destructor();this._children=[]},e}(o),p=function(t){function e(e,i){var n=t.call(this,e,i)||this;return n._ui=i.ui,n}return i(e,t),e.prototype.config=function(){return this._ui},e}(c),h=function(){function t(t,e,i){this.path="",this.app=i}return t.prototype.set=function(t,e){this.path=t;var i=this.app;i.app.getRouter().set(i._segment.append(this.path),{silent:!0})},t.prototype.get=function(){return this.path},t}(),f=!0,d=function(t){function e(e){var i=this,n=(e||{}).webix||window.webix;return e=n.extend({name:"App",version:"1.0",start:"/home"},e,!0),(i=t.call(this,n,e)||this).config=e,i.app=i.config.app,i.ready=Promise.resolve(),i._services={},i.webix.extend(i,i.webix.EventSystem),i}return i(e,t),e.prototype.getUrl=function(){return this._subSegment.suburl()},e.prototype.getUrlString=function(){return this._subSegment.toString()},e.prototype.getService=function(t){var e=this._services[t];return"function"==typeof e&&(e=this._services[t]=e(this)),e},e.prototype.setService=function(t,e){this._services[t]=e},e.prototype.destructor=function(){this.getSubView().destructor(),t.prototype.destructor.call(this)},e.prototype.copyConfig=function(t,e,i){if((t instanceof o||"function"==typeof t&&t.prototype instanceof o)&&(t={$subview:t}),void 0!==t.$subview)return this.addSubView(t,e,i);var n=t instanceof Array;for(var r in e=e||(n?[]:{}),t){var s=t[r];if("function"==typeof s&&s.prototype instanceof o&&(s={$subview:s}),!s||"object"!=typeof s||s instanceof this.webix.DataCollection||s instanceof RegExp||s instanceof Map)e[r]=s;else if(s instanceof Date)e[r]=new Date(s);else{var a=this.copyConfig(s,s instanceof Array?[]:{},i);null!==a&&(n?e.push(a):e[r]=a)}}return e},e.prototype.getRouter=function(){return this.$router},e.prototype.clickHandler=function(t,e){if(t&&(e=e||t.target||t.srcElement)&&e.getAttribute){var i=e.getAttribute("trigger");if(i)return this._forView(e,(function(t){return t.app.trigger(i)})),t.cancelBubble=!0,t.preventDefault();var n=e.getAttribute("route");if(n)return this._forView(e,(function(t){return t.show(n)})),t.cancelBubble=!0,t.preventDefault()}var r=e.parentNode;r&&this.clickHandler(t,r)},e.prototype.getRoot=function(){return this.getSubView().getRoot()},e.prototype.refresh=function(){var t=this;return this._subSegment?this.getSubView().refresh().then((function(e){return t.callEvent("app:route",[t.getUrl()]),e})):Promise.resolve(null)},e.prototype.loadView=function(t){var e=this,i=this.config.views,n=null;if(""===t)return Promise.resolve(this._loadError("",new Error("Webix Jet: Empty url segment")));try{i&&"string"==typeof(n="function"==typeof i?i(t):i[t])&&(t=n,n=null),n||("_hidden"===t?n={hidden:!0}:"_blank"===t?n={}:(t=t.replace(/\./g,"/"),n=this.require("jet-views",t)))}catch(e){n=this._loadError(t,e)}return n.then||(n=Promise.resolve(n)),n=n.then((function(t){return t.__esModule?t.default:t})).catch((function(i){return e._loadError(t,i)}))},e.prototype._forView=function(t,e){var i=this.webix.$$(t);i&&e(i.$scope)},e.prototype._loadViewDynamic=function(t){return null},e.prototype.createFromURL=function(t){var e=this;return t.isNew||!t.view?this.loadView(t.page).then((function(i){return e.createView(i,name,t.params)})):Promise.resolve(t.view)},e.prototype._override=function(t){var e=this.config.override;if(e){for(var i=void 0;t;)i=t,t=e.get(t);return i}return t},e.prototype.createView=function(t,i,n){if("function"==typeof(t=this._override(t))){if(t.prototype instanceof e)return new t({app:this,name:i,params:n,router:h});if(t.prototype instanceof o)return new t(this,{name:i,params:n});t=t(this)}return t instanceof o?t:new p(this,{name:i,ui:t})},e.prototype.show=function(t,e){return t&&this.app&&0==t.indexOf("//")?this.app.show(t.substr(1),e):this.render(this._container,t||this.config.start,e)},e.prototype.trigger=function(t){for(var e=[],i=1;i<arguments.length;i++)e[i-1]=arguments[i];this.apply(t,e)},e.prototype.apply=function(t,e){this.callEvent(t,e)},e.prototype.action=function(t){return this.webix.bind((function(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];this.apply(t,e)}),this)},e.prototype.on=function(t,e){this.attachEvent(t,e)},e.prototype.use=function(t,e){t(this,null,e)},e.prototype.error=function(t,e){if(this.callEvent(t,e),this.callEvent("app:error",e),this.config.debug)for(var i=0;i<e.length;i++)if(console.error(e[i]),e[i]instanceof Error){var n=e[i].message;0===n.indexOf("Module build failed")?(n=n.replace(/\x1b\[[0-9;]*m/g,""),document.body.innerHTML="<pre style='font-size:16px; background-color: #ec6873; color: #000; padding:10px;'>"+n+"</pre>"):(n+="<br><br>Check console for more details",this.webix.message({type:"error",text:n,expire:-1}))}},e.prototype.render=function(t,e,i){var n=this;this._container="string"==typeof t?this.webix.toNode(t):t||document.body;var r=null;this.$router?r="string"==typeof e?e:this.app?e.split().route.path||this.config.start:e.toString():(f&&"tagName"in this._container&&(this.webix.event(document.body,"click",(function(t){return n.clickHandler(t)})),f=!1),"string"==typeof e&&(e=new l(e,0)),this._subSegment=this._first_start(e),this._subSegment.route.linkRouter=!0);var o=i?i.params:this.config.params||null,s=this.getSubView(),a=this._subSegment,u=a.show({url:r,params:o},s).then((function(){return n.createFromURL(a.current())})).then((function(e){return e.render(t,a)})).then((function(t){return n.$router.set(a.route.path,{silent:!0}),n.callEvent("app:route",[n.getUrl()]),t}));return this.ready=this.ready.then((function(){return u})),u},e.prototype.getSubView=function(){if(this._subSegment){var t=this._subSegment.current().view;if(t)return t}return new c(this,{})},e.prototype.require=function(t,e){return null},e.prototype._first_start=function(t){var e=this;if(this._segment=t,this.$router=new this.config.router((function(t){return setTimeout((function(){e.show(t).catch((function(t){if(!(t instanceof r))throw t}))}),1)}),this.config,this),this._container===document.body&&!1!==this.config.animation){var i=this._container;this.webix.html.addCss(i,"webixappstart"),setTimeout((function(){e.webix.html.removeCss(i,"webixappstart"),e.webix.html.addCss(i,"webixapp")}),10)}if(t){if(this.app){var n=t.current().view;t.current().view=this,t.next()?(t.refresh(),t=t.split()):t=new l(this.config.start,0),t.current().view=n}}else{var o=this.$router.get();o||(o=this.config.start,this.$router.set(o,{silent:!0})),t=new l(o,0)}return t},e.prototype._loadError=function(t,e){return this.error("app:error:resolve",[e,t]),{template:" "}},e.prototype.addSubView=function(t,e,i){var n=!0!==t.$subview?t.$subview:null,r=t.name||(n?this.webix.uid():"default");return e.id=t.id||"s"+this.webix.uid(),(i[r]={id:e.id,url:n,branch:t.branch,popup:t.popup,params:t.params}).popup?null:e},e}(o),v=function(){function t(t,e){var i=this;this.config=e||{},this._detectPrefix(),this.cb=t,window.onpopstate=function(){return i.cb(i.get())}}return t.prototype.set=function(t,e){var i=this;if(this.config.routes){var n=t.split("?",2);for(var r in this.config.routes)if(this.config.routes[r]===n[0]){t=r+(n.length>1?"?"+n[1]:"");break}}this.get()!==t&&window.history.pushState(null,null,this.prefix+this.sufix+t),e&&e.silent||setTimeout((function(){return i.cb(t)}),1)},t.prototype.get=function(){var t=this._getRaw().replace(this.prefix,"").replace(this.sufix,"");if(t="/"!==t&&"#"!==t?t:"",this.config.routes){var e=t.split("?",2),i=this.config.routes[e[0]];i&&(t=i+(e.length>1?"?"+e[1]:""))}return t},t.prototype._detectPrefix=function(){var t=this.config.routerPrefix;this.sufix="#"+(void 0===t?"!":t),this.prefix=document.location.href.split("#",2)[0]},t.prototype._getRaw=function(){return document.location.href},t}(),g=!1;function m(t){if(!g&&t){g=!0;var e=window;e.Promise||(e.Promise=t.promise);var i=t.version.split(".");10*i[0]+1*i[1]<53&&(t.ui.freeze=function(e){var i=e();return i&&i.then?i.then((function(e){return t.ui.$freeze=!1,t.ui.resize(),e})):(t.ui.$freeze=!1,t.ui.resize()),i});var n=t.ui.baselayout.prototype.addView,r=t.ui.baselayout.prototype.removeView,o={addView:function(t,e){if(this.$scope&&this.$scope.webixJet&&!t.queryView){var i=this.$scope,r={};t=i.app.copyConfig(t,{},r),n.apply(this,[t,e]);var o=function(t){i._renderFrame(t,r[t],null).then((function(){i._subs[t]=r[t]}))};for(var s in r)o(s);return t.id}return n.apply(this,arguments)},removeView:function(){if(r.apply(this,arguments),this.$scope&&this.$scope.webixJet){var e=this.$scope._subs;for(var i in e){var n=e[i];t.$$(n.id)||(n.view.destructor(),delete e[i])}}}};t.extend(t.ui.layout.prototype,o,!0),t.extend(t.ui.baselayout.prototype,o,!0),t.protoUI({name:"jetapp",$init:function(e){this.$app=new this.app(e);var i=t.uid().toString();e.body={id:i},this.$ready.push((function(){this.callEvent("onInit",[this.$app]),this.$app.render({id:i})}))}},t.ui.proxy,t.EventSystem)}}var y=function(t){function e(e){var i;return e.router=e.router||v,m((i=t.call(this,e)||this).webix),i}return i(e,t),e.prototype.require=function(t,e){return require(t+"/"+e)},e}(d),w=(function(t){function e(){return null!==t&&t.apply(this,arguments)||this}i(e,t),e.prototype._detectPrefix=function(){this.prefix="",this.sufix=this.config.routerPrefix||""},e.prototype._getRaw=function(){return document.location.pathname+(document.location.search||"")}}(v),function(){function t(t,e){this.path="",this.cb=t}return t.prototype.set=function(t,e){var i=this;this.path=t,e&&e.silent||setTimeout((function(){return i.cb(t)}),1)},t.prototype.get=function(){return this.path},t}());function b(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function _(t,e,i){for(var n in t)b(t,n)&&e.call(i||t,t[n],n,t)}function S(t){t="Warning: "+t,"undefined"!=typeof console&&console.error(t);try{throw new Error(t)}catch(t){}}var x=String.prototype.replace,$=String.prototype.split,C=function(t){var e=t%10;return 11!==t&&1===e?0:2<=e&&e<=4&&!(t>=12&&t<=14)?1:2},k={arabic:function(t){if(t<3)return t;var e=t%100;return e>=3&&e<=10?3:e>=11?4:5},bosnian_serbian:C,chinese:function(){return 0},croatian:C,french:function(t){return t>1?1:0},german:function(t){return 1!==t?1:0},russian:C,lithuanian:function(t){return t%10==1&&t%100!=11?0:t%10>=2&&t%10<=9&&(t%100<11||t%100>19)?1:2},czech:function(t){return 1===t?0:t>=2&&t<=4?1:2},polish:function(t){if(1===t)return 0;var e=t%10;return 2<=e&&e<=4&&(t%100<10||t%100>=20)?1:2},icelandic:function(t){return t%10!=1||t%100==11?1:0},slovenian:function(t){var e=t%100;return 1===e?0:2===e?1:3===e||4===e?2:3}},A={arabic:["ar"],bosnian_serbian:["bs-Latn-BA","bs-Cyrl-BA","srl-RS","sr-RS"],chinese:["id","id-ID","ja","ko","ko-KR","lo","ms","th","th-TH","zh"],croatian:["hr","hr-HR"],german:["fa","da","de","en","es","fi","el","he","hi-IN","hu","hu-HU","it","nl","no","pt","sv","tr"],french:["fr","tl","pt-br"],russian:["ru","ru-RU"],lithuanian:["lt"],czech:["cs","cs-CZ","sk"],polish:["pl"],icelandic:["is"],slovenian:["sl-SL"]};function V(t){var e,i=(e={},_(A,(function(t,i){_(t,(function(t){e[t]=i}))})),e);return i[t]||i[$.call(t,/-/,1)[0]]||i.en}function E(t){return t.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}var L=/\$/g,I=/%\{(.*?)\}/g;function P(t,e,i,n){if("string"!=typeof t)throw new TypeError("Polyglot.transformPhrase expects argument #1 to be string");if(null==e)return t;var r=t,o=n||I,s="number"==typeof e?{smart_count:e}:e;if(null!=s.smart_count&&r){var a=$.call(r,"||||");r=(a[function(t,e){return k[V(t)](e)}(i||"en",s.smart_count)]||a[0]).replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"")}return r=x.call(r,o,(function(t,e){return b(s,e)&&null!=s[e]?x.call(s[e],L,"$$"):t}))}function F(t){var e=t||{};this.phrases={},this.extend(e.phrases||{}),this.currentLocale=e.locale||"en";var i=e.allowMissing?P:null;this.onMissingKey="function"==typeof e.onMissingKey?e.onMissingKey:i,this.warn=e.warn||S,this.tokenRegex=function(t){var e=t&&t.prefix||"%{",i=t&&t.suffix||"}";if("||||"===e||"||||"===i)throw new RangeError('"||||" token is reserved for pluralization');return new RegExp(E(e)+"(.*?)"+E(i),"g")}(e.interpolation)}F.prototype.locale=function(t){return t&&(this.currentLocale=t),this.currentLocale},F.prototype.extend=function(t,e){_(t,(function(t,i){var n=e?e+"."+i:i;"object"==typeof t?this.extend(t,n):this.phrases[n]=t}),this)},F.prototype.unset=function(t,e){"string"==typeof t?delete this.phrases[t]:_(t,(function(t,i){var n=e?e+"."+i:i;"object"==typeof t?this.unset(t,n):delete this.phrases[n]}),this)},F.prototype.clear=function(){this.phrases={}},F.prototype.replace=function(t){this.clear(),this.extend(t)},F.prototype.t=function(t,e){var i,n,r=null==e?{}:e;return"string"==typeof this.phrases[t]?i=this.phrases[t]:"string"==typeof r._?i=r._:this.onMissingKey?n=(0,this.onMissingKey)(t,r,this.currentLocale,this.tokenRegex):(this.warn('Missing translation for key: "'+t+'"'),n=t),"string"==typeof i&&(n=P(i,r,this.currentLocale,this.tokenRegex)),n},F.prototype.has=function(t){return b(this.phrases,t)},F.transformPhrase=function(t,e,i){return P(t,e,i)};var M=F,R=window.webix;R&&m(R);var T=function(t,e,i){var n=(i=i||{}).storage,r=n?n.get("lang")||"en":i.lang||"en";function o(e,o,s){o.__esModule&&(o=o.default);var u={phrases:o};i.polyglot&&t.webix.extend(u,i.polyglot);var l=a.polyglot=new M(u);if(l.locale(e),a._=t.webix.bind(l.t,l),r=e,n&&n.put("lang",r),i.webix){var c=i.webix[e];c&&t.webix.i18n.setLocale(c)}return s?Promise.resolve():t.refresh()}function s(e,n){if(!1!==i.path){var r=(i.path?i.path+"/":"")+e;o(e,t.require("jet-locales",r),n)}}var a={getLang:function(){return r},setLang:s,setLangData:o,_:null,polyglot:null};t.setService("locale",a),s(r,!0)},D=window;D.Promise||(D.Promise=D.webix.promise);var j=1;function O(t,e,i){Object.defineProperty(e,i,{get:function(){return t[i]},set:function(e){return t[i]=e}})}function G(t,e){e=e||{};var i={},n={},r=function(t,e){var r=j++;return i[r]={mask:t,handler:e},e("*"===t?n:n[t],void 0,t),r},o=[],s=!1,a=function(t,e,n,r){if(s)o.push([t,e,n,r]);else for(var a=Object.keys(i),u=0;u<a.length;u++){var l=i[a[u]];l&&("*"!==l.mask&&l.mask!==t||l.handler(n,e,t,r))}};for(var u in t)if(t.hasOwnProperty(u)){var l=t[u];e.nested&&"object"==typeof l&&l?n[u]=G(l,e):q(n,l,u,a)}return Object.defineProperty(n,"$changes",{value:{attachEvent:r,detachEvent:function(t){delete i[t]}},enumerable:!1,configurable:!1}),Object.defineProperty(n,"$observe",{value:r,enumerable:!1,configurable:!1}),Object.defineProperty(n,"$batch",{value:function(t){if("function"!=typeof t){var e=t;t=function(){for(var t in e)n[t]=e[t]}}for(s=!0,t(n),s=!1;o.length;){var i=o.shift();a.apply(this,i)}},enumerable:!1,configurable:!1}),n}function q(t,e,i,n){Object.defineProperty(t,i,{get:function(){return e},set:function(t){if(null===e||null===t?e!==t:e.valueOf()!=t.valueOf()){var r=e;e=t,n(i,r,t,null)}},enumerable:!0,configurable:!1})}var B=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.prototype.config=function(){var t=this,e=this.app.getService("locale")._;return{view:"popup",point:!1,body:{view:"list",yCount:4,width:120,borderless:!0,data:[{id:"edit",value:e("Edit")},{id:"add-filter",value:e("Add Filter")},{id:"add-group",value:e("Add Group")},{id:"delete",value:e("Delete")}],click:function(e){t.app.callEvent("action",[e,t.Item]),t.Hide()}}}},e.prototype.Hide=function(){this.getRoot().hide()},e.prototype.Show=function(t,e){this.Item=e;var i=webix.html.offset(t);this.getRoot().show({x:i.x+i.width+webix.skin.$active.dataPadding,y:i.y-10})},e}(c),N=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.prototype.GetButton=function(){var t=this;return{view:"button",value:(0,this.app.getService("locale")._)("Add filter"),localId:"button",css:"webix_primary",click:function(){return t.Add(null,null)}}},e.prototype.GetList=function(){var t=this,e=this.app.getService("locale")._,i=this.getParam("simple")?"<span style='float:right' class='webix_icon action-close wxi-close'></span>":"<span style='float:right' class='webix_icon action-menu wxi-dots'></span>",n=e("and"),r=e("or"),o=function(t){return"and"==t.glue?n:r};return{view:"tree",borderless:!0,localId:"list",glue:"and",css:"wbq-query_list",scheme:{$serialize:function(t){if(t.group)return{group:t.group,glue:t.glue};var e={glue:t.glue,field:t.field,condition:t.condition};return t.includes&&t.includes.length&&(e.includes=t.includes),e},$init:function(t){t.group&&(t.$css="group",t.open=!0)}},type:{template:function(n){return n.group?"<div class='wbq-filter_join wbq-filter_join_"+n.glue+"'>"+o(n)+"</div>":t.Template(n,t.app.config.fields,i,e)+"<div class='wbq-filter_join wbq-filter_join_"+n.glue+"'>"+o(n)+"</div>"}},onClick:{"action-menu":function(t,e){this.$scope.Actions.Show(t.target,e)},"action-close":function(e,i){t.Delete(i)},"wbq-filter_join":function(e,i){t.SwitchGlue(i)}},on:{onItemDblClick:function(e){return t.EditStart(e)}}}},e.prototype.init=function(){var t=this;this.Actions=this.ui(B),this.on(this.app,"applyFilter",(function(e){return t.EditStop(e)})),this.on(this.app,"action",(function(e,i){"delete"===e?t.Delete(i):"add-filter"===e?t.Add(null,i):"add-group"===e?t.AddGroup(null,i):"edit"===e&&webix.delay((function(){return t.EditStart(i)}))})),this.State=this.getParam("state"),this.on(this.State.$changes,"value",(function(e){t.LastValue=JSON.stringify(e),t.$$("list").clearAll(),e&&t.$$("list").parse(t.ConvertTo(e))}))},e.prototype.ConvertTo=function(t,e){var i=this;if(t.rules){var r=t.rules.map((function(e){return i.ConvertTo(e,t.glue)}));return e?{group:!0,glue:e,data:r}:r}return n(n({},t),{glue:e})},e.prototype.ConvertFrom=function(t,e){var i=this,n=e.getBranch(t),r=n.map((function(t){var n=t.id,r=t.field,o=t.type,s=t.condition,a=t.includes;return r?{field:r,type:o,condition:s,includes:a}:i.ConvertFrom(n,e)}));return r.length?{glue:n[0].glue,rules:r}:null},e.prototype.Add=function(t,e){this.EditStop(),t=t||{field:""};var i=this.$$("list"),n=e?i.getParentId(e):0,r=e?i.getBranchIndex(e)+1:-1;!e&&i.count()&&(e=i.getFirstId());var o=e?i.getItem(e).glue:i.config.glue;t.glue=o;var s=i.add(t,r,n);this.EditStart(s),this.CreateMode=!0},e.prototype.SwitchGlue=function(t){for(var e=this.$$("list"),i=e.data.getBranch(e.getParentId(t)),n=0;n<i.length;n++)e.updateItem(i[n].id,{glue:"and"==i[n].glue?"or":"and"});this.Save()},e.prototype.AddGroup=function(t,e){this.EditStop(),t=t||{};var i=this.$$("list"),n=e?i.getParentId(e):0,r=e?i.getBranchIndex(e)+1:-1,o={id:webix.uid(),group:!0},s=e?i.getItem(e).glue:i.config.glue;o.glue=s,t.glue="and"==o.glue?"or":"and",i.add(o,r,n);var a=i.add(t,null,o.id);this.EditStart(a),this.CreateMode=!0},e.prototype.Delete=function(t){this.EditStop(),this.DeleteSilent(t),this.Save()},e.prototype.DeleteSilent=function(t){var e=this.$$("list"),i=e.getParentId(t);e.remove(t);var n=e.data.branch[i];if(i&&!n)this.DeleteSilent(i);else if(1==n.length&&e.getItem(n[0]).group){var r=n[0];if(i){var o=e.getParentId(i),s=e.getBranchIndex(i,o);e.move(r,s,e,{parent:o}),this.DeleteSilent(i)}else{s=e.getBranchIndex(r,0);var a=[].concat(e.data.branch[r]);e.move(a,s,e,{parent:0}),this.DeleteSilent(r)}}},e.prototype.EditStop=function(t){if(this.Active){var e=this.$$("list");t?((t=t||this.Active.GetValue()).includes=t.includes||[],e.updateItem(this.ActiveId,n({},t))):this.CreateMode?this.DeleteSilent(this.ActiveId):e.refresh(this.ActiveId);var i=this.Active;this.Active=null,i.destructor(),this.Save()}},e.prototype.Save=function(){var t=this.ConvertFrom(0,this.$$("list").data),e=JSON.stringify(t);this.LastValue!==e&&(this.State.value=t)},e.prototype.Template=function(t,e,i,n){var r="&nbsp;",o=e.find((function(e){return e.id===t.field}))||{value:""};if(t.includes&&t.includes.length){r=n("in")+" ";for(var s=0;s<t.includes.length;s++)r+=(s>0?", ":"")+"<span class='wbq-field-value'>"+t.includes[s]+"</span>"}else t.condition&&t.condition.type&&(r=n(t.condition.type)+" <span class='wbq-field-value'>"+this.Format(t.condition.filter,o.format,o.type)+"</span>");return"<span class='wbq-field-box'><span class='wbq-field-name'>"+o.value+"</span> "+r+" </span>"+i},e.prototype.Format=function(t,e,i){if(!t)return"";if(t.start)t=this.Format(t.start,e,i)+(t.end?" - "+this.Format(t.end,e,i):"");else{var n=e||("date"==i?webix.i18n.dateFormatStr:null);n&&(t=n(t))}return t},e}(c),H=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.prototype.config=function(){var t=this,e=this.app.getService("locale")._;return{padding:10,margin:6,css:"webix_shadow_small",rows:[{view:"richselect",options:[],localId:"field",on:{onChange:function(){return t.AdjustToField()}}},{localId:"filter"},{type:"clean",cols:[{view:"button",value:e("Cancel"),width:100,click:function(){return t.Hide()}},{},{view:"button",value:e("Apply"),width:100,css:"webix_primary",click:function(){return t.ApplyFilter()}}]}]}},e.prototype.GetField=function(){var t=this.$$("field");return t.getList().getItem(t.getValue())},e.prototype.AdjustToField=function(){var t=this.GetField();this.CreateFilter(t.id,t.type,t.format,t.conditions,this.$$("filter"))},e.prototype.CreateFilter=function(t,e,i,n,r){var o={view:"filter",localId:"filter",conditions:n,field:t,mode:e,template:function(n){var r=n[t],o=i||("date"==e?webix.i18n.dateFormatStr:null);return o&&(r=o(r)),r},margin:6},s=webix.ui(o,r),a=this.app.getService("backend").data(t);return s.parse(a),s},e.prototype.ApplyFilter=function(){this.app.callEvent("applyFilter",[this.GetValue()])},e.prototype.GetValue=function(){var t=this.GetField(),e=n(n({},this.$$("filter").getValue()),{field:t.id,type:t.type});return""!=e.condition.filter||e.includes&&e.includes.length||(e=null),e},e.prototype.Hide=function(){this.app.callEvent("applyFilter",[null])},e.prototype.Show=function(t,e){var i=this.$$("field");i.getList().parse(e),t.field?i.setValue(t.field):i.setValue(e[0].id),this.$$("filter").setValue(webix.copy(t))},e}(c),z=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.prototype.config=function(){return{view:"popup",point:!1,body:{$subview:H,name:"body"}}},e.prototype.Show=function(t,e,i){var n=this;setTimeout((function(){n.getRoot().show(i),n.getSubView("body").Show(t,e)}),100)},e}(c),U=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.prototype.config=function(){var t=this.GetButton();t.width=100;var e=this.GetList();e.scroll=!1!==this.app.config.scroll?"x":"",e.borderless=!0,e.css="wbq-query_bar";var i=8,n=58;return("mini"==webix.skin.$name||"compact"==webix.skin.$name)&&(i=4,n=50),{view:"toolbar",paddingX:2*i,paddingY:i,height:n,borderless:!0,cols:[e,t]}},e.prototype.EditStart=function(t){var e=this;this.EditStop();var i=this.$$("list");this.ActiveId=t,this.Active=this.ui(z),this.Active.getRoot().attachEvent("onHide",(function(){e.Active&&e.EditStop()}));var n=webix.html.offset(i.getItemNode(t));this.Active.Show(i.getItem(t),this.app.config.fields,n),this.CreateMode=!1},e}(N),Q=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.prototype.config=function(){return{paddingX:16,paddingY:8,margin:0,rows:[this.GetButton(),this.GetList()]}},e.prototype.EditStart=function(t){var e=this;if(!this.ActiveId||this.ActiveId!=t){this.EditStop();var i=this.$$("list"),n=i.getItemNode(t);n.classList.add("active-editor"),n.innerHTML="",this.ActiveId=t,this.Active=this.ui(H,{container:n}),this.$$("list").attachEvent("onAfterRender",(function(){return e.EditStop()})),this.Active.Show(i.getItem(t),this.app.config.fields),this.CreateMode=!1}},e}(N),J={JetView:c};J.actions=B,J.bar=U,J.base=N,J.filter=H,J.list=Q,J.popup=z;var K=function(){function t(t){this._app=t}return t.prototype.data=function(t){var e=this._app.config.data;return"function"==typeof e?Promise.resolve(e(t)).then((function(e){return e.map((function(e){var i;return(i={})[t]=e,i}))})):Promise.resolve(e)},t.prototype.save=function(t){console.log(t)},t}();function W(t,e,i){if(!t||!t.rules.length)return function(){return!0};var n=t.rules.map((function(t){return function(t,e,i){return t.rules?W(t,e,i):function(n){var r=n[t.field];if(t.includes&&t.includes.length)return-1!==t.includes.findIndex((function(t){return t===r}));if(r){var o=t.condition.type;return(e[o]||e[i[t.field]][o])(r,t.condition.filter)}return!1}}(t,e,i)}));return("or"===t.glue?Y:Z)(n)}function Z(t){return function(e){for(var i=0;i<t.length;i++)if(!t[i](e))return!1;return!0}}function Y(t){return function(e){for(var i=0;i<t.length;i++)if(t[i](e))return!0;return!1}}var X=function(t){function e(e){var i=this,r=G({value:e.value||null}),o={router:w,version:"8.1.1",debug:!0};return(i=t.call(this,n(n({},o),e))||this).config.start="bar"===e.type?"/bar":"/list",i.config.params={state:r,simple:!0===e.simple},i.setService("backend",new(i.dynamic(K))(i)),i.use(T,i.config.locale||{lang:"en",webix:{en:"en-US"}}),i}return i(e,t),e.prototype.dynamic=function(t){return this.config.override&&this.config.override.get(t)||t},e.prototype.require=function(t,e){return"jet-views"===t?J[e]:"jet-locales"===t?et[e]:null},e.prototype.getState=function(){return this.config.params.state},e.prototype.GetFilter=function(){return function(t,e){var i=webix.filters,n={};return e.forEach((function(t){t.conditions&&t.conditions.forEach((function(t){"object"==typeof t&&(i[t.id]=t.handler)})),t.type&&(n[t.id]=t.type)})),W(t,i,n)}(this.config.params.state.value,this.config.fields)},e}(y);webix.protoUI({name:"query",app:X,getState:function(){return this.$app.getState()},getService:function(t){return this.$app.getService(t)},$init:function(){var t,e,i=this,n=this.getState();for(var r in n)O(n,this.config,r);n.$changes.attachEvent("value",(t=function(t,e){return i.callEvent("onChange",t,e)},e=!1,function(){if(e)return t.apply(this,arguments);e=!0}))},getFilterFunction:function(){return this.$app.GetFilter()}},webix.ui.jetapp);var tt={Backend:K},et={en:{"Add filter":"Add filter",in:"=",equal:"=",notEqual:"<>",less:"<",greater:">",greaterOrEqual:">=",lessOrEqual:"<=",contains:"contains",notContains:"not contains",beginsWith:"begins",notBeginsWith:"not begings",endsWith:"ends",notEndsWith:"not ends",between:"between",notBetween:"not between",and:"and",or:"or",Edit:"Edit","Add Filter":"Add Filter","Add Group":"Add Group",Delete:"Delete",Apply:"Apply",Cancel:"Cancel"}};t.App=X,t.locales=et,t.services=tt,t.views=J,Object.defineProperty(t,"__esModule",{value:!0})},"object"==typeof t&&"undefined"!=typeof module?K(t):"function"==typeof define&&define.amd?define(["exports"],K):K((J=J||self).query={});var X=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.prototype.config=function(){var t=this;this.State=this.getParam("state",!0);var e=this.app.getService("local");return{view:"query",localId:"query",css:"webix_rpt_query",locale:{lang:this.app.getService("locale").getLang()},data:function(i){var n=t.State.fields.find((function(t){return t.id===i}));return"boolean"===n.type?[0,1]:e.getFieldData(i,n.type)},fields:this.State.fields.filter((function(t){return"reference"!==t.type&&"picklist"!==t.type})).map((function(t){var e={id:t.id,value:t.name+" "+(t.model?"<span class='webix_rpt_sources_path'>"+t.model+"</span>":""),type:t.type};return"boolean"===e.type&&(e.conditions=["equal"],e.type="number"),e}))}},e.prototype.init=function(){var t=this;this.State=this.getParam("state",!0);var e=this.getRoot();this.on(this.State.$changes,"query",(function(t){e.$app.callEvent("applyFilter",[null]),e.config.value=t?tt(JSON.parse(t)):null})),e.getState().$observe("value",(function(e){t.State.query=e?JSON.stringify(e):""}))},e}(p);function tt(t){if(t.rules)t.rules.forEach(tt);else if("date"===t.type){var e=t.condition;e.filter&&"string"==typeof t.condition.filter&&(e.filter=new Date(e.filter)),e.filter.start&&"string"==typeof e.filter.start&&(e.filter.start=new Date(e.filter.start)),e.filter.end&&"string"==typeof e.filter.end&&(e.filter.end=new Date(e.filter.end))}return t}var et=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.prototype.config=function(){var t=this,e=this._=this.app.getService("locale")._;return{localId:"qblock",type:"clean",rows:[{type:"form",margin:5,padding:{bottom:5},rows:[{localId:"queryBar",visibleBatch:"def",cols:[{view:"label",label:e("Filtering query"),width:120},{},{batch:"query",view:"icon",localId:"delete",icon:"rpi-delete",tooltip:e("Delete"),click:function(){return t.DeleteQuery()}},{batch:"query",view:"icon",localId:"copy",icon:"rpi-content-copy",tooltip:e("Create copy"),click:function(){return t.CopyQuery()}},{batch:"query",view:"icon",localId:"rename",icon:"rpi-pencil",tooltip:e("Rename"),click:function(){return t.RenameQuery()}},{view:"button",disabled:!0,css:"webix_primary",localId:"save",label:e("Save"),tooltip:e("Save query"),width:150,click:function(){return t.SaveQuery(null)}}]},{view:"query-select",options:[],name:"id",css:"webix_rpt_qselect",localId:"qselect",suggest:{css:"webix_rpt_qselect_suggest",template:function(e){return t.QSelectTemplate(e)},body:{minHeight:25},on:{onShow:function(){this.getBody().$view.firstChild.getAttribute("placeholder")||this.getBody().$view.firstChild.setAttribute("placeholder",e("No saved queries"))}}},on:{onClearClick:function(){return t.NewQuery()}}},{autoheight:!0,borderless:!0,template:e("Save filter to use it in other reports"),css:"webix_rpt_description"}]},X]}},e.prototype.init=function(){var t=this;this.Local=this.app.getService("local");var e=this.State=this.getParam("state",!0),i=this.Queries=this.Local.getQueries();this.LocalState=H({id:"",saved:!0}),i.waitData.then((function(){var n,r=t.State.query,o=t.$$("qselect"),s=o.getList(),a=((n={})[t.State.data]=1,n);t.State.joins.forEach((function(t){return a[t.tid]=1})),i.filter((function(t){var e=!0;return t.models.forEach((function(t){a[t]||(e=!1)})),e})),s.sync(i),i.data.each((function(t){t.text==r&&o.setValue(t.id)})),t.on(e.$changes,"query",(function(e){var n=t.LocalState.id,r=!n&&e||n&&i.getItem(n).text!=e;t.LocalState.saved=!r}))})),Q(this.LocalState,"id",this.$$("qselect"),this);var n=this.$$("save");this.on(this.LocalState.$changes,"saved",(function(t){t?n.disable():n.enable()})),this.on(this.LocalState.$changes,"id",(function(e){if(e){var n=i.getItem(e);t.State.query=n.text,t.$$("queryBar").showBatch("query")}else t.$$("queryBar").showBatch("def")}))},e.prototype.NewQuery=function(){this.LocalState.id=null,this.LocalState.saved=!0,this.State.query=null},e.prototype.SaveQuery=function(t){var e=this,i=this.LocalState.id,n=this.State.query;if(i)return null===t&&(t=this.Queries.getItem(i).name),void this.Local.saveQuery(i,{name:t,text:n}).then((function(){e.$$("qselect").setValue(i),e.LocalState.saved=!0}));Y({text:this._("Enter query name"),button:this._("Save"),value:""}).then((function(t){t&&e.Local.saveQuery(null,{name:t,text:n}).then((function(t){e.LocalState.saved=!0,e.LocalState.id=t}))}))},e.prototype.RenameQuery=function(){var t=this,e=this.LocalState.id,i=this.Queries.getItem(e).name;Y({text:this._("Enter query name"),value:i,button:this._("Save")}).then((function(e){e&&t.SaveQuery(e)}))},e.prototype.CopyQuery=function(){var t=this,e=this.app.getService("locale")._,i=this.Queries.getItem(this.LocalState.id),n=i.name,r=i.text;n=e("Copy of")+" "+n,this.Local.saveQuery(null,{name:n,text:r}).then((function(e){t.LocalState.id=e}))},e.prototype.DeleteQuery=function(){var t=this,e=this.app.getService("locale")._;webix.confirm({title:e("Delete"),ok:e("Delete"),cancel:e("Cancel"),text:e("Are you sure to delete this query?")}).then((function(){var e=t.LocalState.id;t.Local.deleteQuery(e).then((function(){t.LocalState.$batch({saved:!0,id:null}),t.State.query=null}))}))},e.prototype.ShowMenu=function(t){var e=this;this.QueryMenu&&this.QueryMenu.$view||(this.QueryMenu=this.ui({view:"popup",body:{view:"list",borderless:!0,css:"webix_rpt_popup_menu",template:function(t){return e.GetMenuTemplate(t)},width:160,autoheight:!0,click:function(t){return e.ApplyQueryAction(t)},data:this.GetMenuOptions()}}));var i=this.QueryMenu.getBody();i.data.each((function(t){t.disabled=!e.LocalState.id})),i.refresh(),this.QueryMenu.show(t)},e.prototype.GetMenuOptions=function(){return[{id:"copy",value:"Copy",icon:"rpi-content-copy"},{id:"rename",value:"Rename",icon:"rpi-pencil"},{id:"delete",value:"Delete",icon:"rpi-delete"}]},e.prototype.GetMenuTemplate=function(t){return"<span class='webix_icon "+t.icon+"'></span>"+t.value},e.prototype.ApplyQueryAction=function(t){switch(this.QueryMenu.hide(),t){case"rename":this.RenameQuery();break;case"copy":this.CopyQuery();break;case"delete":this.DeleteQuery()}},e.prototype.QSelectTemplate=function(t){return t.value+" <span class='webix_icon wxi-close webix_rpt_qselect_icon'></span>"},e}(p),it=function(t){function e(e,i,n){var r=t.call(this,e,i)||this;return r.Master=n,r}return i(e,t),e.prototype.config=function(){var t=this;return{view:"popup",body:{view:"list",width:160,autoheight:!0,css:"webix_rpt_grouppopup",template:function(e){return t.GetPopupTemplate(e)},data:this.Master.config.modifiers,click:function(e){t.Master.setModifier(t.ActiveGroup,e),t.getRoot().hide()}}}},e.prototype.$init=function(){this.ActiveGroup=null},e.prototype.GetPopupTemplate=function(t){var e=t.id==this.Master.getModifier(this.ActiveGroup);return t.value+" <span class='webix_icon wxi-radiobox-"+(e?"marked":"blank")+"'></span>"},e.prototype.Show=function(t,e){this.ActiveGroup=e,this.getRoot().show(t,{x:-10}),this.getRoot().getBody().refresh()},e}(p),nt=function(t){function e(e,i,n){var r=t.call(this,e,i)||this;return r.Master=n,r}return i(e,t),e.prototype.config=function(){var t=this;return{view:"popup",body:{view:"list",css:"webix_rpt_popup_menu",width:160,autoheight:!0,template:function(e){return t.GetTemplate(e)},click:function(e){t.app.callEvent("summaryAction",[e]),t.getRoot().close()},data:this.GetOptions()}}},e.prototype.Show=function(t,e,i){this.SetActionStates(e,i),this.getRoot().show(t)},e.prototype.GetOptions=function(){return[{id:"delete",value:(0,this.app.getService("locale")._)("Delete"),icon:"rpi-delete"}]},e.prototype.SetActionStates=function(t){var e=this.getRoot().getBody();e.data.each((function(i){1==t.length?e.disableItem(i.id):e.enableItem(i.id)}))},e.prototype.GetTemplate=function(t){return"<span class='webix_icon "+t.icon+"'></span> "+t.value},e}(p),rt=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.prototype.config=function(){var t=this,e=this.app.getService("locale")._,i={margin:webix.skin.$active.layoutMargin.form,cols:[{view:"label",label:e("Function"),width:100,css:"webix_rpt_subtitle"},{view:"label",label:e("Column"),css:"webix_rpt_subtitle"},{view:"label",label:e("New column name"),css:"webix_rpt_subtitle"},{width:38}]},n={margin:webix.skin.$active.layoutMargin.form,localId:"summaries",view:"form",type:"clean",css:"webix_rpt_summary_form",elements:[]};return{borderless:!0,type:"clean",rows:[{cols:[{view:"label",label:e("Group summaries")}]},i,n,{height:webix.skin.$active.layoutMargin.form},{view:"button",icon:"wxi-plus",type:"icon",label:e("Add column"),width:210,align:"left",click:function(){return t.AddNewAggregation()}}]}},e.prototype.init=function(){var t=this;this.State=this.getParam("state",!0),this.GroupState=this.getParam("group",!0),this.SummaryColumns=this.State.fields.filter((function(t){return("number"==t.type||"date"==t.type)&&!t.key})).sort((function(t,e){return t.type<e.type?1:-1})).map((function(t){return{id:t.id,value:t.name,type:t.type}})),this.CreateForm(),this.on(this.app,"summaryAction",(function(e){return t.ApplyAction(e)})),this.on(this.GroupState.$changes,"by",(function(){return t.ValidateFormData()}))},e.prototype.CreateForm=function(){var t=this.GroupState.columns;t&&t.length?this.LoadAggregations(t):this.AddNewAggregation(),this.SummaryColumns.length||this.ApplyOneRowMode()},e.prototype.ApplyOneRowMode=function(){var t=this.getRoot().getChildViews();t[3].hide(),t[4].hide()},e.prototype.AddNewAggregation=function(){this.AddAggregation(),this.Changed()},e.prototype.LoadAggregations=function(t){var e=this;t.forEach((function(t){e.AddAggregation(t)})),this.Changed()},e.prototype.AddAggregation=function(t){if(!(t=t||this.GetDefaultFormData()))return!1;var e=t.id||"form"+webix.uid();this.$$("summaries").addView(this.GetRowForm(e,t))},e.prototype.GetRowForm=function(t,e){var i=this,n=[{width:100,view:"richselect",name:"op",value:e.op||null,options:this.GetOperations(),on:{onChange:function(e){return i.Changed(t,"op",e)}}},{view:"richselect",name:"id",disabled:"count"==e.op,value:e.id||null,options:this.SummaryColumns,on:{onChange:function(e){return i.Changed(t,"id",e)}}},{view:"text",value:e.name||null,name:"name",on:{onTimedKeypress:function(e){return i.Changed(t,"name",e)}}}];return n.push({view:"icon",icon:"wxi-dots",click:function(t,e){return i.ShowPopup(t,e)}}),{view:"form",localId:t,type:"clean",borderless:!0,margin:webix.skin.$active.layoutMargin.form,rules:{id:function(t){var e=i.GroupState.by;return!e||e.indexOf(t)<0}},cols:n}},e.prototype.GetDefaultFormData=function(){var t=this.GetData(),e=this.SummaryColumns,i=this.GetOperations();if(!e.length){var n=t.length?null:i.find((function(t){return"count"==t.id}));return n?{op:"count",id:"",name:this.NewColumnTemplate(n),type:"number"}:null}for(var r=0;r<i.length;r++)for(var o=function(n){var o=i[r];if(!t.find((function(t){return t.op==o.id&&("count"==o.id||t.id==e[n].id)})))return{value:{op:o.id,id:"count"!=o.id?e[n].id:null,name:s.NewColumnTemplate(o,e[n]),type:e[n].type}}},s=this,a=0;a<e.length;a++){var u=o(a);if("object"==typeof u)return u.value}return null},e.prototype.NewColumnTemplate=function(t,e){return"count"==t.id?t.value:t.value+" "+e.value},e.prototype.ShowPopup=function(t,e){this.Popup&&this.Popup.$view||(this.Popup=this.ui(nt));var i=webix.$$(t).getParentView();this.ActiveForm=i,this.Popup.Show(e.target,this.GetData(),i.getParentView().index(i))},e.prototype.ApplyAction=function(t){"delete"==t&&this.DeleteAggregation()},e.prototype.DeleteAggregation=function(t){var e=(t=t||this.ActiveForm).getParentView();e.getChildViews().length>1?e.removeView(t):t.setValues({}),this.Changed()},e.prototype.GetOperations=function(){var t=this.app.getService("locale")._;return[{id:"sum",value:t("Sum")},{id:"count",value:t("Count")},{id:"avg",value:t("Average")},{id:"max",value:t("Max")},{id:"min",value:t("Min")}]},e.prototype.GetData=function(){var t=[];return this.ForEachFormRow((function(e){t.push(e.getValues())})),t},e.prototype.ForEachFormRow=function(t){this.$$("summaries").getChildViews().forEach((function(e){e&&e.elements&&t(e)}))},e.prototype.ValidateFormData=function(){var t=!0;return this.ForEachFormRow((function(e){return t=e.validate()&&t})),t},e.prototype.ChangeNewColumnName=function(t){var e=this.$$(t).elements,i=e.op.getValue(),n=e.id.getValue(),r=this.GetOperations();i&&("count"==i?e.name.setValue(this.NewColumnTemplate(r.find((function(t){return t.id==i})))):n&&e.name.setValue(this.NewColumnTemplate(r.find((function(t){return t.id==i})),this.SummaryColumns.find((function(t){return t.id==n})))))},e.prototype.Changed=function(t,e,i){var n=this;"op"!=e&&"id"!=e||this.ChangeNewColumnName(t),"op"==e&&"count"==i?(this.$$(t).elements.id.setValue(null),this.$$(t).elements.id.disable()):t&&e&&this.$$(t).elements.id.enable(),this.ValidateFormData();var r=this.GetData();r.forEach((function(t){return t.type=(n.SummaryColumns.find((function(e){return e.id==t.id}))||{type:"number"}).type})),this.GroupState.columns=r},e}(p);webix.protoUI({name:"groupselect",$cssName:"text",defaults:{selectIcon:!0,modifiers:{}},renderModifier:function(t){var e=this._modifiers[t];if(e){var i=this.config.modifiers.find((function(t){return t.id===e}));return"<div class='webix_rpt_date_selector'>"+(i?i.value:"")+(this.config.selectIcon?"<span class='webix_icon wxi-angle-down'></span>":"")+"</div> | "}return""},$renderTag:function(t,e,i){var n=this.renderModifier(i);return n+="<span>"+t+"</span><span class='webix_multicombo_delete' role='button' aria-label='"+webix.i18n.aria.removeItem+"'>x</span>","<li class='webix_multicombo_value' style='line-height:"+e+"px;' optvalue='"+webix.template.escape(i)+"'>"+n+"</li>"},$init:function(){this._modifiers={},webix.extend(this.on_click,{webix_rpt_date_selector:function(t,e,i){var n=webix.html.locate(t,"optvalue");return this.callEvent("onModifierClick",[n,t,i]),!1}})},setValue:function(t){var e=this;return t?"string"!=typeof t&&"string"!=typeof t[0]&&(this._modifiers={},t=t.map((function(t){return e._modifiers[t.id]=t.mod||null,t.id}))):this._modifiers={},webix.ui.multicombo.prototype.setValue.call(this,t)},getModifier:function(t){return this._modifiers[t]},setModifier:function(t,e,i){this._modifiers[t]=e,i||this.callEvent("onChange",[]),this.refresh()},$setSize:function(t,e){var i=this.config,n=this._custom_last_size||[0,0],r=n[0],o=n[1];if((t!=r||e!=o)&&(this._custom_last_size=[t,e],webix.ui.view.prototype.$setSize.call(this,t,e))){if(!t||!e)return;"top"==i.labelPosition&&(i.labelWidth=0),this.render()}}},webix.ui.multicombo);var ot=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.prototype.config=function(){var t=this,e={margin:5,rows:[{autoheight:!0,borderless:!0,template:(0,this.app.getService("locale")._)("Specify columns to group by and output(s)"),css:"webix_rpt_description"},{view:"groupselect",localId:"groupBy",modifiers:this.GetDateOptions(),options:[],on:{onChange:function(){return t.ChangeGroupBy()},onModifierClick:function(e,i,n){return t.ShowModifierPopup(e,i,n)}}}]};return{view:"form",borderless:!0,padding:0,elements:[{localId:"groupByLayout",margin:webix.skin.$active.layoutMargin.form,rows:[e,rt]}]}},e.prototype.init=function(){var t=this;this.State=this.getParam("state",!0);var e=this.State.group||{};this.GroupState=H({by:e.by||null,columns:e.columns||null}),this.LoadColumns(),this.setParam("group",this.GroupState),this.on(this.GroupState.$changes,"*",G((function(){return t.Apply()})))},e.prototype.ChangeGroupBy=function(){var t=this.$$("groupBy"),e=t.getPopup().getList(),i=t.getValue();i=i?"string"==typeof i?i.split(","):i:[],this.GroupState.by=i.map((function(i){var n=t.getModifier(i);"date"!==e.getItem(i).type||n||(n="year",t.setModifier(i,n,!0));var r={id:i};return n&&(r.mod=n),r}))},e.prototype.FilterGroupByColumns=function(t){return"id"!=t.id},e.prototype.LoadColumns=function(){var t=this,e=this.State.fields.map((function(t){return{id:t.id,value:t.name,type:t.type,model:t.model}})),i=this.$$("groupBy").getPopup().getList();i.type.template=function(e){return t.ListTemplate(e)},i.parse(e),this.$$("groupBy").setValue(this.GroupState.by)},e.prototype.ListTemplate=function(t){return t.value+(t.model?"<span class='webix_rpt_sources_path'>"+t.model+"</span>":"")},e.prototype.ShowModifierPopup=function(t,e,i){var n=this;this.DatePopup||(this.DatePopup=this.ui(new it(this.app,"",this.$$("groupBy")))),webix.delay((function(){return n.DatePopup.Show(i,t)}))},e.prototype.GetDateOptions=function(){var t=this.app.getService("locale")._;return[{id:"day",value:t("Day")},{id:"month",value:t("Month")},{id:"year",value:t("Year")},{id:"yearmonth",value:t("Year")+"/"+t("Month")},{id:"yearmonthday",value:t("Year")+"/"+t("Month")+"/"+t("Day")}]},e.prototype.Apply=function(){var t=this.GroupState;this.State.group={by:t.by||null,columns:t.columns||[]}},e}(p),st=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.prototype.config=function(){var t=this,e=this.app.getService("locale")._,i={optionWidth:102,tabMinWidth:102,view:"tabbar",localId:"tabbar",css:"webix_rpt_editor_tabbar",type:"bottom",borderless:!0,options:[{id:"common",value:e("Common")},{id:"data",value:e("Query")},{id:"other",value:e("Data")},{id:"structure",value:e("View")}],on:{onChange:function(e){return t.ShowView(e)}}},n={width:490,hidden:!1,localId:"settings",rows:[{view:"toolbar",padding:{left:13,top:0,bottom:0},height:webix.skin.$active.barHeight+6,scroll:!1,cols:[i,{view:"icon",width:40,localId:"closeBtn",icon:"rpi-close",click:function(){return t.Hide()}}]},{$subview:!0}]};return this.Local=this.app.getService("local"),this.Local.ready(n)},e.prototype.init=function(){var t=this;this.AppState=this.app.getParam("state");var e=this.Local.newModule();e.id=-1;var i=this.State=H(e);this.setParam("state",this.State),this.on(this.AppState.$changes,"moduleId",(function(e){return t.ChangeModule(e)})),this.on(this.State.$changes,"data",(function(e,i,n,r){!e||r&&r.load||t.ChangeModel(e)})),this.on(this.AppState.$changes,"toolbar",(function(e){return t.ShowHideButton(e)})),this.on(this.State.$changes,"*",function(t,e){e=e||200;var i=null,n=null;return function(){var r=this;n=arguments,i||(i=setTimeout((function(){clearTimeout(i),i=null,t.apply(r,n)}),e))}}((function(){-1!==t.State.id&&(t.TrackChanges(),t.AppState.module=Object.assign({},t.State))}))),this.on(i.$changes,"group",(function(e,o,s,a){if(!e&&o)i.$batch({publicFields:null,columns:i.oldColumns||t.Local.getFields(i.data,i.joins,!0)});else if(e){var u=[];if(a&&a.load)u=r(t.State.columns);else if(o){if(JSON.stringify(e)==JSON.stringify(o))return;u=r(t.State.columns)}else i.oldColumns=i.columns;var l=e.columns.map((function(t){return{id:t.op+"."+t.id,name:t.name,type:"number",meta:{},model:""}}));e.by&&(l=l.concat(e.by.map((function(e){var i=t.State.fields.find((function(t){return t.id==e.id})),r=e.mod?e.mod+"."+e.id:e.id,o=n(n({},i),{id:r});return e.mod&&(o.type="text"),o}))));var c={};(i.publicFields||i.columns).forEach((function(t){return c[t.id]=1}));var p={};l.forEach((function(t){p[t.id]=1,c[t.id]||u.push(t)})),u=u.filter((function(t){return p[t.id]})),i.meta.freeze&&i.meta.freeze>=u.length&&delete i.meta.freeze,i.$batch({publicFields:l,columns:u})}})),this.on(this.app,"saveModule",(function(){var e=t.SaveData(),i=JSON.stringify(e);t.Local.saveModule(t.AppState.moduleId,{name:t.State.name,text:i}).then((function(e){t.AppState.$batch({moduleId:e,mode:"view",module:Object.assign({},t.AppState.module),saved:!0})}))})),this.on(this.app,"resetModule",(function(){return t.Reset()})),this.on(this.app,"onColumnResize",(function(e,i){var n=r(t.State.columns);n.find((function(t){return t.id==e})).width=i,t.State.columns=n})),this.on(this.AppState.$changes,"readonly",(function(e){e&&t.Reset()})),this.show("./editor.common")},e.prototype.ShowView=function(t){this.$$("tabbar").setValue(t),this.show("editor."+t)},e.prototype.Hide=function(){this.Reset()},e.prototype.Reset=function(){var t=this,e=this.AppState.moduleId;e?this.Local.getModule(e).then((function(e){t.AppState.$batch({mode:"view",module:Object.assign({},JSON.parse(e.text)),saved:!0})})):this.AppState.$batch({mode:"list",module:null,saved:!0})},e.prototype.ChangeModel=function(t){t&&this.State.$batch(this.Local.setDataSource(t))},e.prototype.ChangeModule=function(t){var e=this;this.InitStateValue="",t?this.Local.getModule(t).then((function(t){var i=JSON.parse(t.text);e.InitStateValue=t.text,e.InitName=i.name=t.name,i.id=t.id,i.saved=!0,i.fields=e.Local.getFields(i.data,i.joins),B({load:!0},(function(){return e.State.$batch(i)})),e.AppState.saved=!0})):(this.InitStateValue=null,this.State.$batch(this.Local.newModule()),this.State.fields=this.Local.getFields(this.State.data,this.State.joins),this.AppState.saved=!1)},e.prototype.TrackChanges=function(){this.AppState.saved=JSON.stringify(this.SaveData())==this.InitStateValue&&this.State.name==this.InitName},e.prototype.SaveData=function(){var t=this.State;return{desc:t.desc,data:t.data,joins:t.joins,query:t.query,columns:t.columns,group:t.group,meta:t.meta,sort:t.sort,type:t.type}},e.prototype.ShowHideButton=function(t){t?this.$$("closeBtn").show():this.$$("closeBtn").hide()},e}(p),at=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.prototype.config=function(){var t=this,e=this.app.getService("locale")._;return{type:"form",rows:[{cols:[{view:"switch",localId:"groupBySwitch",css:"webix_rpt_title",width:65,on:{onChange:function(e){return t.ToggleGroupBy(e)}}},{view:"label",label:e("Group")}]},{$subview:"_hidden",name:"group"},{cols:[{view:"switch",localId:"sortBySwitch",css:"webix_rpt_title",width:65,on:{onChange:function(e){return t.ToggleSortBy(e)}}},{view:"label",label:e("Sort")}]},{$subview:"_hidden",name:"sort"},{gravity:1e-6}]}},e.prototype.init=function(){this.State=this.getParam("state",!0),this.$$("groupBySwitch").setValue(!!this.State.group),this.$$("sortBySwitch").setValue(!!this.State.sort)},e.prototype.ToggleGroupBy=function(t){t?this.show("./editor.groups",{target:"group"}):(this.State.group=null,this.show("_hidden",{target:"group"}))},e.prototype.ToggleSortBy=function(t){t?this.show("./editor.sorts",{target:"sort"}):(this.State.sort=null,this.show("_hidden",{target:"sort"}))},e}(p),ut=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.prototype.config=function(){var t=this;return{rows:[{view:"label",label:(0,this.app.getService("locale")._)("Specify columns to sort by"),css:"webix_rpt_subtitle"},{view:"groupselect",localId:"sortBy",selectIcon:!1,css:"webix_rpt_sort_selector",modifiers:[{id:"asc",value:"<span class='webix_icon rpi-sort-alphabetical-ascending'></span>"},{id:"desc",value:"<span class='webix_icon rpi-sort-alphabetical-descending'></span>"}],options:[],on:{onChange:function(){return t.ChangeSortBy()},onModifierClick:function(e){return t.ChangeDirection(e)}}}]}},e.prototype.init=function(){var t=this;this.State=this.getParam("state",!0),this.on(this.State.$changes,"publicFields",(function(e){e&&t.LoadColumns()})),this.on(this.State.$changes,"fields",(function(){t.State.publicFields||t.LoadColumns()}))},e.prototype.LoadColumns=function(){var t=this,e=(this.State.publicFields||this.State.fields).map((function(t){return{id:t.id,value:t.name,type:t.type,model:t.model}})),i=this.$$("sortBy"),n=i.getPopup().getList();n.type.template=function(e){return t.ListTemplate(e)},n.clearAll(),n.parse(e);var r=this.State.sort;r&&(r=r.filter((function(t){return!!e.find((function(e){return e.id==t.id}))}))),i.setValue(r)},e.prototype.ListTemplate=function(t){return t.value+(t.model?"<span class='webix_rpt_sources_path'>"+t.model+"</span>":"")},e.prototype.ChangeSortBy=function(){var t=this.$$("sortBy"),e=t.getValue(),i=(e=e?"string"==typeof e?e.split(","):e:[]).map((function(e){var i=t.getModifier(e);i||(i="asc",t.setModifier(e,i,!0));var n={id:e};return i&&(n.mod=i),n}));this.State.sort=i.length?i:null},e.prototype.ChangeDirection=function(t){var e=this.$$("sortBy");e.setModifier(t,"asc"===e.getModifier(t)?"desc":"asc")},e}(p),lt=function(t){function e(e,i,n,r){var o=t.call(this,e,i)||this;return o.Axis=n,o.ChartState=r,o}return i(e,t),e.prototype.config=function(){var t=this.app.getService("locale")._;return this.Charts=this.app.getService("charts"),{view:"form",borderless:!0,elementsConfig:{labelAlign:"right",labelWidth:190},visibleBatch:"default",rows:[{label:t("Logarithmic scale"),view:"checkbox",name:"logarithmic",hidden:!0},{label:t("Title"),view:"text",name:"title"},{label:t("Color"),view:"colorpicker",name:"color",css:"webix_rpt_colorpicker",suggest:{padding:0,type:"colorselect",body:{button:!0}}},{cols:[{labelWidth:190,label:t("Gridlines"),view:"checkbox",name:"lines"},{view:"colorpicker",name:"lineColor",width:150,css:"webix_rpt_colorpicker",suggest:{padding:0,type:"colorselect",body:{button:!0}}}]},{label:t("Vertical labels"),view:"checkbox",name:"verticalLabels",hidden:!0}]}},e.prototype.init=function(){var t=this;this.on(this.Axis.$changes,"id",(function(e){"y"==e?t.ApplyYAxis():t.ApplyXAxis()})),this.on(this.Axis.$changes,"lines",(function(e){var i=t.getRoot().elements.lineColor;e?i.show():i.hide()})),Q(this.Axis,"*",this.getRoot())},e.prototype.ApplyYAxis=function(){this.getRoot().elements.logarithmic.show()},e.prototype.ApplyXAxis=function(){this.getRoot().elements.verticalLabels.show()},e}(p),ct=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.prototype.HideField=function(t){this.$$("fields").updateItem(t,{show:!1}),this.SaveOrder()},e.prototype.ShowField=function(t){this.$$("fields").updateItem(t,{show:!0}),this.SaveOrder()},e.prototype.HideAllEditors=function(t,e){var i=this;e||(e="fields"),this._ActiveEditor[e]&&this.$$(e).closeSub(this._ActiveEditor[e]),this._ActiveEditor[e]=t,t&&webix.delay((function(){return i.$$(e).getSubView(t).focus()}),null,null,100)},e.prototype.ResetEditor=function(t){this._ActiveEditor[t||"fields"]=null},e.prototype.ToggleSub=function(t,e){var i=this.$$(e||"fields");i.getItem(t).$subopen?i.closeSub(t):i.openSub(t)},e.prototype.SaveOrder=function(){},e}(p),pt=function(t){function e(e,i,n){var r=t.call(this,e,i)||this;return r.State=n,r.Id=null,r}return i(e,t),e.prototype.config=function(){var t=this;return{view:"popup",body:{view:"colorselect",button:!0,on:{onColorSelect:function(e){var i=t.GetSeries(t.Id);i&&(i.meta.color=e),t.State.updatedSeries=t.Id,t.getRoot().close()}}}}},e.prototype.Show=function(t,e){var i=this.getRoot();this.Id=e,i.show(t),i.getBody().setValue(this.GetSeries(e).meta.color)},e.prototype.GetSeries=function(t){return this.State.series.find((function(e){return e.id==t}))},e}(p);webix.protoUI({name:"text-search",$cssName:"search",defaults:{closeIcon:"wxi-close",template:function(t,e){var i=e.$renderInput(t);return(t.badge||0===t.badge)&&(i=i.replace(new RegExp("</div>$"),"<span class='webix_badge'>"+t.badge+"</span></div>")),i}},on_click:{webix_input_icon:function(t){var e=t.target.className;this.getInputNode().focus(),e.indexOf(this.config.closeIcon)>-1?(this.setValue(""),this.callEvent("onCloseIconClick",[t]),this.hideCloseIcon()):this.callEvent("onSearchIconClick",[t])}},$init:function(){var t=this;this.attachEvent("onTimedKeyPress",(function(){return t._onSearch()})),this.attachEvent("onChange",(function(){return t._onSearch()}))},_onSearch:function(){var t=this.getValue();t?this.showCloseIcon():this.hideCloseIcon(),this.callEvent("onSearchChange",[t])},setIcon:function(t){var e=this.$view.getElementsByClassName("webix_input_icon");e.length&&(e[0].className="webix_input_icon "+t)},showCloseIcon:function(){this.setIcon(this.config.closeIcon)},hideCloseIcon:function(){this.setIcon(this.config.icon)},setBadge:function(t){var e=this.$view.querySelector(".webix_badge");t||0===t?e?e.innerHTML=""+t:(e=webix.html.create("SPAN",{class:"webix_badge"},""+t),this.$view.querySelector(".webix_el_box").appendChild(e)):e&&webix.html.remove(e),this.config.badge=t}},webix.ui.search);var ht=function(t){function e(e,i,n,r){var o=t.call(this,e,i)||this;return o.Series=n,o.ChartState=r,o}return i(e,t),e.prototype.config=function(){var t=this,e=this.app.getService("locale")._;return this.Charts=this.app.getService("charts"),{view:"form",borderless:!0,elementsConfig:{labelWidth:170},visibleBatch:"default",rows:[{labelAlign:"right",label:e("Title"),view:"text",name:"name"},{labelAlign:"right",label:e("Color"),view:"colorpicker",name:"color",css:"webix_rpt_colorpicker",suggest:{padding:0,type:"colorselect",body:{button:!0}}},{labelAlign:"right",label:e("Marker type"),view:"richselect",css:"webix_rpt_markerselect",name:"markerType",options:{padding:0,body:{css:"webix_rpt_markerselect_list",template:function(e){return t.ItemListTemplate(e)},data:this.Charts.getItemTypes()}},batch:"marker"},{labelAlign:"right",label:e("Fill marker"),view:"checkbox",name:"fillMarker",batch:"marker"}]}},e.prototype.init=function(){Q(this.Series,"*",this.getRoot()),this.Charts.itemSupport.indexOf(this.ChartState.chartType)>-1&&this.getRoot().showBatch("marker")},e.prototype.ItemListTemplate=function(t){return'<div class="webix_rpt_config_row">'+t.value+" <span class='webix_icon "+t.icon+"' style='color:"+this.Series.color+"'></span></div>"},e}(p),ft=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.prototype.config=function(){var t=this,e=this._=this.app.getService("locale")._;this.Charts=this.app.getService("charts"),this.Local=this.app.getService("local"),this._ActiveEditor={};var i={rows:[{view:"label",label:this._("Chart type")},{view:"richselect",localId:"type",options:this.Charts.getTypes(),on:{onChange:function(e){return t.ChartState.chartType=e}}}]},r={rows:[{view:"label",label:e("X axis column")},{view:"richselect",localId:"labelColumn",options:[],on:{onChange:function(e){return t.ChangeLabelField(e)}}}]},o={view:"datatable",css:"webix_rpt_columns_list",localId:"fields",borderless:!0,autoheight:!0,header:!1,select:!1,editable:!0,subview:function(e,i){t.SubState||(t.SubState={});var n=t.SubState[e.id]=H({name:e.meta.name,color:e.meta.color,type:e.meta.type||null,markerType:e.meta.markerType||null,fillMarker:e.meta.fillMarker||null});t.on(n.$changes,"*",G((function(){t.UpdateSeries(e.id,n)})));var r=new ht(t.app,"",n,t.ChartState);return t.ui(r,{container:i}),r.getRoot()},columns:[{fillspace:!0,template:function(e,i){return t.RowTemplate(e,i)}}],drag:"order",on:{onItemDblClick:function(t){this.openSub(t)},onAfterRender:function(){if(t._hasFocus){var e=t._hasFocus;t._hasFocus=null,e&&document.contains(e)&&e!==document.activeElement&&e.focus()}},onAfterDrop:function(){return t.SaveOrder()},onSubViewOpen:function(e){return t.HideAllEditors(e)},onSubViewClose:function(){return t.ResetEditor()}},onClick:{webix_rpt_chart_color:function(e,i){return t.ShowColorPopup(e,i)},"action-visible":function(e,i){return t.HideField(i)},"action-hidden":function(e,i){return t.ShowField(i)},webix_rpt_config_row_name:function(e,i){return t.ToggleSub(i)}}},s={rows:[{view:"label",label:e("Axes")},{view:"datatable",css:"webix_rpt_columns_list",localId:"axisFields",borderless:!0,autoheight:!0,header:!1,select:!1,subview:function(e,i){var r=H(n({id:e.id},e.meta));t.on(r.$changes,"*",G((function(){t.UpdateAxis(e.id,r)})));var o=new lt(t.app,"",r,t.ChartState);return t.ui(o,{container:i}),o.getRoot()},columns:[{fillspace:!0,template:function(e,i){return t.AxisRowTemplate(e,i)}}],on:{onItemClick:function(e){return t.ToggleSub(e,"axisFields")},onAfterRender:function(){if(t._hasFocus){var e=t._hasFocus;t._hasFocus=null,e&&document.contains(e)&&e!==document.activeElement&&e.focus()}},onSubViewOpen:function(e){return t.HideAllEditors(e,"axisFields")},onSubViewClose:function(){return t.ResetEditor("axisFields")}}}]},a={rows:[{view:"label",label:e("Legend")},{view:"radio",localId:"legendPosition",options:[{id:"bottom",value:e("Bottom")},{id:"right",value:e("Right")},{id:"none",value:e("None")}],on:{onChange:function(e){return t.ChangeLegend(e)}}}]};return{view:"form",scroll:"auto",css:"webix_rpt_chart_config",padding:{top:webix.skin.$active.layoutPadding.toolbar},rows:[i,r,{localId:"dataInputs",rows:this.GetDataInputs()},o,s,a,{}]}},e.prototype.init=function(){var t=this;this.State=this.getParam("state",!0),this.Types=this.Charts.getTypes();var e=[];(this.State.publicFields||this.State.fields).forEach((function(t){e.push(n({},t))})),this.Fields=e.filter((function(t){return!t.key})).sort((function(t,e){return t.type<e.type?1:-1})).map((function(t){return{id:t.id,value:t.name,type:t.type}})),this.ValueFields=e.filter((function(t){return"number"==t.type&&!t.key})).map((function(t){return{id:t.id,value:t.name,type:t.type,model:t.model}})),this.ChartState=H(this.GetInitState()),this.on(this.ChartState.$changes,"*",(function(){t.UpdateModuleState()})),this.on(this.ChartState.$changes,"chartType",(function(e,i){t.ApplyChartType(e,i)})),this.on(this.ChartState.$changes,"seriesFrom",(function(e,i){t.ApplySeriesFrom(e,i)})),this.on(this.ChartState.$changes,"baseColumn",G((function(){t.GenerateSeries()}))),this.on(this.ChartState.$changes,"dataColumn",G((function(){t.GenerateSeries()}))),this.on(this.ChartState.$changes,"updatedSeries",(function(e){e&&(t.$$("fields").refresh(e),t.SubState&&t.SubState[e]&&(t.SubState[e].color=t.ChartState.series.find((function(t){return t.id==e})).meta.color),t.ChartState.updatedSeries=null)})),this.$$("type").setValue(this.ChartState.chartType),this.$$("labelColumn").getList().parse(this.Fields),this.$$("labelColumn").setValue(this.ChartState.labelColumn),this.$$("seriesFrom").setValue(this.ChartState.seriesFrom),this.$$("baseColumn").getList().parse(this.Fields),this.$$("baseColumn").setValue(this.ChartState.baseColumn),this.$$("dataColumn").getList().parse(this.ValueFields),this.$$("dataColumn").setValue(this.ChartState.dataColumn),this.$$("legendPosition").setValue(this.ChartState.legendPosition)},e.prototype.ChangeLabelField=function(t){this.ChartState.labelColumn=t},e.prototype.ChangeLegend=function(t){this.ChartState.legendPosition=t},e.prototype.GetInitState=function(){var t=this.State.meta.chart||{};return{chartType:t.chartType||this.Charts.type,labelColumn:t.labelColumn||null,updatedSeries:null,seriesFrom:t.seriesFrom||"columns",baseColumn:t.baseColumn||null,dataColumn:t.dataColumn||null,series:t.series||null,legend:t.legend||{layout:"x"},axises:t.axises||null,legendPosition:t.legendPosition||"bottom"}},e.prototype.ApplyChartType=function(t,e){this.ShowAxisInputs(t),this.RenderSeries(e)},e.prototype.RenderSeries=function(t){var e=this.ChartState.series;e&&void 0===t?this.LoadSeries(e):this.GenerateSeries()},e.prototype.ShowAxisInputs=function(t){this.Charts.noAxisSupport.indexOf(t)?(this.ChartState.axises||(this.ChartState.axises={x:{title:"",color:"#edeff0",lineColor:"#edeff0",lines:!0,verticalLabels:!0},y:{title:"",color:"#edeff0",lineColor:"#edeff0",lines:!0,logarithmic:!1}}),this.$$("axisFields").data.count()||this.$$("axisFields").parse([{id:"x",meta:n({},this.ChartState.axises.x)},{id:"y",meta:n({},this.ChartState.axises.y)}])):(this.ChartState.axises=null,this.$$("axisFields").clearAll())},e.prototype.GetDataInputs=function(){var t=this;return[{rows:[{view:"label",label:this._("Data series")},{cols:[{rows:[{view:"label",label:this._("Extract series from"),css:"webix_rpt_subtitle"},{view:"radio",width:200,localId:"seriesFrom",options:[{id:"columns",value:this._("columns")},{id:"rows",value:this._("rows")}],on:{onChange:function(e){return t.ChartState.seriesFrom=e}}}]},{hidden:!0,localId:"baseColumnLayout",margin:webix.skin.$active.layoutMargin.form,cols:[{rows:[{view:"label",label:this._("Keys column"),css:"webix_rpt_subtitle"},{view:"richselect",css:"webix_rpt_subtitle",localId:"baseColumn",options:[],labelPosition:"top",on:{onChange:function(e){return t.ChartState.baseColumn=e}}}]},{rows:[{view:"label",label:this._("Values column"),css:"webix_rpt_subtitle"},{view:"richselect",css:"webix_rpdataColumnt_subtitle",localId:"dataColumn",options:[],on:{onChange:function(e){return t.ChartState.dataColumn=e}}}]}]}]}]}]},e.prototype.ApplySeriesKeys=function(t){var e=this,i=[],n=0;t.forEach((function(t){var r={id:t.id,name:t.value,model:t.model||null,show:!0,meta:{name:t.value,color:e.Charts.colors[n]||e.Charts.colors[0]}};n++,-1!=e.Charts.itemSupport.indexOf(e.ChartState.type)&&(r.meta.markerType="r",r.meta.fillMarker=!1),i.push(r)})),this.ChartState.series=i,this.LoadSeries(i)},e.prototype.LoadSeries=function(t){t.length?this.$$("fields").show():this.$$("fields").hide(),this.$$("fields").clearAll(),this.$$("fields").parse(t)},e.prototype.GetRowKeys=function(t){if(t&&this.State.columns.length){var e=[];return this.GetData(t).then((function(i){var n=i[0],r=i[1];return n.forEach((function(i){var n=i[t];-1==e.indexOf(n)&&e.push(n)})),r?e.map((function(t){var e=r.data.find((function(e){return e.id==t}))||null;return{id:t,value:e?e.value:t}})):e.map((function(t){return{id:t,value:t}}))}))}return Promise.resolve([])},e.prototype.GenerateSeries=function(){var t=this;if("columns"==this.ChartState.seriesFrom)this.ApplySeriesKeys(r(this.ValueFields),null);else{this.ChartState.dataColumn=this.$$("dataColumn").getValue();var e=this.ChartState.baseColumn=this.$$("baseColumn").getValue();this.GetRowKeys(e).then((function(i){return t.ApplySeriesKeys(i,e)}))}},e.prototype.ApplySeriesFrom=function(t,e){this.$$("baseColumnLayout")&&("columns"==t?(this.$$("baseColumnLayout").hide(),this.$$("baseColumn").setValue(null)):this.$$("baseColumnLayout").show(),e&&this.GenerateSeries())},e.prototype.UpdateSeries=function(t,e){this._hasFocus=document.activeElement;var i=r(this.ChartState.series),n=i.findIndex((function(e){return e.id==t}));Object.assign(i[n].meta,e),this.ChartState.series=i,this.$$("fields").refresh(t)},e.prototype.UpdateAxis=function(t,e){this._hasFocus=document.activeElement;var i=n({},this.ChartState.axises);Object.assign(i[t],e),this.ChartState.axises=i},e.prototype.RowTemplate=function(t,e){var i="<div class='webix_rpt_config_row'><div class='webix_icon rpi-drag-vertical'></div>";return i+="<span class='webix_icon "+(t.show?"action-visible rpi-eye":"action-hidden rpi-eye-off-outline")+"'></span>",i+="<div class='webix_rpt_chart_color' style='background:"+t.meta.color+"'> </div>",i+="<div class='webix_rpt_config_row_name'>"+t.name+(t.model?"<span class='webix_rpt_sources_path'>"+t.model+"</span>":"")+"</div>",(i+=e.subrow(t,e))+"</div>"},e.prototype.GetData=function(t){var e=this.app.getParam("state"),i=this.Local.getDataConfig(e.module);i.columns=this.State.columns.map((function(t){return t.id}));var n=[this.Local.getData(i)];return t&&n.push(this.Local.getOptionsList(t)),Promise.all(n)},e.prototype.ShowColorPopup=function(t,e){this.ColorPopup&&this.ColorPopup.$view||(this.ColorPopup=this.ui(new pt(this.app,"",this.ChartState))),this.ActiveSeries=e,this.ColorPopup.Show(t.target,e)},e.prototype.SaveOrder=function(){var t=this,e=this.$$("fields"),i=[];e.data.each((function(e){e.show&&i.push((t.State.publicFields||t.State.fields).find((function(t){return t.id===e.id})))})),this.ChartState.series=e.serialize()},e.prototype.UpdateModuleState=function(){var t=this,e=this.ChartState,i=[];e.labelColumn&&this.AddColumn(i,e.labelColumn),"columns"==e.seriesFrom?e.series&&e.series.forEach((function(e){e.show&&t.AddColumn(i,e.id)})):(e.baseColumn&&this.AddColumn(i,e.baseColumn),e.dataColumn&&this.AddColumn(i,e.dataColumn)),this.State.$batch({columns:i,meta:n(n({},this.State.meta),{chart:this.ChartState})})},e.prototype.AddColumn=function(t,e){var i=(this.State.publicFields||this.State.fields).find((function(t){return t.id===e}));i&&t.push(i)},e.prototype.AxisRowTemplate=function(t,e){var i="<div class='webix_rpt_config_row'>"+this._("x"==t.id?"X Axis":"Y Axis");return(i+=e.subrow(t,e))+"</div>"},e}(ct),dt=function(t){function e(e,i,n){var r=t.call(this,e,i)||this;return r.Column=n,r}return i(e,t),e.prototype.config=function(){var t=this.app.getService("locale")._;return{view:"form",borderless:!0,elementsConfig:{labelWidth:120},rows:[{labelAlign:"right",label:t("Title"),view:"text",name:"name"},{labelAlign:"right",label:t("Filter"),view:"richselect",name:"header",options:[{id:"none",value:"None"},{id:"text",value:"Text"},{id:"select",value:"Select"}]}]}},e.prototype.init=function(){Q(this.Column,"*",this.getRoot())},e}(p),vt=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.prototype.config=function(){var t=this._=this.app.getService("locale")._,e={rows:[{view:"label",label:t("Labels column")},{view:"richselect",name:"label",options:[]}]},i={rows:[{view:"label",label:t("Values column")},{view:"richselect",name:"value",options:[]}]},n={rows:[{view:"label",label:t("Color column")},{view:"richselect",name:"color",options:[]}]};return{view:"form",scroll:!1,padding:{top:webix.skin.$active.layoutPadding.toolbar},rows:[i,e,n,{}]}},e.prototype.init=function(){var t=this;this.State=this.getParam("state",!0),this.Local=this.app.getService("local");var e=this.Fields=(this.State.publicFields||this.State.fields).map((function(t){return n({},t)})),i=e.filter((function(t){return"number"==t.type})),r=this.getRoot().elements,o=r.label;o.getList().parse(e),o.getList().type.template=function(e){return t.ListTemplate(e)},o.setValue(this.State.meta.label||e[0].id);var s=r.value;s.getList().parse(i),s.getList().type.template=function(e){return t.ListTemplate(e)},s.setValue(this.State.meta.value||i[0].id);var a=r.color;a.getList().parse(i),a.getList().type.template=function(e){return t.ListTemplate(e)},a.setValue(this.State.meta.color||i[0].id),this.getRoot().attachEvent("onChange",(function(){return t.OnChange()})),this.State.meta.value||this.OnChange()},e.prototype.OnChange=function(){this.Apply(n(n({},this.State.meta),this.getRoot().getValues()))},e.prototype.Apply=function(t){var e=[t.value,t.label,t.color],i=this.Fields.filter((function(t){return-1!==e.indexOf(t.id)}));this.State.$batch({meta:t,columns:i})},e.prototype.ListTemplate=function(t){return t.name+(t.model?"<span class='webix_rpt_sources_path'>"+t.model+"</span>":"")},e}(ct),gt=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.prototype.config=function(){var t=this,e=this.app.getService("locale")._,i={view:"richselect",localId:"select",borderless:!0,align:"left",inputWidth:170,options:[{id:"table",value:W.table+" "+e("Table")},{id:"chart",value:W.chart+" "+e("Chart")},{id:"heatmap",value:W.heatmap+" "+e("Heatmap")}],on:{onChange:function(e){return t.ChangeReportType(e)}}},n={width:480,hidden:!1,localId:"settings",type:"clean",rows:[{view:"form",padding:{left:webix.skin.$active.layoutPadding.form,top:5,bottom:0},scroll:!1,cols:[i]},{$subview:!0}]};return this.Local=this.app.getService("local"),n},e.prototype.init=function(){var t=this;this.State=this.getParam("state",!0),this.on(this.State.$changes,"type",(function(e){t.show("editor.structure."+e)})),this.$$("select").setValue(this.State.type)},e.prototype.ChangeReportType=function(t){this.State.type!=t&&this.State.$batch({type:t,meta:{}})},e}(p),mt=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.prototype.config=function(){var t=this,e=this._=this.app.getService("locale")._;this._ActiveEditor={};var i={padding:{top:webix.skin.$active.layoutPadding.toolbar},rows:[{view:"label",label:e("Columns")},{view:"text-search",localId:"search",on:{onSearchChange:function(){return t.FilterFields()}}}]},n={view:"datatable",css:"webix_rpt_columns_list",localId:"fields",borderless:!0,autoheight:!0,header:!1,select:!1,subview:function(e,i){var n=H({name:e.meta.name||e.name,header:e.meta.header||"none"});t.on(n.$changes,"*",G((function(){t.Update(e.id,n)})));var r=new dt(t.app,"",n);return t.ui(r,{container:i}),r.getRoot()},columns:[{fillspace:!0,template:function(e,i){return t.RowTemplate(e,i)}}],drag:"order",on:{onItemDblClick:function(t){"$freeze"!==t.row&&this.openSub(t)},onBeforeDrag:function(e){t.HideAllEditors();var i=t.$$("fields");if(webix.html.addCss(i.$view,"webix_rpt_drag"),"$freeze"===e.start)e.html='<div class="webix_drag_zone"><div class="webix_dd_drag wbx-mark_frozen" style="width:'+i.$width+'px;"><div>'+t.FrozenTemplate()+"</div></div></div>";else if(!i.getItem(e.start).show)return!1},onAfterRender:function(){if(t._hasFocus){var e=t._hasFocus;t._hasFocus=null,e&&document.contains(e)&&e!==document.activeElement&&e.focus()}},onAfterDrop:function(){webix.html.removeCss(t.$$("fields").$view,"webix_rpt_drag"),t.SaveOrder()},onSubViewOpen:function(e){return t.HideAllEditors(e)},onSubViewClose:function(){return t.ResetEditor()}},onClick:{"action-visible":function(e,i){return t.HideField(i)},"action-hidden":function(e,i){return t.ShowField(i)},webix_rpt_config_row_name:function(e,i){return t.ToggleSub(i)}}};return{view:"form",scroll:"auto",padding:{top:webix.skin.$active.layoutPadding.toolbar},rows:[i,n]}},e.prototype.init=function(){this.State=this.getParam("state",!0);var t=this.$$("fields"),e={},i=this.State.columns.map((function(t){return e[t.id]=1,n(n({},t),{show:!0})}));(this.State.publicFields||this.State.fields).forEach((function(t){e[t.id]||i.push(n(n({},t),{show:!1}))})),i.splice(this.State.meta.freeze||0,0,{id:"$freeze",$css:"wbx-mark_frozen",name:this.FrozenTemplate()}),t.parse(i)},e.prototype.FilterFields=function(){var t=this.$$("search").getValue().toLowerCase();this.$$("fields").filter((function(e){return-1!==e.name.toLowerCase().indexOf(t)}))},e.prototype.Update=function(t,e){this._hasFocus=document.activeElement;var i=r(this.State.columns),o=i.findIndex((function(e){return e.id==t}));Object.assign(i[o].meta,e),this.State.$batch({columns:i,meta:n(n({},this.State.meta),{freeze:this.GetFreeze()})})},e.prototype.GetFreeze=function(){for(var t=this.$$("fields"),e=t.data.order,i=0,n=0;n<e.length&&"$freeze"!==e[n];n++)i+=t.getItem(e[n]).show?1:0;return i},e.prototype.SaveOrder=function(){var t=this,e=this.$$("fields"),i=[];e.data.each((function(e){e.show&&i.push((t.State.publicFields||t.State.fields).find((function(t){return t.id===e.id})))})),this.State.$batch({columns:i,meta:n(n({},this.State.meta),{freeze:this.GetFreeze()})})},e.prototype.FrozenTemplate=function(){return"<span class='webix_rpt_frozen webix_icon rpi-arrow-horizontal-lock'></span><span>"+this._("Frozen columns above")+"</span>"},e.prototype.RowTemplate=function(t,e){var i="<div class='webix_rpt_config_row'><div class='webix_icon rpi-drag-vertical'></div>";return i+="$freeze"!==t.id?"<span class='webix_icon "+(t.show?"action-visible rpi-eye":"action-hidden rpi-eye-off-outline")+"'></span>":"",i+="<div class='webix_rpt_config_row_name'>"+t.name+(t.model?"<span class='webix_rpt_sources_path'>"+t.model+"</span>":"")+"</div>",(i+="$freeze"!==t.id?e.subrow(t,e):"")+"</div>"},e}(ct),yt=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.prototype.config=function(){var t=this;return{css:"webix_rpt_empty",view:"template",borderless:!0,template:function(e){return t.GetTemplate(e)}}},e.prototype.init=function(){var t=this,e=this.app.getService("local").getModules();e.waitData.then((function(){var i=t.GetText(e.data.count());t.getRoot().setValues({text:i})}))},e.prototype.GetText=function(t){var e=this.app.getService("locale")._;return e(t?"Select any report from the list":"Click 'New' button to add a new report")},e.prototype.GetSVG=function(){return"<svg  xmlns='http://www.w3.org/2000/svg' viewBox='0 0 390 320'><defs><style>.cls-1{fill:#9dbabf;fill-opacity:0.25;}.cls-2{fill:#edeff0;}.cls-3{fill:#b4dfea;}.cls-4{fill:#fafbff;}.cls-5{fill:#dedede;}.cls-6{fill:#f2f2f2;}.cls-7{fill:#fff;}.cls-8{fill:#00d1eb;}.cls-9{fill:#f4f5f9;}</style></defs><path class='cls-1' d='M369.51,182.77c-23.18-52.39,32-103.23,13.74-148.28s-77.61-39.42-162.07-20S78.47-6.35,34.66,14.46c-29.39,14-27.27,58.82-5,107,38.95,84.29-51.86,117.32-24.38,166s118.91-.95,183.37,4.22c37.62.59,62.88,6.26,109.52,21.27C387.63,341.7,412.41,279.75,369.51,182.77Z'/><rect class='cls-2' x='111.53' y='226.04' width='212.47' height='0.91'/><rect class='cls-3' x='97' y='89.51' width='212' height='151.96'/><rect class='cls-4' x='67' y='159.96' width='136.33' height='81.98' rx='2'/><polygon class='cls-5' points='199.32 235.55 72.61 235.55 72.61 165.28 71.01 165.28 71.01 235.55 71.01 237.68 71.01 237.68 72.61 237.68 72.61 237.68 199.32 237.68 199.32 235.55'/><rect class='cls-6' x='84.64' y='165.28' width='0.8' height='68.14'/><rect class='cls-6' x='97.47' y='165.28' width='0.8' height='68.14'/><rect class='cls-6' x='110.3' y='165.28' width='0.8' height='68.14'/><rect class='cls-6' x='123.14' y='165.28' width='0.8' height='68.14'/><rect class='cls-6' x='135.97' y='165.28' width='0.8' height='68.14'/><rect class='cls-6' x='148.8' y='165.28' width='0.8' height='68.14'/><rect class='cls-6' x='161.63' y='165.28' width='0.8' height='68.14'/><rect class='cls-6' x='174.46' y='165.28' width='0.8' height='68.14'/><rect class='cls-6' x='187.29' y='165.28' width='0.8' height='68.14'/><rect class='cls-7' x='111.53' y='94.41' width='212.47' height='132.54'/><rect class='cls-8' x='111.53' y='109.85' width='212.47' height='0.91'/><path class='cls-9' d='M111.53,94.41H324v15.44H111.53Z'/><path class='cls-7' d='M111.53,79H324V94.41H111.53Z'/><path class='cls-2' d='M324,125.28v-.91H287.68V109.84h-.91v14.53H250.45V109.84h-.91v14.53H213.22V109.84h-.9v14.53H176V109.85h-.91v14.52H111.53v.91h63.56v13.61H111.53v.91h63.56v13.62H111.53v.91h63.56v13.61H111.53v.91h63.56v13.62H111.53v.91h63.56V197H111.53v.91h63.56v13.62H111.53v.9h63.56V227H176V212.42h36.32V227h.9V212.42h36.32V227h.91V212.42h36.32V227h.91V212.42H324v-.9H287.68V197.9H324V197H287.68V183.38H324v-.91H287.68V168.85H324v-.91H287.68V154.33H324v-.91H287.68V139.8H324v-.91H287.68V125.28Zm-74.46,0v13.61H213.22V125.28Zm-36.32,57.19V168.85h36.32v13.62Zm36.32.91V197H213.22V183.38Zm-36.32-15.44V154.33h36.32v13.61Zm0-14.52V139.8h36.32v13.62ZM176,125.28h36.32v13.61H176Zm0,14.52h36.32v13.62H176Zm0,14.53h36.32v13.61H176Zm0,14.52h36.32v13.62H176Zm0,14.53h36.32V197H176Zm0,28.14V197.9h36.32v13.62Zm37.22,0V197.9h36.32v13.62Zm73.55,0H250.45V197.9h36.32Zm0-14.53H250.45V183.38h36.32Zm0-14.52H250.45V168.85h36.32Zm0-14.53H250.45V154.33h36.32Zm0-14.52H250.45V139.8h36.32Zm0-14.53H250.45V125.28h36.32Z'/><rect class='cls-2' x='175.09' y='94.41' width='0.91' height='15.43'/><rect class='cls-2' x='212.32' y='94.41' width='0.91' height='15.43'/><rect class='cls-2' x='249.54' y='94.41' width='0.91' height='15.43'/><rect class='cls-2' x='286.77' y='94.41' width='0.91' height='15.43'/><rect class='cls-9' x='118.79' y='84.43' width='21.79' height='5.45'/><rect class='cls-9' x='250.45' y='84.43' width='66.28' height='5.45'/></svg>"},e.prototype.GetTemplate=function(t){return"<div class='webix_rpt_empty_placeholder'>"+(t.text||"")+"</div>"+this.GetSVG()},e}(p),wt=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.prototype.config=function(){return{type:"wide",margin:5,cols:[{}]}},e.prototype.init=function(){this.State=this.getParam("state",!0),this.Charts=this.app.getService("charts"),this.Local=this.app.getService("local")},e.prototype.ready=function(){var t=this;this.Host=this.getRoot(),this.on(this.State.$changes,"module",(function(e){return t.Show(e)}))},e.prototype.Show=function(t){var e=this,i=this.Host;if(t&&t.meta.value&&"heatmap"===t.type){var n=this.GetChartConfig(t);if(!n.view)return;this.GetChartData(t).then((function(r){var o=r[0];n.data=o,o.length&&t.meta.color&&(n.type.cssClass=e.CssFactory(o,t.meta.color)),webix.ui([n],i),e.Chart=i.getChildViews()[0]}))}else webix.ui([{template:" "}],i),this.Chart=null},e.prototype.GetChartConfig=function(t){var e=t.meta,i=t.columns,n={view:"treemap",css:"webix_rpt",value:function(t){return t[e.value]},tooltip:this.TooltipFactory(e,i),type:{}};return e.label&&(n.type.template=function(t){return t[e.label]}),n},e.prototype.GetChartData=function(t){return Promise.all([this.Local.getData(this.Local.getDataConfig(t),"edit"==this.State.mode),this.Local.getOptions(t.columns)])},e.prototype.CssFactory=function(t,e){for(var i=1/0,n=-1/0,r=0;r<t.length;r++){var o=t[r][e];o>n&&(n=1*o),o<i&&(i=1*o)}var s=(n-i)/4,a=[n-s,n-2*s,n-3*s,i];return function(t){for(var i=t[e],n=0;n<a.length;n++)if(i>=a[n])return"l"+n}},e.prototype.TooltipFactory=function(t,e){var i=e.find((function(e){return e.id===t.value})),n=e.find((function(e){return e.id===t.color}));if(!i||!n)return"";var r=[t.value,i.name];return t.color&&t.color!=t.value&&r.push(t.color,n.name),function(t){for(var e="",i=0;i<r.length;i+=2)e+=(i?", ":"")+r[i+1]+": "+t[r[i]];return e}},e}(p),bt=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.prototype.config=function(){var t=this,e=this.app.getService("locale")._;return{view:"popup",padding:0,point:!1,body:{view:"list",borderless:!0,css:"webix_rpt_popup_menu",template:function(t){return"<span class='webix_icon "+t.icon+"'></span>"+t.value},width:160,autoheight:!0,data:[{value:e("Edit"),id:"edit",icon:"rpi-square-edit-outline"},{value:e("Create copy"),id:"copy",icon:"rpi-content-copy"},{value:e("Delete"),id:"delete",icon:"rpi-delete"}],on:{onItemClick:function(e){t.app.callEvent("onMenuAction",[t.ID,e]),t.getRoot().hide()}}}}},e.prototype.init=function(){},e.prototype.Show=function(t,e){var i=this;this.ID=e,webix.delay((function(){i.getRoot()&&i.getRoot().show(t)}))},e}(p),_t=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.prototype.config=function(){var t=this,e=this._=this.app.getService("locale")._;return{width:320,type:"clean",rows:[{view:"form",height:webix.skin.$active.barHeight+6,padding:{left:10,right:10,top:5,bottom:5},margin:0,localId:"bar",cols:[{view:"label",label:e("Reports")},{},{view:"icon",localId:"nameSorting",icon:"rpi-sort-alphabetical-ascending",css:"webix_rpt_sort_icon webix_rpt_btn_active",icons:{asc:"rpi-sort-alphabetical-ascending",desc:"rpi-sort-alphabetical-descending"},click:function(){return t.Sort("name")}},{view:"icon",localId:"updatedSorting",css:"webix_rpt_sort_icon",icon:"rpi-sort-calendar-descending",icons:{asc:"rpi-sort-calendar-ascending",desc:"rpi-sort-calendar-descending"},click:function(){return t.Sort("updated")}}]},{type:"clean",rows:[{view:"form",padding:{left:10,right:10,top:2,bottom:4},cols:[{view:"text-search",localId:"search",placeholder:e("Type to search")}]},{view:"list",localId:"list",scroll:!0,select:!0,css:"webix_rpt_list",type:{height:webix.skin.$active.rowHeight+24,template:function(e){return t.GetListTemplate(e)}},scheme:{$change:function(t){t.date&&"string"==typeof t.date&&(t.date=new Date(t.date))}},onClick:{webix_rpt_action_menu:function(e,i){return t.Menu.Show(e,i),!1}},onDblClick:{},on:{onAfterSelect:function(e){return t.LoadModule(e,null)},onItemDblClick:function(e){return t.LoadModule(e,"edit")}}}]}]}},e.prototype.init=function(){var t=this;this.State=this.getParam("state",!0),this.Menu=this.ui(bt);var e=this.$$("list");e.$view.firstChild.setAttribute("placeholder",this._("No reports"));var i=this.app.getService("local").getModules();e.sync(i),i.waitData.then((function(){t.State.moduleId&&e.select(t.State.moduleId)})),this.on(this.State.$changes,"readonly",(function(){return t.$$("list").refresh()})),this.$$("search").attachEvent("onSearchChange",(function(e){return t.Find(e)})),this.Sorting={by:"name",dir:"asc"}},e.prototype.LoadModule=function(t,e){this.app.callEvent("loadModule",[t,e])},e.prototype.Hide=function(){this.app.callEvent("hideModuleList")},e.prototype.Find=function(){var t=this,e=this.$$("search").getValue(),i=this.$$("list");e?(e=e.toLowerCase(),i.filter((function(i){return t.SearchCompare(e,i)}))):i.filter()},e.prototype.SearchCompare=function(t,e){return e.name.toLowerCase().indexOf(t)>-1},e.prototype.GetListTemplate=function(t){var e=this.app.getService("locale")._,i="<div class='webix_rpt_list_block'>";return i+="<div class='webix_rpt_list_report_name'>"+W[t.parsed.type]+" "+t.name+"</div>",i+="<div class='webix_rpt_list_report_date'>"+e("Last modified")+": "+webix.i18n.longDateFormatStr(t.updated||new Date)+"</div>",this.State.readonly||(i+="<span class='webix_icon webix_rpt_action_menu rpi-dots-vertical'></span>"),i+"</div>"},e.prototype.Sort=function(t){var e=this.Sorting,i=webix.copy(e);e.by==t?e.dir="desc"==e.dir?"asc":"desc":(e.by=t,e.dir="desc"),e.as="updated"==t?"date":"string",this.ChangeSortButtons(e,i),this.$$("list").sort(e)},e.prototype.ChangeSortButtons=function(t,e){var i=this.$$(t.by+"Sorting");if(this.webix.html.addCss(i.$view,"webix_rpt_btn_active"),i.config.icon=i.config.icons[t.dir],i.refresh(),t.by!=e.by){var n=this.$$(e.by+"Sorting");this.webix.html.removeCss(n.$view,"webix_rpt_btn_active")}},e}(p),St=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.prototype.config=function(){var t=this;return{view:"popup",padding:0,point:!1,body:{view:"list",borderless:!0,css:"webix_rpt_popup_menu",template:function(e){return t.GetTemplate(e)},width:160,autoheight:!0,data:this.GetPopupOptions(),click:function(e,i){return t.PopupAction(e,i)}}}},e.prototype.GetPopupOptions=function(){var t=this.app.getService("locale")._;return[{value:t("To Excel"),id:"excel"},{value:t("To CSV"),id:"csv"}]},e.prototype.PopupAction=function(t){this.app.callEvent("exportModule",[t]),this.getRoot().hide()},e.prototype.GetTemplate=function(t){return"<span class='webix_icon "+t.icon+"'></span>"+t.value},e.prototype.Show=function(t){var e=this;this.getRoot().isVisible()||this.webix.delay((function(){return e.getRoot().show(t)}))},e}(p),xt=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.prototype.config=function(){var t=this,e=this.app.getService("locale")._;return{view:"form",localId:"toolbar",height:webix.skin.$active.barHeight+6,hidden:!0,padding:{left:10,right:10,top:6,bottom:6},margin:10,cols:[{view:"button",type:"icon",width:140,label:e("Export"),icon:"rpi-export",click:function(e){return t.ShowExportPopup(e)}},{},{view:"text-search",localId:"search",placeholder:e("Type to search"),maxWidth:600,minWidth:200}]}},e.prototype.ready=function(){var t=this;this.State=this.getParam("state",!0),this.$$("search").attachEvent("onSearchChange",(function(e){return t.State.search=e})),this.on(this.app,"onRecordsSearch",(function(e,i){e?t.$$("search").setBadge(i.length):t.$$("search").setBadge(null)}))},e.prototype.ShowExportPopup=function(t){this.ExportMenu&&this.ExportMenu.$view||(this.ExportMenu=this.ui(St));var e=webix.$$(t);this.ExportMenu.Show(e.$view)},e}(p),$t={number:"int",date:"date",text:"string",boolean:"number",picklist:"text",reference:"text"},Ct=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.prototype.config=function(){return{rows:[xt,{type:"wide",margin:5,cols:[{}]}]}},e.prototype.init=function(){this.State=this.getParam("state",!0),this.LocalState=H({search:""}),this.setParam("state",this.LocalState),this.Local=this.app.getService("local")},e.prototype.ready=function(){var t=this,e=this.getRoot().getChildViews();this.Bar=e[0],this.Host=e[1],this.on(this.State.$changes,"module",(function(e){return t.Show(e)})),this.on(this.app,"exportModule",(function(e){return t.Export(e)})),this.on(this.LocalState.$changes,"search",(function(e){return t.Find(e)}))},e.prototype.Export=function(t){var e={ignore:{$selection:!0},plainOutput:!0,filterHTML:!0};this.Table&&("excel"==t?webix.toExcel(this.Table,e):"csv"==t&&webix.toCSV(this.Table,e))},e.prototype.Show=function(t){var e=this.Host;if(t&&t.columns.length&&"table"===t.type){var i=this.GetTableConfig(t);if(!i)return;this.Bar.show(),webix.ui([i],e);var n=this.Table=e.getChildViews()[0];this.GetTableData(t).then((function(t){var e=t[0],i=t[1];n.$destructed||(i.forEach((function(t){var e=t.field,i=t.data;n.getColumnConfig(e).collection.parse(i)})),n.parse(e))}))}else webix.ui([{}],e),this.Table=null,this.Bar.hide()},e.prototype.GetTableConfig=function(t){var e=this,i=t.groups,n=t.columns,r=t.meta;if(!n)return null;var o=[],s=n.map((function(t){return"date"==t.type&&o.push(t.id),e.GetColumnConfig(t)})),a="edit"===this.State.mode,u={view:i?"treetable":"datatable",columns:s,resizeColumn:!!a&&{headerOnly:!0},leftSplit:r.freeze?r.freeze:0,css:a?"webix_header_border":"",on:{onColumnResize:function(t,i,n,r){return e.SetColWidth(t,i,n,r)}}};return o.length&&(u.scheme={$change:function(t){return o.forEach((function(e){return t[e]=new Date(t[e])}))}}),u},e.prototype.GetColumnConfig=function(t){var e={id:t.id,header:t.meta.header&&"none"!==t.meta.header?[t.meta.name||t.name,{content:"text"===t.header?"textFilter":"richSelectFilter"}]:t.meta.name||t.name,type:t.type,sort:$t[t.type],width:t.width||200};if("date"===t.type&&(e.format=webix.i18n.dateFormatStr),"boolean"===t.type){var i=this.app.getService("locale")._;e.template=function(e){return 1==e[t.id]?i("True"):i("False")}}return"reference"!==t.type&&"picklist"!==t.type||(e.options=[]),e},e.prototype.SetColWidth=function(t,e,i,n){if(n){if("$selection"===t||"$subrow"===t){var r=this.Tbl;return r.blockEvent(),r.setColumnWidth(t,i),void r.unblockEvent()}this.app.callEvent("onColumnResize",[t,e])}},e.prototype.GetTableData=function(t){return Promise.all([this.Local.getData(this.Local.getDataConfig(t),"edit"==this.State.mode),this.Local.getOptions(t.columns)])},e.prototype.Find=function(t){var e=this.app.getService("helpers"),i=this.Table,n=[];if(i){if(i.clearCss("webix_rpt_found_record",!0),t){for(var r=e.hasNonDigits(t),o=new RegExp(e.wildToRegexp(t),"gi"),s=i.config.columns.filter((function(t){return!("$selection"===t.id||"$subrow"===t.id||r&&("number"===t.type||"date"===t.type))})),a=[],u=function(n){var r=s[n].type,u=s[n].id;if("text"===r||"number"===r)a.push((function(t){return o.test(t[u])}));else if("reference"===r||"picklist"===r){var l=i.getColumnConfig(u).collection,c=e.findOptions(l,o);a.push(e.matchPerColumn(u,(function(t){return c[t]})))}else if("bool"===r)switch(t){case"true":a.push((function(t){return t[u]}));break;case"false":a.push((function(t){return!t[u]}))}else if("date"===r){var p=i.getColumnConfig(u).format;a.push((function(t){return o.test(p(t[u]))}))}},l=0;l<s.length;++l)u(l);var c=!1;n=i.find((function(t){for(var e=0;e<a.length;++e)if(a[e](t))return c||(c=!0,i.showItem(t.id)),i.addCss(t.id,"webix_rpt_found_record",!0),!0;return!1}))}i.refresh(),this.app.callEvent("onRecordsSearch",[t,n])}},e}(p);function kt(t){return{attachEvent:function(e,i){return webix.UIManager.addHotKey(e,i,t),{key:e,handler:i}},detachEvent:function(e){var i=e.key,n=e.handler;return webix.UIManager.removeHotKey(i,n,t)}}}var At=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.prototype.config=function(){var t=this,e=this.app,i=this.app.getService("locale")._;return{view:"toolbar",localId:"bar",padding:{left:10,right:10,top:6,bottom:6},margin:10,visibleBatch:"default",height:webix.skin.$active.barHeight+6,elements:[{localId:"defaultButtons",margin:10,width:300,cols:[{view:"toggle",type:"icon",label:i("All reports"),localId:"list",width:150,offIcon:"rpi-menu",onIcon:"rpi-menu-open",on:{onChange:function(){e.callEvent("showModules",[this.getValue()])}}},{view:"button",type:"icon",localId:"newBtn",icon:"rpi-plus",label:i("New"),click:function(){t.$$("bar").showBatch("edit"),e.callEvent("loadModule",[null,"edit"])}}]},{width:300,batch:"edit"},{view:"label",localId:"name",align:"center",label:""},{width:330,batch:"default"},{batch:"report",width:290,cols:[{},{view:"button",type:"icon",align:"right",css:"webix_primary",icon:"wxi-pencil",label:i("Edit"),width:140,click:function(){return e.callEvent("onMenuAction",[null,"edit"])}}]},{width:290,batch:"edit",margin:10,cols:[{view:"button",type:"icon",icon:"rpi-close",label:i("Cancel"),localId:"reset",click:function(){return e.callEvent("resetModule",[])}},{view:"button",css:"webix_primary",type:"icon",icon:"wxi-check",localId:"save",width:140,label:i("Save"),disabled:!0,click:function(){return e.callEvent("saveModule",[])}}]},{popup:!0,$subview:!0,name:"popup"}]}},e.prototype.init=function(){var t=this;this.State=this.app.getParam("state",!0),this.on(this.State.$changes,"module",(function(e){e?void 0!==e.name?t.$$("name").setValue(e.name):t.State.moduleId&&t.app.getService("local").getModule(t.State.moduleId).then((function(e){t.$$("name").setValue(e.name)})):t.$$("name").setValue("")})),this.on(this.State.$changes,"saved",(function(e){var i=t.$$("name").$view;e?(t.$$("save").disable(),i.classList.remove("webix_rpt_not_saved")):(t.$$("save").enable(),i.classList.add("webix_rpt_not_saved"))})),this.on(this.State.$changes,"mode",(function(){return t.SetVisibleButtons()})),this.on(this.State.$changes,"moduleId",(function(){return t.SetVisibleButtons()})),this.on(this.State.$changes,"readonly",(function(){return t.SetVisibleButtons()})),this.on(kt(),"ctrl+e",(function(){return t.app.callEvent("onMenuAction",[null,"edit"]),!1})),this.on(kt(),"ctrl+s",(function(){return t.app.callEvent("saveModule",[]),!1})),this.on(kt(),"ctrl+l",(function(){return t.app.callEvent("showModules",[!0]),!1}))},e.prototype.SetVisibleButtons=function(){var t=this.State.mode;"list"==t?this.$$("list").setValue(!0):this.$$("list").setValue(!1),"edit"==t?(this.$$("defaultButtons").hide(),this.$$("bar").showBatch("edit")):(this.$$("defaultButtons").show(),this.State.moduleId&&!this.State.readonly?this.$$("bar").showBatch("report"):this.$$("bar").showBatch("default"));var e=this.$$("newBtn");e&&(this.State.readonly?e.isVisible()&&e.hide():e.isVisible()||e.show())},e.prototype.TitleTemplate=function(t){return'<div class="rep_title">'+t.name+"</div>"},e}(p),Vt=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.prototype.config=function(){return{type:"wide",margin:5,css:"webix_reports",rows:[{$subview:!0,name:"top"},{type:"wide",margin:5,cols:[{$subview:!0,name:"left"},{$subview:!0,name:"right",css:"webix_rpt_right"}]}]}},e.prototype.init=function(){var t=this;this.State=this.app.getParam("state");var e=this.app.getService("locale")._;this.on(this.State.$changes,"toolbar",(function(e){t.show(e?"toolbar":"_hidden",{target:"top"})})),this.on(this.State.$changes,"mode",(function(e){"edit"===e?t.show("./editor",{target:"left"}):"list"===e?t.show("./modules",{target:"left"}):t.show("_hidden",{target:"left"})})),this.on(this.State.$changes,"moduleId",(function(e){e?t.app.getService("local").getModule(e).then((function(e){t.State.module=JSON.parse(e.text)})):t.State.module=null})),this.on(this.State.$changes,"module",(function(e){var i=(e?e.type:"empty")||"table";t.show("./"+i,{target:"right"})})),this.on(this.app,"loadModule",(function(e,i){return t.LoadModule(e,i)})),this.on(this.app,"onMenuAction",(function(i,n){!i&&t.State.moduleId&&(i=t.State.moduleId),i&&("edit"===n?t.LoadModule(i,"edit"):"delete"===n?webix.confirm({title:e("Delete report"),ok:e("Delete"),cancel:e("Cancel"),text:e("Are you sure to delete this report?")}).then((function(){t.app.getService("local").deleteModule(i).then((function(){i==t.State.moduleId&&t.State.$batch({moduleId:null,mode:"list"})}))})):"copy"===n&&t.app.getService("local").copyModule(i).then((function(e){t.State.$batch({moduleId:e,mode:"edit"})})))})),this.on(this.app,"showModules",(function(e){e?t.State.mode="list":"list"==t.State.mode&&(t.State.mode="view")}))},e.prototype.LoadModule=function(t,e){this.State.moduleId=t,e&&(this.State.mode=e)},e}(p),Et={JetView:p};Et.chart=U,Et["editor/common"]=Z,Et["editor/data"]=et,Et["editor/datepopup"]=it,Et["editor/groups"]=ot,Et.editor=st,Et["editor/other"]=at,Et["editor/query"]=X,Et["editor/sorts"]=ut,Et["editor/structure/axis"]=lt,Et["editor/structure/baseview"]=ct,Et["editor/structure/chart"]=ft,Et["editor/structure/chartseries"]=ht,Et["editor/structure/colorpopup"]=pt,Et["editor/structure/column"]=dt,Et["editor/structure/heatmap"]=vt,Et["editor/structure"]=gt,Et["editor/structure/table"]=mt,Et["editor/summary"]=rt,Et["editor/summarypopup"]=nt,Et.empty=yt,Et.heatmap=wt,Et.menu=bt,Et.modules=_t,Et["table/export"]=St,Et.table=Ct,Et["table/toolbar"]=xt,Et.toolbar=At,Et.top=Vt;var Lt=function(){function t(t){this._app=t,this._fieldData=new Map,this._optionsData=new Map,this._data=new Map}return t.prototype.ready=function(t){return this.getModels().then((function(){return t}))},t.prototype.getModules=function(){return this._modules||(this._modules=new webix.DataCollection({scheme:{$change:function(t){t.value=t.name,t.parsed=JSON.parse(t.text),"string"==typeof t.updated&&(t.updated=new Date(t.updated))},$sort:{by:"name",dir:"asc",as:"string"}}}),this._modules.parse(this._app.getService("backend").getModules())),this._modules},t.prototype.getModule=function(t){var e=this;return this.getModules().waitData.then((function(){return e._modules.getItem(t)}))},t.prototype.deleteModule=function(t){var e=this;return this._app.getService("backend").deleteModule(t).then((function(){e._modules.remove(t)}))},t.prototype.copyModule=function(t){var e=this._modules.getItem(t);return this.saveModule(0,{name:"Copy of "+e.name,text:e.text})},t.prototype.saveModule=function(t,e){var i=this;return this._app.getService("backend").saveModule(t,e).then((function(r){return t?i._modules.updateItem(t,e):i._modules.add(n({id:r.id},e)),r.id}))},t.prototype.getModels=function(t){var e=this;return t?this._models||{}:(this._models_async||(this._models_async=this._app.getService("backend").getModels().then((function(t){var i={};return Object.keys(t).forEach((function(e){t[e].data.forEach((function(t){if("reference"==t.type){i[e]||(i[e]=[]),i[t.ref]||(i[t.ref]=[]);var n=e+"/"+t.id+"//"+t.ref;i[e].push({sid:e,tid:t.ref,sf:t.id,id:n}),i[t.ref].push({sid:t.ref,tid:e,tf:t.id,id:n})}}))})),e._refs=i,e._models=t,t}))),this._models_async)},t.prototype.getRefs=function(){return this._refs},t.prototype.getModel=function(t){return this._models[t]},t.prototype.getFieldData=function(t,e){var i=t,n=this._fieldData.get(i);return n||(n=this._app.getService("backend").getFieldData(t).then((function(t){return"date"===e&&(t=t.map((function(t){return new Date(t)}))),t})),this._fieldData.set(i,n),n)},t.prototype.getFields=function(t,e,i){var n=this,r=this._models,o=[];return r[t].data.forEach((function(e){return o.push(n.newField(r[t],e))})),e.forEach((function(t){return r[t.tid].data.forEach((function(e){i&&!e.show||o.push(n.newField(r[t.tid],e))}))})),o},t.prototype.setDataSource=function(t){var e=this.getFields(t,[]);return{query:"",sort:null,fields:e,columns:r(e),oldColumns:null,group:null,joins:[]}},t.prototype.newField=function(t,e){var i={id:t.id+"."+e.id,name:e.name,type:e.type,ref:e.ref,mid:t.id,model:t.name,meta:{}};return e.key&&(i.key=!0),i},t.prototype.newModule=function(t){var e=this._app.getService("locale")._;return{id:0,name:e("New report"),desc:e("Created on")+" "+webix.i18n.dateFormatStr(new Date),data:Object.keys(this._models)[0],joins:[],query:"",type:t||"table",sort:null,columns:[],fields:[],publicFields:null,group:null,meta:{}}},t.prototype.addJoin=function(t,e){var i=this,n=this._models[t],r=e.fields,o=e.columns,s=e.group;return n.data.forEach((function(t){r.push(i.newField(n,t)),t.show&&!s&&o.push(i.newField(n,t))})),{fields:r,columns:o}},t.prototype.getData=function(t,e){var i=JSON.stringify(t),n=this._data.get(i);return n||(e&&(t.limit=30,i=JSON.stringify(t),n=this._data.get(i))||(n=this._app.getService("backend").getData(t),this._data.set(i,n)),n)},t.prototype.getDataConfig=function(t){return{data:t.data,query:t.query,columns:t.columns.map((function(t){return t.id})).sort(),joins:t.joins,sort:t.sort,group:t.group&&t.group.by?t.group.by.map((function(t){return(t.mod?t.mod+".":"")+t.id})):""}},t.prototype.getOptions=function(t){var e=this,i=t.filter((function(t){return"picklist"===t.type||"reference"===t.type})).map((function(t){return e.getOptionsList(t.id)}));return Promise.all(i)},t.prototype.getOptionsList=function(t){var e=this._optionsData.get(t);return e||(e=this._app.getService("backend").getOptions(t),this._optionsData.set(t,e)),e.then((function(e){return{field:t,data:e}}))},t.prototype.getLinkedModels=function(t,e){for(var i=[],r=this.getRefs(),o=0;o<t.length;o++){var s=t[o];r[s]&&r[s].forEach((function(r){e&&-1!=t.indexOf(r.tid)||i.push(n({},r))}))}return i},t.prototype.cleanLinkedModels=function(t,e){var i,n,r=e.data,o=e.joins,s=e.fields,a=e.columns,u=e.query,l=e.group,c=e.publicFields,p=((i={})[r]=1,i),h=o,f=[];o=n=o.filter((function(e){return e.id!=t}));do{o=n,n=[];for(var d=0;d<o.length;d++)p[o[d].sid]?p[o[d].tid]=1:n.push(o[d])}while(n.length&&n.length!==o.length);var v=u?It(JSON.parse(u)):[],g=function(t){var e=h[t];if(p[e.tid])f.push(e);else{if(-1!==v.indexOf(e.tid))return{value:{block:{filter:1}}};if(l){var i="."+e.tid+".";if(c.find((function(t){return-1!=t.id.indexOf(i)})))return{value:{block:{group:1}}}}a=a.filter((function(t){return t.mid!=e.tid})),s=s.filter((function(t){return t.mid!=e.tid}))}};for(d=0;d<h.length;d++){var m=g(d);if("object"==typeof m)return m.value}return{joins:f,columns:a,fields:s}},t.prototype.getQueries=function(){return this._queries?this._queries:this._queries=new webix.DataCollection({scheme:{$change:function(t){t.value=t.name,t.models=It(JSON.parse(t.text))}},data:this._app.getService("backend").getQueries()})},t.prototype.saveQuery=function(t,e){var i=this;return this._app.getService("backend").saveQuery(t,e).then((function(r){return t?i._queries.updateItem(t,e):i._queries.add(n({id:r.id},e)),r.id}))},t.prototype.deleteQuery=function(t){var e=this;return this._app.getService("backend").deleteQuery(t).then((function(){e._queries.remove(t)}))},t}();function It(t,e){return e=e||[],t.rules&&t.rules.forEach((function(t){if(t.rules)It(t,e);else{var i=t.field.split(".");e.push(i[0])}})),e}var Pt=function(){function t(t){this.app=t,this._url=t.config.url}return t.prototype.saveQuery=function(t,e){return t?webix.ajax().put(this._url+"api/queries/"+t,e).then((function(t){return t.json()})):webix.ajax().post(this._url+"api/queries",e).then((function(t){return t.json()}))},t.prototype.deleteQuery=function(t){return webix.ajax().del(this._url+"api/queries/"+t).then((function(t){return t.json()}))},t.prototype.getQueries=function(){return webix.ajax(this._url+"api/queries").then((function(t){return t.json()}))},t.prototype.getModules=function(){return webix.ajax(this._url+"api/modules").then((function(t){return t.json()}))},t.prototype.saveModule=function(t,e){return t?webix.ajax().put(this._url+"api/modules/"+t,e).then((function(t){return t.json()})):webix.ajax().post(this._url+"api/modules",e).then((function(t){return t.json()}))},t.prototype.deleteModule=function(t){return webix.ajax().del(this._url+"api/modules/"+t).then((function(t){return t.json()}))},t.prototype.getModels=function(){return webix.ajax(this._url+"api/objects").then((function(t){return t.json()}))},t.prototype.getData=function(t){var e=t.query,i=t.columns,n=t.joins,r=t.limit,o=t.group,s=t.sort;return webix.ajax().post(this._url+"api/objects/"+t.data+"/data",{query:e,columns:i,joins:n,limit:r,sort:s,group:o}).then((function(t){return t.json()}))},t.prototype.getOptions=function(t){return webix.ajax(this._url+"api/fields/"+t+"/options").then((function(t){return t.json()}))},t.prototype.getFieldData=function(t){return webix.ajax(this._url+"api/fields/"+t+"/suggest").then((function(t){return t.json()}))},t}(),Ft=function(){function t(){this.replacements=[{from:/(^ +)/g,to:""},{from:/(^\w+)/g,to:"^($&)"},{from:/^(\?)/g,to:"^\\S{1}"},{from:/(\?)/g,to:"\\S{1}"},{from:/(\*)/g,to:"\\S*"},{from:/( +)$/g,to:"$"}]}return t.prototype.wildToRegexp=function(t){for(var e=0;e<this.replacements.length;++e)t=t.replace(this.replacements[e].from,this.replacements[e].to);return t},t.prototype.matchPerColumn=function(t,e){return function(i){return e(i[t])}},t.prototype.findOptions=function(t,e){var i={};return t.find((function(t){return e.test(t.value)})).forEach((function(t){return i[t.id]=1})),i},t.prototype.hasNonDigits=function(t){return/\D/gi.test(t.replace(/[?*/. ]/g,""))},t}(),Mt=function(){function t(t){this._app=t,this.type="line",this.type="line",this.colors=["#FF9700","#4CB050","#00BCD4","#3F51B5","#9C28B1","#F34336","#FFEA3B","#009788","#2196F3","#673BB7","#EA1E63"],this.itemSupport=["line","spline","radar"],this.noAxisSupport=["pie","donut"],this.lineTypes=["line","spline"],this.multiTypeSupport=["bar","stackedBar","area","stackedArea","splineArea"],this.numLimit=30}return t.prototype.getTypes=function(){var t=this._app.getService("locale")._;return this.types||(this.types=[{id:"line",value:t("Line"),icon:"rpi-chart-line"},{id:"spline",value:t("Spline"),icon:"rpi-chart-bell-curve-cumulative"},{id:"area",value:t("Area"),icon:"rpi-chart-areaspline"},{id:"stackedArea",value:t("Stacked area"),icon:"rpi-chart-line-stacked"},{id:"splineArea",value:t("Spline area"),icon:"rpi-chart-areaspline-variant"},{id:"bar",value:t("Bar"),icon:"rpi-chart-bar"},{id:"stackedBar",value:t("Stacked bar"),icon:"rpi-chart-bar-stacked"},{id:"radar",value:t("Radar"),icon:"rpi-vector-triangle"}]),this.types},t.prototype.getItemTypes=function(){var t=this._app.getService("locale")._;return this.itemTypes||(this.itemTypes=[{id:"r",value:t("circle"),icon:"rpi-circle-outline"},{id:"s",value:t("square"),icon:"rpi-square-outline"},{id:"t",value:t("triangle"),icon:"rpi-triangle-outline"},{id:"d",value:t("diamond"),icon:"rpi-rhombus-outline"},{id:"no",value:t("no markers")}]),this.itemTypes},t}(),Rt=function(t){function e(e){var i=this,r={state:H({moduleId:e.moduleId||null,module:null,mode:e.mode||"list",toolbar:!1!==e.toolbar,saved:!0,readonly:e.readonly||!1})};e.compat&&(r.forceCompact=e.compact);var o={router:b,debug:!0,start:"/top/empty",compactWidth:650,params:r};(i=t.call(this,n(n({},o),e))||this).config.debug&&(webix.Promise=window.Promise);var s=function(t){return i.config.override&&i.config.override.get(t)||t};return i.setService("local",new(s(Lt))(i)),i.setService("backend",new(s(Pt))(i)),i.setService("helpers",new(s(Ft))(i)),i.setService("charts",new(s(Mt))(i)),i.use(D,i.config.locale||{lang:"en",webix:{en:"en-US"}}),i}return i(e,t),e.prototype.require=function(t,e){return"jet-views"===t?Et[e]:"jet-locales"===t?Dt[e]:null},e.prototype.getState=function(){return this.config.params.state},e}(w);webix.protoUI({name:"reports",app:Rt,getState:function(){return this.$app.getState()},getService:function(t){return this.$app.getService(t)},$init:function(){var t=this.$app.getState();for(var e in t)N(t,this.config,e)}},webix.ui.jetapp);var Tt={Local:Lt,Backend:Pt,Helpers:Ft,Charts:Mt},Dt={en:{"Add column":"Add column","All reports":"All reports","Are you sure to delete this report?":"Are you sure to delete this report?","Are you sure to delete this query?":"Are you sure to delete this query?",Average:"Average",Cancel:"Cancel",Chart:"Chart",Column:"Column",Columns:"Columns","Color column":"Color column",Common:"Common","Copy of":"Copy of",Count:"Count","Created on":"Created on",Data:"Data","Data source":"Data source",Day:"Day",Delete:"Delete","Delete report":"Delete report",Description:"Description",Query:"Query",Edit:"Edit","Enter query name":"Enter query name",Export:"Export","To Excel":"To Excel","To CSV":"To CSV",Filter:"Filter","Filtering query":"Filtering query","Frozen columns above":"Frozen columns above",Function:"Function",Group:"Group","Group summaries":"Group summaries","Join data":"Join data",Heatmap:"Heatmap","Labels column":"Labels column",Max:"Max",Min:"Min",Month:"Month",New:"New","Click 'New' button to add a new report":"Click 'New' button to add a new report","Select any report from the list":"Select any report from the list","No reports":"No reports","No saved queries":"No saved queries","Last modified":"Last modified","New column name":"New column name","New report":"New report","Please delete the related query filter first":"Please delete the related query filter first","Please delete the related group rule first":"Please delete the related group rule first",Rename:"Rename","Report name":"Report name",Reports:"Reports",Save:"Save","Save query":"Save query",Sort:"Sort","Specify columns to group by and output(s)":"Specify columns to group by and output(s)","Specify columns to sort by":"Specify columns to sort by",Sum:"Sum",Table:"Table",Title:"Title","Type to search":"Type to search",View:"View",Year:"Year",Axes:"Axes","X Axis":"X Axis","Y Axis":"Y Axis",columns:"columns",rows:"rows","Data series":"Data series","Chart type":"Chart type","Keys column":"Keys column","X axis column":"X axis column","Values column":"Values column",Color:"Color","Marker type":"Marker type","Fill marker":"Fill marker",Legend:"Legend","Logarithmic scale":"Logarithmic scale",Gridlines:"Gridlines",Bottom:"Bottom",None:"None",Right:"Right",Line:"Line",Spline:"Spline",Area:"Area","Stacked area":"Stacked area","Spline area":"Spline area",Bar:"Bar","Stacked bar":"Stacked bar",Radar:"Radar",Pie:"Pie",Donut:"Donut","Create copy":"Create copy",circle:"circle",square:"square",triangle:"triangle",diamond:"diamond","no markers":"no markers","Vertical labels":"Vertical labels","Extract series from":"Extract series from",True:"True",False:"False","Save filter to use it in other reports":"Save filter to use it in other reports"}};t.App=Rt,t.locales=Dt,t.services=Tt,t.views=Et,Object.defineProperty(t,"__esModule",{value:!0})}));
//# sourceMappingURL=reports.min.js.map
