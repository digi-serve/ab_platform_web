/*
@license
Webix Gantt v.10.1.0
This software is covered by Webix Commercial License.
Usage without proper license is prohibited.
(c) XB Software Ltd.
*/
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t=t||self).gantt={})}(this,(function(t){"use strict";
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation.

    Permission to use, copy, modify, and/or distribute this software for any
    purpose with or without fee is hereby granted.

    THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
    REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
    AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
    INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
    LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
    OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
    PERFORMANCE OF THIS SOFTWARE.
    ***************************************************************************** */var e=function(t,i){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,i)};function i(t,i){function r(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}var r=function(){return(r=Object.assign||function(t){for(var e,i=1,r=arguments.length;i<r;i++)for(var n in e=arguments[i])Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t}).apply(this,arguments)},n=function(){},a=function(){function t(t,e){this.webixJet=!0,this.webix=t,this._events=[],this._subs={},this._data={},e&&e.params&&t.extend(this._data,e.params)}return t.prototype.getRoot=function(){return this._root},t.prototype.destructor=function(){this._detachEvents(),this._destroySubs(),this._events=this._container=this.app=this._parent=this._root=null},t.prototype.setParam=function(t,e,i){if(this._data[t]!==e&&(this._data[t]=e,this._segment.update(t,e,0),i))return this.show(null)},t.prototype.getParam=function(t,e){var i=this._data[t];if(void 0!==i||!e)return i;var r=this.getParentView();return r?r.getParam(t,e):void 0},t.prototype.getUrl=function(){return this._segment.suburl()},t.prototype.getUrlString=function(){return this._segment.toString()},t.prototype.getParentView=function(){return this._parent},t.prototype.$$=function(t){if("string"==typeof t){var e=this.getRoot();return e.queryView((function(i){return(i.config.id===t||i.config.localId===t)&&i.$scope===e.$scope}),"self")}return t},t.prototype.on=function(t,e,i){var r=t.attachEvent(e,i);return this._events.push({obj:t,id:r}),r},t.prototype.contains=function(t){for(var e in this._subs){var i=this._subs[e].view;if(i===t||i.contains(t))return!0}return!1},t.prototype.getSubView=function(t){var e=this.getSubViewInfo(t);if(e)return e.subview.view},t.prototype.getSubViewInfo=function(t){var e=this._subs[t||"default"];return e?{subview:e,parent:this}:"_top"===t?(this._subs[t]={url:"",id:null,popup:!0},this.getSubViewInfo(t)):this._parent?this._parent.getSubViewInfo(t):null},t.prototype._detachEvents=function(){for(var t=this._events,e=t.length-1;e>=0;e--)t[e].obj.detachEvent(t[e].id)},t.prototype._destroySubs=function(){for(var t in this._subs){var e=this._subs[t].view;e&&e.destructor()}this._subs={}},t.prototype._init_url_data=function(){var t=this._segment.current();this._data={},this.webix.extend(this._data,t.params,!0)},t.prototype._getDefaultSub=function(){if(this._subs.default)return this._subs.default;for(var t in this._subs){var e=this._subs[t];if(!e.branch&&e.view&&"_top"!==t){var i=e.view._getDefaultSub();if(i)return i}}},t.prototype._routed_view=function(){var t=this.getParentView();if(!t)return!0;var e=t._getDefaultSub();return!(!e&&e!==this)&&t._routed_view()},t}();function s(t){"/"===t[0]&&(t=t.substr(1));for(var e=t.split("/"),i=[],r=0;r<e.length;r++){var n=e[r],a={},s=n.indexOf(":");if(-1===s&&(s=n.indexOf("?")),-1!==s)for(var o=0,l=n.substr(s+1).split(/[\:\?\&]/g);o<l.length;o++){var c=l[o].split("=");a[c[0]]=decodeURIComponent(c[1])}i[r]={page:s>-1?n.substr(0,s):n,params:a,isNew:!0}}return i}function o(t){for(var e=[],i=0,r=t;i<r.length;i++){var n=r[i];e.push("/"+n.page);var a=l(n.params);a&&e.push("?"+a)}return e.join("")}function l(t){var e=[];for(var i in t)"object"!=typeof t[i]&&(e.length&&e.push("&"),e.push(i+"="+encodeURIComponent(t[i])));return e.join("")}var c=function(){function t(t,e){this._next=1,this.route="string"==typeof t?{url:s(t),path:t}:t,this.index=e}return t.prototype.current=function(){return this.route.url[this.index]},t.prototype.next=function(){return this.route.url[this.index+this._next]},t.prototype.suburl=function(){return this.route.url.slice(this.index)},t.prototype.shift=function(e){var i=new t(this.route,this.index+this._next);return i.setParams(i.route.url,e,i.index),i},t.prototype.setParams=function(t,e,i){if(e){var r=t[i].params;for(var n in e)r[n]=e[n]}},t.prototype.refresh=function(){for(var t=this.route.url,e=this.index+1;e<t.length;e++)t[e].isNew=!0},t.prototype.toString=function(){var t=o(this.suburl());return t?t.substr(1):""},t.prototype._join=function(t,e){var i=this.route.url;if(null===t)return i;var r=this.route.url,n=!0;if(i=r.slice(0,this.index+(e?this._next:0)),t){i=i.concat(s(t));for(var a=0;a<i.length;a++)r[a]&&(i[a].view=r[a].view),n&&r[a]&&i[a].page===r[a].page?i[a].isNew=!1:i[a].isNew&&(n=!1)}return i},t.prototype.append=function(t){var e=this._join(t,!0);return this.route.path=o(e),this.route.url=e,this.route.path},t.prototype.show=function(t,e,i){var r=this,a=this._join(t.url,i);return this.setParams(a,t.params,this.index+(i?this._next:0)),new Promise((function(t,i){var s=o(a),l={url:a,redirect:s,confirm:Promise.resolve()},c=e?e.app:null;if(c&&!c.callEvent("app:guard",[l.redirect,e,l]))return void i(new n);l.confirm.catch((function(t){return i(t)})).then((function(){if(null!==l.redirect){if(l.redirect!==s)return c.show(l.redirect),void i(new n);r.route.path=s,r.route.url=a,t()}else i(new n)}))}))},t.prototype.size=function(t){this._next=t},t.prototype.split=function(){var e={url:this.route.url.slice(this.index+1),path:""};return e.url.length&&(e.path=o(e.url)),new t(e,0)},t.prototype.update=function(t,e,i){var r=this.route.url[this.index+(i||0)];if(!r)return this.route.url.push({page:"",params:{}}),this.update(t,e,i);""===t?r.page=e:r.params[t]=e,this.route.path=o(this.route.url)},t}(),u=function(t){function e(e,i){var r=t.call(this,e.webix)||this;return r.app=e,r._children=[],r}return i(e,t),e.prototype.ui=function(t,e){var i=(e=e||{}).container||t.container,r=this.app.createView(t);return this._children.push(r),r.render(i,this._segment,this),"object"!=typeof t||t instanceof a?r:r.getRoot()},e.prototype.show=function(t,e){if(e=e||{},"object"==typeof t){for(var i in t)this.setParam(i,t[i]);t=null}else{if("/"===t.substr(0,1))return this.app.show(t,e);if(0===t.indexOf("./")&&(t=t.substr(2)),0===t.indexOf("../")){var r=this.getParentView();return r?r.show(t.substr(3),e):this.app.show("/"+t.substr(3))}var n=this.getSubViewInfo(e.target);if(n){if(n.parent!==this)return n.parent.show(t,e);if(e.target&&"default"!==e.target)return this._renderFrameLock(e.target,n.subview,{url:t,params:e.params})}else if(t)return this.app.show("/"+t,e)}return this._show(this._segment,{url:t,params:e.params},this)},e.prototype._show=function(t,e,i){var r=this;return t.show(e,i,!0).then((function(){return r._init_url_data(),r._urlChange()})).then((function(){t.route.linkRouter&&(r.app.getRouter().set(t.route.path,{silent:!0}),r.app.callEvent("app:route",[t.route.path]))}))},e.prototype.init=function(t,e){},e.prototype.ready=function(t,e){},e.prototype.config=function(){this.app.webix.message("View:Config is not implemented")},e.prototype.urlChange=function(t,e){},e.prototype.destroy=function(){},e.prototype.destructor=function(){this.destroy(),this._destroyKids(),this._root&&(this._root.destructor(),t.prototype.destructor.call(this))},e.prototype.use=function(t,e){t(this.app,this,e)},e.prototype.refresh=function(){this.getUrl();return this.destroy(),this._destroyKids(),this._destroySubs(),this._detachEvents(),this._container.tagName&&this._root.destructor(),this._segment.refresh(),this._render(this._segment)},e.prototype.render=function(t,e,i){var r=this;"string"==typeof e&&(e=new c(e,0)),this._segment=e,this._parent=i,this._init_url_data();var n="string"==typeof(t=t||document.body)?this.webix.toNode(t):t;return this._container!==n?(this._container=n,this._render(e)):this._urlChange().then((function(){return r.getRoot()}))},e.prototype._render=function(t){var e=this,i=this.config();return i.then?i.then((function(i){return e._render_final(i,t)})):this._render_final(i,t)},e.prototype._render_final=function(t,e){var i,r=this,n=null,a=null,s=!1;if(this._container.tagName?a=this._container:(n=this._container).popup?(a=document.body,s=!0):a=this.webix.$$(n.id),!this.app||!a)return Promise.reject(null);var o=this._segment.current(),l={ui:{}};this.app.copyConfig(t,l.ui,this._subs),this.app.callEvent("app:render",[this,e,l]),l.ui.$scope=this,!n&&o.isNew&&o.view&&o.view.destructor();try{if(n&&!s){var c=a,u=c.getParentView();u&&"multiview"===u.name&&!l.ui.id&&(l.ui.id=c.config.id)}this._root=this.app.webix.ui(l.ui,a);var p=this._root;s&&p.setPosition&&!p.isVisible()&&p.show(),n&&(n.view&&n.view!==this&&n.view!==this.app&&n.view.destructor(),n.id=this._root.config.id,this.getParentView()||!this.app.app?n.view=this:n.view=this.app),o.isNew&&(o.view=this,o.isNew=!1),i=Promise.resolve(this._init(this._root,e)).then((function(){return r._urlChange().then((function(){return r._initUrl=null,r.ready(r._root,e.suburl())}))}))}catch(t){i=Promise.reject(t)}return i.catch((function(t){return r._initError(r,t)}))},e.prototype._init=function(t,e){return this.init(t,e.suburl())},e.prototype._urlChange=function(){var t=this;this.app.callEvent("app:urlchange",[this,this._segment]);var e=[];for(var i in this._subs){var r=this._subs[i],n=this._renderFrameLock(i,r,null);n&&e.push(n)}return Promise.all(e).then((function(){return t.urlChange(t._root,t._segment.suburl())}))},e.prototype._renderFrameLock=function(t,e,i){if(!e.lock){var r=this._renderFrame(t,e,i);r&&(e.lock=r.then((function(){return e.lock=null}),(function(){return e.lock=null})))}return e.lock},e.prototype._renderFrame=function(t,e,i){var r=this;if("default"===t){if(this._segment.next()){var n=i?i.params:null;return e.params&&(n=this.webix.extend(n||{},e.params)),this._createSubView(e,this._segment.shift(n))}e.view&&e.popup&&(e.view.destructor(),e.view=null)}if(null!==i&&(e.url=i.url,e.params&&(i.params=this.webix.extend(i.params||{},e.params))),e.route){if(null!==i)return e.route.show(i,e.view).then((function(){return r._createSubView(e,e.route)}));if(e.branch)return}var a=e.view;if(!a&&e.url){if("string"==typeof e.url)return e.route=new c(e.url,0),i&&e.route.setParams(e.route.route.url,i.params,0),e.params&&e.route.setParams(e.route.route.url,e.params,0),this._createSubView(e,e.route);"function"!=typeof e.url||a instanceof e.url||(a=new(this.app._override(e.url))(this.app,"")),a||(a=e.url)}if(a)return a.render(e,e.route||this._segment,this)},e.prototype._initError=function(t,e){return this.app&&this.app.error("app:error:initview",[e,t]),!0},e.prototype._createSubView=function(t,e){var i=this;return this.app.createFromURL(e.current()).then((function(r){return r.render(t,e,i)}))},e.prototype._destroyKids=function(){for(var t=this._children,e=t.length-1;e>=0;e--)t[e]&&t[e].destructor&&t[e].destructor();this._children=[]},e}(a),p=function(t){function e(e,i){var r=t.call(this,e,i)||this;return r._ui=i.ui,r}return i(e,t),e.prototype.config=function(){return this._ui},e}(u),h=function(){function t(t,e,i){this.path="",this.app=i}return t.prototype.set=function(t,e){this.path=t;var i=this.app;i.app.getRouter().set(i._segment.append(this.path),{silent:!0})},t.prototype.get=function(){return this.path},t}(),d=!0,f=function(t){function e(e){var i=this,r=(e||{}).webix||window.webix;return e=r.extend({name:"App",version:"1.0",start:"/home"},e,!0),(i=t.call(this,r,e)||this).config=e,i.app=i.config.app,i.ready=Promise.resolve(),i._services={},i.webix.extend(i,i.webix.EventSystem),i}return i(e,t),e.prototype.getUrl=function(){return this._subSegment.suburl()},e.prototype.getUrlString=function(){return this._subSegment.toString()},e.prototype.getService=function(t){var e=this._services[t];return"function"==typeof e&&(e=this._services[t]=e(this)),e},e.prototype.setService=function(t,e){this._services[t]=e},e.prototype.destructor=function(){this.getSubView().destructor(),t.prototype.destructor.call(this)},e.prototype.copyConfig=function(t,e,i){if((t instanceof a||"function"==typeof t&&t.prototype instanceof a)&&(t={$subview:t}),void 0!==t.$subview)return this.addSubView(t,e,i);var r=t instanceof Array;for(var n in e=e||(r?[]:{}),t){var s=t[n];if("function"==typeof s&&s.prototype instanceof a&&(s={$subview:s}),!s||"object"!=typeof s||s instanceof this.webix.DataCollection||s instanceof RegExp||s instanceof Map)e[n]=s;else if(s instanceof Date)e[n]=new Date(s);else{var o=this.copyConfig(s,s instanceof Array?[]:{},i);null!==o&&(r?e.push(o):e[n]=o)}}return e},e.prototype.getRouter=function(){return this.$router},e.prototype.clickHandler=function(t,e){if(t&&(e=e||t.target||t.srcElement)&&e.getAttribute){var i=e.getAttribute("trigger");if(i)return this._forView(e,(function(t){return t.app.trigger(i)})),t.cancelBubble=!0,t.preventDefault();var r=e.getAttribute("route");if(r)return this._forView(e,(function(t){return t.show(r)})),t.cancelBubble=!0,t.preventDefault()}var n=e.parentNode;n&&this.clickHandler(t,n)},e.prototype.getRoot=function(){return this.getSubView().getRoot()},e.prototype.refresh=function(){var t=this;return this._subSegment?this.getSubView().refresh().then((function(e){return t.callEvent("app:route",[t.getUrl()]),e})):Promise.resolve(null)},e.prototype.loadView=function(t){var e=this,i=this.config.views,r=null;if(""===t)return Promise.resolve(this._loadError("",new Error("Webix Jet: Empty url segment")));try{i&&"string"==typeof(r="function"==typeof i?i(t):i[t])&&(t=r,r=null),r||("_hidden"===t?r={hidden:!0}:"_blank"===t?r={}:(t=t.replace(/\./g,"/"),r=this.require("jet-views",t)))}catch(e){r=this._loadError(t,e)}return r.then||(r=Promise.resolve(r)),r=r.then((function(t){return t.__esModule?t.default:t})).catch((function(i){return e._loadError(t,i)}))},e.prototype._forView=function(t,e){var i=this.webix.$$(t);i&&e(i.$scope)},e.prototype._loadViewDynamic=function(t){return null},e.prototype.createFromURL=function(t){var e=this;return t.isNew||!t.view?this.loadView(t.page).then((function(i){return e.createView(i,name,t.params)})):Promise.resolve(t.view)},e.prototype._override=function(t){var e=this.config.override;if(e){for(var i=void 0;t;)i=t,t=e.get(t);return i}return t},e.prototype.createView=function(t,i,r){if("function"==typeof(t=this._override(t))){if(t.prototype instanceof e)return new t({app:this,name:i,params:r,router:h});if(t.prototype instanceof a)return new t(this,{name:i,params:r});t=t(this)}return t instanceof a?t:new p(this,{name:i,ui:t})},e.prototype.show=function(t,e){return t&&this.app&&0==t.indexOf("//")?this.app.show(t.substr(1),e):this.render(this._container,t||this.config.start,e)},e.prototype.trigger=function(t){for(var e=[],i=1;i<arguments.length;i++)e[i-1]=arguments[i];this.apply(t,e)},e.prototype.apply=function(t,e){this.callEvent(t,e)},e.prototype.action=function(t){return this.webix.bind((function(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];this.apply(t,e)}),this)},e.prototype.on=function(t,e){this.attachEvent(t,e)},e.prototype.use=function(t,e){t(this,null,e)},e.prototype.error=function(t,e){if(this.callEvent(t,e),this.callEvent("app:error",e),this.config.debug)for(var i=0;i<e.length;i++)if(console.error(e[i]),e[i]instanceof Error){var r=e[i].message;0===r.indexOf("Module build failed")?(r=r.replace(/\x1b\[[0-9;]*m/g,""),document.body.innerHTML="<pre style='font-size:16px; background-color: #ec6873; color: #000; padding:10px;'>"+r+"</pre>"):(r+="<br><br>Check console for more details",this.webix.message({type:"error",text:r,expire:-1}))}},e.prototype.render=function(t,e,i){var r=this;this._container="string"==typeof t?this.webix.toNode(t):t||document.body;var n=null;!this.$router?(d&&"tagName"in this._container&&(this.webix.event(document.body,"click",(function(t){return r.clickHandler(t)})),d=!1),"string"==typeof e&&(e=new c(e,0)),this._subSegment=this._first_start(e),this._subSegment.route.linkRouter=!0):n="string"==typeof e?e:this.app?e.split().route.path||this.config.start:e.toString();var a=i?i.params:this.config.params||null,s=this.getSubView(),o=this._subSegment,l=o.show({url:n,params:a},s).then((function(){return r.createFromURL(o.current())})).then((function(e){return e.render(t,o)})).then((function(t){return r.$router.set(o.route.path,{silent:!0}),r.callEvent("app:route",[r.getUrl()]),t}));return this.ready=this.ready.then((function(){return l})),l},e.prototype.getSubView=function(){if(this._subSegment){var t=this._subSegment.current().view;if(t)return t}return new u(this,{})},e.prototype.require=function(t,e){return null},e.prototype._first_start=function(t){var e=this;this._segment=t;if(this.$router=new this.config.router((function(t){return setTimeout((function(){e.show(t).catch((function(t){if(!(t instanceof n))throw t}))}),1)}),this.config,this),this._container===document.body&&!1!==this.config.animation){var i=this._container;this.webix.html.addCss(i,"webixappstart"),setTimeout((function(){e.webix.html.removeCss(i,"webixappstart"),e.webix.html.addCss(i,"webixapp")}),10)}if(t){if(this.app){var r=t.current().view;t.current().view=this,t.next()?(t.refresh(),t=t.split()):t=new c(this.config.start,0),t.current().view=r}}else{var a=this.$router.get();a||(a=this.config.start,this.$router.set(a,{silent:!0})),t=new c(a,0)}return t},e.prototype._loadError=function(t,e){return this.error("app:error:resolve",[e,t]),{template:" "}},e.prototype.addSubView=function(t,e,i){var r=!0!==t.$subview?t.$subview:null,n=t.name||(r?this.webix.uid():"default");return e.id=t.id||"s"+this.webix.uid(),(i[n]={id:e.id,url:r,branch:t.branch,popup:t.popup,params:t.params}).popup?null:e},e}(a),g=function(){function t(t,e){var i=this;this.config=e||{},this._detectPrefix(),this.cb=t,window.onpopstate=function(){return i.cb(i.get())}}return t.prototype.set=function(t,e){var i=this;if(this.config.routes){var r=t.split("?",2);for(var n in this.config.routes)if(this.config.routes[n]===r[0]){t=n+(r.length>1?"?"+r[1]:"");break}}this.get()!==t&&window.history.pushState(null,null,this.prefix+this.sufix+t),e&&e.silent||setTimeout((function(){return i.cb(t)}),1)},t.prototype.get=function(){var t=this._getRaw().replace(this.prefix,"").replace(this.sufix,"");if(t="/"!==t&&"#"!==t?t:"",this.config.routes){var e=t.split("?",2),i=this.config.routes[e[0]];i&&(t=i+(e.length>1?"?"+e[1]:""))}return t},t.prototype._detectPrefix=function(){var t=this.config.routerPrefix;this.sufix="#"+(void 0===t?"!":t),this.prefix=document.location.href.split("#",2)[0]},t.prototype._getRaw=function(){return document.location.href},t}(),v=!1;function m(t){if(!v&&t){v=!0;var e=window;e.Promise||(e.Promise=t.promise);var i=t.version.split(".");10*i[0]+1*i[1]<53&&(t.ui.freeze=function(e){var i=e();return i&&i.then?i.then((function(e){return t.ui.$freeze=!1,t.ui.resize(),e})):(t.ui.$freeze=!1,t.ui.resize()),i});var r=t.ui.baselayout.prototype.addView,n=t.ui.baselayout.prototype.removeView,a={addView:function(t,e){if(this.$scope&&this.$scope.webixJet&&!t.queryView){var i=this.$scope,n={};t=i.app.copyConfig(t,{},n),r.apply(this,[t,e]);var a=function(t){i._renderFrame(t,n[t],null).then((function(){i._subs[t]=n[t]}))};for(var s in n)a(s);return t.id}return r.apply(this,arguments)},removeView:function(){if(n.apply(this,arguments),this.$scope&&this.$scope.webixJet){var e=this.$scope._subs;for(var i in e){var r=e[i];t.$$(r.id)||(r.view.destructor(),delete e[i])}}}};t.extend(t.ui.layout.prototype,a,!0),t.extend(t.ui.baselayout.prototype,a,!0),t.protoUI({name:"jetapp",$init:function(e){this.$app=new this.app(e);var i=t.uid().toString();e.body={id:i},this.$ready.push((function(){this.callEvent("onInit",[this.$app]),this.$app.render({id:i})}))}},t.ui.proxy,t.EventSystem)}}var y=function(t){function e(e){var i;return e.router=e.router||g,m((i=t.call(this,e)||this).webix),i}return i(e,t),e.prototype.require=function(t,e){return require(t+"/"+e)},e}(f),_=(function(t){function e(){return null!==t&&t.apply(this,arguments)||this}i(e,t),e.prototype._detectPrefix=function(){this.prefix="",this.sufix=this.config.routerPrefix||""},e.prototype._getRaw=function(){return document.location.pathname+(document.location.search||"")}}(g),function(){function t(t,e){this.path="",this.cb=t}return t.prototype.set=function(t,e){var i=this;this.path=t,e&&e.silent||setTimeout((function(){return i.cb(t)}),1)},t.prototype.get=function(){return this.path},t}());function w(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function b(t,e,i){for(var r in t)w(t,r)&&e.call(i||t,t[r],r,t)}function x(t){t="Warning: "+t,"undefined"!=typeof console&&console.error(t);try{throw new Error(t)}catch(t){}}var k=String.prototype.replace,S=String.prototype.split,T=function(t){var e=t%10;return 11!==t&&1===e?0:2<=e&&e<=4&&!(t>=12&&t<=14)?1:2},$={arabic:function(t){if(t<3)return t;var e=t%100;return e>=3&&e<=10?3:e>=11?4:5},bosnian_serbian:T,chinese:function(){return 0},croatian:T,french:function(t){return t>1?1:0},german:function(t){return 1!==t?1:0},russian:T,lithuanian:function(t){return t%10==1&&t%100!=11?0:t%10>=2&&t%10<=9&&(t%100<11||t%100>19)?1:2},czech:function(t){return 1===t?0:t>=2&&t<=4?1:2},polish:function(t){if(1===t)return 0;var e=t%10;return 2<=e&&e<=4&&(t%100<10||t%100>=20)?1:2},icelandic:function(t){return t%10!=1||t%100==11?1:0},slovenian:function(t){var e=t%100;return 1===e?0:2===e?1:3===e||4===e?2:3}},D={arabic:["ar"],bosnian_serbian:["bs-Latn-BA","bs-Cyrl-BA","srl-RS","sr-RS"],chinese:["id","id-ID","ja","ko","ko-KR","lo","ms","th","th-TH","zh"],croatian:["hr","hr-HR"],german:["fa","da","de","en","es","fi","el","he","hi-IN","hu","hu-HU","it","nl","no","pt","sv","tr"],french:["fr","tl","pt-br"],russian:["ru","ru-RU"],lithuanian:["lt"],czech:["cs","cs-CZ","sk"],polish:["pl"],icelandic:["is"],slovenian:["sl-SL"]};function C(t){var e,i=(e={},b(D,(function(t,i){b(t,(function(t){e[t]=i}))})),e);return i[t]||i[S.call(t,/-/,1)[0]]||i.en}function R(t){return t.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}var H=/\$/g,I=/%\{(.*?)\}/g;function L(t,e,i,r){if("string"!=typeof t)throw new TypeError("Polyglot.transformPhrase expects argument #1 to be string");if(null==e)return t;var n=t,a=r||I,s="number"==typeof e?{smart_count:e}:e;if(null!=s.smart_count&&n){var o=S.call(n,"||||");n=(o[function(t,e){return $[C(t)](e)}(i||"en",s.smart_count)]||o[0]).replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"")}return n=k.call(n,a,(function(t,e){return w(s,e)&&null!=s[e]?k.call(s[e],H,"$$"):t}))}function P(t){var e=t||{};this.phrases={},this.extend(e.phrases||{}),this.currentLocale=e.locale||"en";var i=e.allowMissing?L:null;this.onMissingKey="function"==typeof e.onMissingKey?e.onMissingKey:i,this.warn=e.warn||x,this.tokenRegex=function(t){var e=t&&t.prefix||"%{",i=t&&t.suffix||"}";if("||||"===e||"||||"===i)throw new RangeError('"||||" token is reserved for pluralization');return new RegExp(R(e)+"(.*?)"+R(i),"g")}(e.interpolation)}P.prototype.locale=function(t){return t&&(this.currentLocale=t),this.currentLocale},P.prototype.extend=function(t,e){b(t,(function(t,i){var r=e?e+"."+i:i;"object"==typeof t?this.extend(t,r):this.phrases[r]=t}),this)},P.prototype.unset=function(t,e){"string"==typeof t?delete this.phrases[t]:b(t,(function(t,i){var r=e?e+"."+i:i;"object"==typeof t?this.unset(t,r):delete this.phrases[r]}),this)},P.prototype.clear=function(){this.phrases={}},P.prototype.replace=function(t){this.clear(),this.extend(t)},P.prototype.t=function(t,e){var i,r,n=null==e?{}:e;if("string"==typeof this.phrases[t])i=this.phrases[t];else if("string"==typeof n._)i=n._;else if(this.onMissingKey){r=(0,this.onMissingKey)(t,n,this.currentLocale,this.tokenRegex)}else this.warn('Missing translation for key: "'+t+'"'),r=t;return"string"==typeof i&&(r=L(i,n,this.currentLocale,this.tokenRegex)),r},P.prototype.has=function(t){return w(this.phrases,t)},P.transformPhrase=function(t,e,i){return L(t,e,i)};var A=P;var E=window.webix;E&&m(E);var M=function(t,e,i){var r=(i=i||{}).storage,n=r?r.get("lang")||"en":i.lang||"en";function a(e,a,s){a.__esModule&&(a=a.default);var l={phrases:a};i.polyglot&&t.webix.extend(l,i.polyglot);var c=o.polyglot=new A(l);if(c.locale(e),o._=t.webix.bind(c.t,c),n=e,r&&r.put("lang",n),i.webix){var u=i.webix[e];u&&t.webix.i18n.setLocale(u)}return s?Promise.resolve():t.refresh()}function s(e,r){if(!1!==i.path){var n=(i.path?i.path+"/":"")+e;a(e,t.require("jet-locales",n),r)}}var o={getLang:function(){return n},setLang:s,setLangData:a,_:null,polyglot:null};t.setService("locale",o),s(n,!0)},U=window;U.Promise||(U.Promise=U.webix.promise);var B=!1;function j(t,e,i){var r=e.$width,n=e.$height;t.config._fillApp?t.define({width:r,height:n}):t.define({left:(r-t.$width)/2,top:(n-t.$height)/2}),i||t.resize()}function V(t,e){var i=e.getRoot();t.attachEvent("onHide",(function(){i.$destructed||(webix.html.removeCss(i.$view,"webix_win_inside"),i.enable())}));var r=e.attachEvent("view:resize",(function(){j(t,i)}));t.attachEvent("onDestruct",(function(){e.detachEvent(r)}))}var O=1;function F(t,e,i){Object.defineProperty(e,i,{get:function(){return t[i]},set:function(e){return t[i]=e}})}function N(t,e){e=e||{};var i={},r={},n=function(t,e){var n=O++;return i[n]={mask:t,handler:e},e("*"===t?r:r[t],void 0,t),n},a=[],s=!1,o=function(t,e,r,n){if(s)a.push([t,e,r,n]);else for(var o=Object.keys(i),l=0;l<o.length;l++){var c=i[o[l]];c&&("*"!==c.mask&&c.mask!==t||c.handler(r,e,t,n))}};return Object.defineProperty(r,"$changes",{value:{attachEvent:n,detachEvent:function(t){delete i[t]}},enumerable:!1,configurable:!1}),Object.defineProperty(r,"$observe",{value:n,enumerable:!1,configurable:!1}),Object.defineProperty(r,"$batch",{value:function(t){if("function"!=typeof t){var e=t;t=function(){for(var t in e)r[t]=e[t]}}for(s=!0,t(r),s=!1;a.length;){var i=a.shift();o.apply(this,i)}},enumerable:!1,configurable:!1}),Object.defineProperty(r,"$extend",{value:function(t,i){for(var n in i=i||e,t)if(t.hasOwnProperty(n)){var a=t[n];i.nested&&"object"==typeof a&&a?r[n]=N(a,i):z(r,a,n,o)}},enumerable:!1,configurable:!1}),r.$extend(t,e),r}function z(t,e,i,r){Object.defineProperty(t,i,{get:function(){return e},set:function(t){if(null===e||null===t?e!==t:e.valueOf()!=t.valueOf()){var n=e;e=t,r(i,n,t,null)}},enumerable:!0,configurable:!1})}var W={start:function(t,e){t._auto_scroll_delay=webix.delay(W.autoScroll,t,[e,webix.html.pos(e)],250)},reset:function(t){t._auto_scroll_delay&&(t._auto_scroll_delay=window.clearTimeout(t._auto_scroll_delay))},autoScroll:function(t,e){var i=-1!==this.direction.indexOf("y"),r=-1!==this.direction.indexOf("x"),n=webix.html.offset(this.from.$view),a=!1;i&&W.autoYScroll.call(this,e,n,this.senseY)&&(a=!0),r&&W.autoXScroll.call(this,e,n,this.senseX)&&(a=!0),a&&(!function(t,e){if(webix.DragControl.active){var i=webix.DragControl.getNode();e=webix.copy(e),webix.DragControl.$dragPos(e,t),i.style.top=e.y+webix.DragControl.top+"px",i.style.left=e.x+webix.DragControl.left+"px"}}(t,e),this._auto_scroll_delay=webix.delay(W.autoScroll,this,[t,e],100))},autoYScroll:function(t,e,i){var r=this.from.getScrollState();return t.y<e.y+i?W.autoScrollTo.call(this,r.x,r.y-i,"y"):t.y>e.y+e.height-i&&W.autoScrollTo.call(this,r.x,r.y+i,"y")},autoXScroll:function(t,e,i){var r=this.from.getScrollState();if(t.x<e.x+i)return W.autoScrollTo.call(this,r.x-i,r.y,"x");if(t.x>e.x+e.width-i){var n=this.snode?Math.min(r.x+i,this.snode.scrollWidth-e.width):r.x+i;return n!=r.x&&W.autoScrollTo.call(this,n,r.y,"x")}return!1},autoScrollTo:function(t,e,i){this.from.scrollTo(t,e),this.from.callEvent("onAfterAutoScroll",[]);var r=this.from.getScrollState();return Math.abs(("x"===i?t:e)-r[i])<1}};function G(t){var e=webix.copy(X);e.view=t,e.master=this,e.Local=this.app.getService("local"),webix.DragControl.addDrag(t.$view,e),webix.DragControl.addDrop(t.$view,e,!0)}function q(t,e){var i=t.getBoundingClientRect(),r=(e-i.left)/i.width,n=webix.env.touch?400:200,a=.2/(i.width>n?i.width/n:1);return r<a?"start":r>1-a?"end":"move"}function Y(t){var e=this.Local.getScales();return t.senseX=Math.round(e.cellWidth*(webix.env.touch?1:.5)),t.senseY=Math.round(e.cellHeight*(webix.env.touch?3:1)),t}var X={$longTouchLimit:!0,$dragCreate:function(t,e,i){if(this.master.State.readonly)return!1;var r=this.getContext();r.$touch="touch"===i;var n=this.locateEvent(e);if(n){var a=this.view.getItem(n);if(a.$group)return!1;var s=e.target;if(s.classList.contains("webix_gantt_link"))return r.mode="links",J[r.mode].$dragCreate.call(this,t,e,n);var o=this.view.getItemNode(n);if(!r.$touch&&function(t,e){for(;t!=e;){if(t.classList.contains("webix_gantt_progress_drag"))return!0;t=t.parentNode}return!1}(s,o))return r.mode="progress",J[r.mode].$dragCreate.call(this,t,e,n);var l=this.view.getScrollState(),c=this.getEventContext(e,r),u=q(o,c.x);"task"==a.type||"start"!=u&&"end"!=u||(u="move");var p=this.Local.getScales(),h=p.cellWidth;if(p.precise){var d=this.master.app.getService("helpers").getSmallerCount(p.minUnit);h=Math.round(h/("number"==typeof d?d:d()))}if(webix.extend(r,{id:n,mode:u,node:o,step:h,dx:0,from:this.view,snode:t.querySelector(".webix_scroll_cont"),x:c.x,scroll:l,t:parseInt(o.style.top),l:parseInt(o.style.left),w:parseInt(o.style.width)},!0),!this.master.app.callEvent("bars:beforedrag",[a,r]))return!1;J[r.mode].dragScroll&&webix.extend(r,Y.call(this,J[r.mode].dragScroll));var f=o.cloneNode(!0);return f.className+=" webix_drag_zone webix_gantt_mode_"+u,o.style.visibility="hidden",webix.html.addCss(t,"webix_gantt_in_action",!0),t.style.cursor="move"==u?"move":"ew-resize",t.appendChild(f),f}return!(!this.master.app.config.split||"resources"===this.master.State.display||e.target!=t)&&(r.mode="split",J[r.mode].$dragCreate.call(this,t,e))},$dragDestroy:function(t,e){var i=this,r=this.getContext();return J[r.mode].dragScroll&&W.reset(r),r.mode&&J[r.mode].$dragDestroy?J[r.mode].$dragDestroy.call(this,t,e):(r.$waitUpdate?r.$waitUpdate.catch((function(){i.master.Action({action:"update-task-time",id:r.id})})):r.$waitUpdate=this.master.Action({action:"update-task-time",id:r.id}),r.$waitUpdate.finally((function(){r.node.style.visibility="",webix.html.remove(e),i.master.app.config.split&&r.id&&i.master.Action({action:"split-resize",id:r.id})})),t.style.cursor="",webix.html.removeCss(t,"webix_gantt_in_action"),!1)},$dragIn:function(t,e,i){var r=this.getContext();return!!r.mode&&(J[r.mode].dragScroll&&(W.reset(r),W.start(r,i)),!J[r.mode].$dragIn||J[r.mode].$dragIn.call(this,t,e,i))},$dragPos:function(t){var e=this.getContext();return J[e.mode].$dragPos.call(this,t)},$dragOut:function(t,e,i,r){var n=this.getContext();return J[n.mode].$dragOut?J[n.mode].$dragOut.call(this,t,e,i,r):null},$drop:function(t,e,i){var r=this.getContext();if(!r.mode)return!1;if(J[r.mode].$drop)return J[r.mode].$drop.call(this,t,e,i);var n=r.id,a=r.mode,s=r.dx,o=r.step,l=Math.round(s/o);if(r.timeShift=l,!this.master.app.callEvent("bars:beforedrop",[this.view.getItem(r.id),r]))return!1;r.$waitUpdate=this.master.Action({action:"update-task-time",mode:a,time:l,id:n})},locateEvent:function(t,e){return e&&(t=document.elementFromPoint(e.x,e.y)),webix.html.locate(t,"webix_l_id")},getEventContext:function(t,e){if(e.$touch){if(t.changedTouches&&(!t.touches||!t.touches[0])){var i=t.changedTouches[0];return{x:i.pageX,y:i.pageY}}return t.time?t:webix.env.touch.context(t)}return{x:t.clientX,y:t.clientY}},getContext:function(){return webix.DragControl.getContext()},setDragOffset:function(t,e,i){var r=this.getContext(),n=webix.html.pos(i),a=webix.html.offset(t);r.width=a.width,r.height=a.height,r.x_offset=a.x-n.x,r.y_offset=a.y-n.y}},K={$dragPos:function(t){var e=this.getContext(),i=this.view.getScrollState(),r=webix.DragControl.getNode(),n=e.mode,a=e.l,s=e.t,o=e.w,l=e.x,c=e.id,u=e.scroll,p=e.step,h=e.dx=t.x-l-u.x+i.x;"start"===n?(t.x=Math.min(a+h,a+o-p),r.style.width=Math.max(o-h,p)+"px"):"end"===n&&(t.x=a,r.style.width=Math.max(o+h,p)+"px"),t.y=s,this.master.Action({action:"drag-task",id:c,left:t.x,width:parseInt(r.style.width)}),this.master.app.config.split&&this.master.Action({action:"split-resize",id:c})}},J={links:{dragScroll:{direction:"xy"},$dragCreate:function(t,e,i){var r=this.getContext(),n=e.target,a=this.view.getItemNode(i),s=this.view.getScrollState(),o=webix.html.offset(n),l=n.classList;if(webix.extend(r,{id:i,from:this.view,node:a,link:n,fromStart:l.contains("webix_gantt_link_left"),start:{x:o.x+o.width/2+s.x,y:o.y+o.height/2+s.y}},!0),!this.master.app.callEvent("bars:beforedrag",[this.view.getItem(i),r]))return!1;J[r.mode].dragScroll&&webix.extend(r,Y.call(this,J[r.mode].dragScroll)),n.style.opacity=1,webix.html.addCss(a,"webix_gantt_task_in_action",!0);var c=webix.html.create("div",{visibility:"hidden"});return document.body.appendChild(c),c},$dragDestroy:function(t,e){var i=this.getContext();if(this.master.Action({action:"temp-link"}),i.target){var r=this.view.getItemNode(i.target);webix.html.removeCss(r,"webix_gantt_link_visible")}return i.link.style.opacity="",webix.html.removeCss(i.node,"webix_gantt_task_in_action"),webix.html.remove(e),!1},$dragIn:function(t,e,i){var r=this.getContext(),n=this.getEventContext(i,r),a=this.locateEvent(i,r.$touch?n:null);if(!a)return!1;var s=this.view.getItemNode(a);return a!=r.target&&(webix.html.addCss(s,"webix_gantt_link_visible",!0),r.target=a),s},$dragPos:function(t){var e=this.getContext(),i=this.view.getScrollState();e.end={x:t.x+i.x,y:t.y+i.y},this.master.Action({action:"temp-link",start:e.start,end:e.end})},$dragOut:function(t,e,i,r){var n=this.getContext(),a=this.getEventContext(r,n),s=this.locateEvent(r,n.$touch?a:null);if(n.target&&s!=n.target){var o=this.view.getItemNode(n.target);webix.html.removeCss(o,"webix_gantt_link_visible"),n.target=null}return null},$drop:function(t,e,i){var r=this.getContext(),n=r.id,a=this.getEventContext(i,r),s=this.locateEvent(i,r.$touch?a:null);if(!s||n==s)return!1;var o=this.view.getItemNode(s).getBoundingClientRect(),l=a.x-o.left<o.width/2,c=r.linkType=(r.fromStart?1:0)+(l?0:2);r.targetId=s,this.master.app.callEvent("bars:beforedrop",[this.view.getItem(n),r])&&this.master.Action({action:"add-link",source:n,target:s,type:c})}},move:{dragScroll:{direction:"x"},$dragPos:function(t){var e=this.getContext(),i=e.node,r=e.l,n=e.t,a=e.x,s=e.id,o=e.scroll,l=this.view.getScrollState(),c=e.dx=t.x-a-o.x+l.x;t.x=r+c,t.y=n,this.master.Action({action:"drag-task",id:s,left:t.x,width:parseInt(i.style.width)}),this.master.app.config.split&&this.master.Action({action:"split-resize",id:s})}},progress:{$dragCreate:function(t,e,i){var r=this.getContext(),n=this.view.getItemNode(i),a=this.view.getItem(i).progress,s=n.querySelector(".webix_gantt_progress"),o=this.getEventContext(e,r),l=this.view.getScrollState();if(webix.extend(r,{id:i,node:n,prevProgress:a,progressNode:s,from:this.view,x:o.x,w:parseInt(n.style.width),scroll:l},!0),!this.master.app.callEvent("bars:beforedrag",[this.view.getItem(i),r]))return!1;t.style.cursor="ew-resize",webix.html.addCss(t,"webix_gantt_in_action",!0),webix.html.addCss(n,"webix_gantt_mode_progress",!0);var c=webix.html.create("div",{visibility:"hidden"});return document.body.appendChild(c),c},$dragPos:function(t){var e=this.getContext(),i=e.x,r=e.scroll,n=e.w,a=e.node,s=this.view.getScrollState(),o=t.x-i-r.x+s.x,l=Math.min(Math.max(e.prevProgress+Math.round(100*o/n),0),100);e.progress!=l&&(e.progress=l,J[e.mode].updateTaskTemplate.call(this,e,l));a.style.zIndex="3",a.style.boxShadow={contrast:"#393939",dark:"#20262B"}[webix.skin.$name||"#ffffff"]+" -1px 0px 0px"},$drop:function(){var t=this.getContext(),e=t.id,i=t.progress,r=t.prevProgress;!webix.isUndefined(i)&&i!=r&&this.master.app.callEvent("bars:beforedrop",[this.view.getItem(e),t])&&(t.$waitUpdate=this.master.Action({action:"update-task-progress",progress:i,id:e}))},$dragDestroy:function(t,e){var i=this,r=this.getContext();return r.$waitUpdate?r.$waitUpdate.catch((function(){i.master.Action({action:"update-task-progress",id:r.id})})):r.$waitUpdate=this.master.Action({action:"update-task-progress",id:r.id}),t.style.cursor="",webix.html.removeCss(t,"webix_gantt_in_action"),webix.html.removeCss(r.node,"webix_gantt_mode_progress"),webix.html.remove(e),!1},updateTaskTemplate:function(t,e){var i=t.progressNode;i.style.width=e+"%",i.innerHTML=this.master.DragProgressTemplate(e)}},start:K,end:K,split:{$dragCreate:function(t,e){var i=webix.html.create("DIV",{class:"webix_gantt_split_selection"}),r=this.Local.getScales(),n=this.view.getScrollState(),a=e.target.getBoundingClientRect(),s=Math.floor((e.y-a.y+n.y)/r.cellHeight),o=e.x-a.x;i.style.top=s*r.cellHeight+6+"px",i.style.left=o+n.x+"px",i.style.height=r.cellHeight-14+"px",i.style.width="0px";var l=r.cellWidth;if(r.precise){var c=this.master.app.getService("helpers").getSmallerCount(r.minUnit);l=Math.round(l/("number"==typeof c?c:c()))}var u=this.getContext();webix.extend(u,{from:this.view,node:i,start:{offsetX:o,clientX:e.clientX},index:s,step:l,scroll:n},!0),t.appendChild(i);var p=webix.html.create("div",{visibility:"hidden"});return document.body.appendChild(p),p},$dragPos:function(t){var e=this.getContext(),i=e.dx=t.x-e.start.clientX;t.x<e.start.clientX?(e.node.style.left=e.start.offsetX+e.scroll.x+i+"px",e.node.style.width=-i+"px"):(e.node.style.left=e.start.offsetX+e.scroll.x+"px",e.node.style.width=t.x-e.start.clientX+"px")},$drop:function(){var t=this.getContext(),e=this.view.getIdByIndex(t.index),i=Math.round((t.start.offsetX+t.scroll.x)/t.step),r=Math.round(t.dx/t.step);r<0&&(i+=r,r*=-1),this.master.Action({action:"add-task",id:e,dates:{start:i,end:r}})},$dragDestroy:function(t,e){var i=this.getContext();return webix.html.remove(e),webix.html.remove(i.node),!1}}},Z=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.prototype.config=function(){var t=this;this.State=this.getParam("state",!0);var e=this.app.getService("locale")._;return{view:"abslayout",css:this.State.readonly||!this.app.config.links?"webix_gantt_readonly":"",borderless:!0,cells:[{view:"template",css:"webix_gantt_holidays",borderless:!0,relative:!0},{view:"template",css:"webix_gantt_links",borderless:!0,relative:!0},{view:"list",borderless:!0,type:this.BarsType(e),css:"webix_gantt"+(webix.env.touch?"_touch":"")+"_bars",on:{onItemClick:function(e){return t.ItemClickHandler(e)}},tooltip:function(i){return t.GetTooltip(i,e)},scroll:"xy",relative:!0}]}},e.prototype.init=function(t){var e=this,i=t.getChildViews(),r=i[0],n=i[1],a=i[2];this.Holidays=r,this.Links=n,this.Bars=a,this.Ops=this.app.getService("operations"),this.Helpers=this.app.getService("helpers");var s=this.Local=this.app.getService("local"),o=s.getScales(),l=s.links(),c=this.LinksData=l.data;this.Calendars=this.app.config.resourceCalendars,this.HandleScroll(),this.HandleDrag(o),this.HandleSelection(o),this.InitMarkers(),this.HandleHolidays(o),this.on(this.State.$changes,"display",(function(t,i){e.SyncData(!0),i&&(e.Local.refreshLinks(),e.RefreshLinks(),e.Calendars&&e.RenderResourceHolidays())})),this.DrawGrid(t,o),this.Calendars&&this.RenderResourceHolidays(o),this.on(this.app,"onScalesUpdate",(function(i){e.DrawGrid(t,i),e.Bars.refresh(),e.RefreshLinks()})),this.on(this.VisibleTasks.data,"onStoreUpdated",(function(t,i,r){e.RefreshLinks(),"update"!==r&&e.ApplySelection(),!r&&e.Calendars&&e.RenderResourceHolidays()})),this.on(c,"onStoreUpdated",(function(){e.RefreshLinks()})),this.on(this.State.$changes,"criticalPath",(function(t,i){webix.isUndefined(i)||(e.Local.showCriticalPath(!t),e.RefreshLinks())})),this.on(this.State.$changes,"compact",(function(){e.RefreshLinks()})),this.Calendars&&this.on(this.Local.assignments().data,"onStoreUpdated",(function(t,i,r){if(e.RenderResourceHolidays(),e.app.config.excludeHolidays&&r){var n=e.Local.tasks().getItem(i.task);n&&e.Ops.updateAssignedTaskDates(n)}})),this.on(this.State.$changes,"baseline",(function(t,i){webix.isUndefined(i)||e.Local.updateScaleMinMax(e.VisibleTasks)}))},e.prototype.ItemClickHandler=function(t){this.Bars.getItem(t).$group||this.State.$batch({parent:null,selected:t})},e.prototype.DrawGrid=function(t,e){t.$view.style.backgroundImage="url("+this.app.getService("helpers").drawGridInner(e.cellWidth,e.cellHeight,{contrast:"#808080",dark:"#384047"}[webix.skin.$name]||"#ccc")+")",t.$view.style.marginTop="0px";var i=this.app.getState();t.$view.style.backgroundPosition="-"+i.left+"px -"+i.top+"px",this.Resize(e.width)},e.prototype.SyncData=function(t){var e=this;this.Bars.clearAll(),this.VisibleTasks=this.Local.getVisibleTasksCollection(),this.Calendars?this.Local.taskCalendarMap().then((function(){e.Bars.sync(e.VisibleTasks)})):this.Bars.sync(this.VisibleTasks),this.ApplySelection(t)},e.prototype.BarsTemplate=function(t,e){var i=t.text||(t.$group?e("Unassigned"):e("(no title)"));return"milestone"==t.type?"<span>"+i+"</span>":i},e.prototype.BarsType=function(t){var e=this;return{template:function(i){if("tasks"===e.State.display&&"split"===i.type&&i.$data&&i.$data.length){var r=e.GetSplitBox(i),n=r.height,a=r.width,s=r.left,o=r.top,l='<div class="webix_gantt_split_container" webix_s_id="'+i.id+'" style="top:'+o+"px;left:"+s+"px;height:"+n+"px;width:"+a+'px;"></div>',c=e.VisibleTasks.data.order,u=c.length>1&&i.id==c[c.length-1];return i.$data.forEach((function(i){l+=e.TemplateStart(i,u,!0)+e.BarsTemplate(i,t)+e.TemplateEnd(i)})),l}return e.BarsTemplate(i,t)},templateStart:function(t){if("tasks"===e.State.display&&"split"===t.type&&t.$data&&t.$data.length)return"";var i=e.VisibleTasks.data.order,r=i.length>1&&t.id==i[i.length-1];return e.TemplateStart(t,r)},templateEnd:function(t){return"tasks"===e.State.display&&"split"===t.type&&t.$data&&t.$data.length?"":e.TemplateEnd()}}},e.prototype.GetSplitBox=function(t){var e=t.$data[0],i=t.$data[t.$data.length-1],r=i.$x+("milestone"==i.type?Math.floor(i.$w/2):0),n="milestone"==e.type?Math.floor(e.$w/2):e.$w;return{top:e.$y,left:r,height:e.$h,width:e.$x-r+n}},e.prototype.TemplateStart=function(t,e,i){var r=t.$w,n=t.$h,a=0,s="",o=this.BarCSS(t,e),l=this.ContentCss(t);if("milestone"==t.type)r=n=Math.ceil(Math.sqrt(Math.pow(t.$w,2)/2)),a=Math.ceil((t.$w-r)/2);else{var c="task"==t.type?this.DragProgressTemplate(t.progress):"";s='<div class="webix_gantt_progress" style="width:'+t.progress+'%;">'+c+"</div>"}var u="";return this.State.baseline&&"milestone"!==t.type&&t.planned_start&&!i&&(u=this.TemplateBaseline(t)),u+'<div webix_l_id="'+t.id+'" class="'+o+'" \n\t\t\tstyle="left:'+(t.$x+a)+"px;top:"+(t.$y+a-(u?1:0))+"px;width:"+r+"px;height:"+n+'px;" \n\t\t\tdata-id="'+t.id+'">\n\t\t\t\t<div class="webix_gantt_link webix_gantt_link_left"></div>\n\t\t\t\t'+s+'\n\t\t\t\t<div class="webix_gantt_content '+l+'">'},e.prototype.TemplateBaseline=function(t){return'<div  \n\t\t\tclass="webix_gantt_baseline_'+t.type+'" \n\t\t\tstyle="left:'+t.$x0+"px;top:"+(t.$y+t.$h-2)+"px;width:"+t.$w0+'px; " \n\t\t\tdata-baseid="'+t.id+'"></div>'},e.prototype.BarCSS=function(t,e){var i="webix_gantt_task_base webix_gantt_"+("split"===t.type?"task":t.type);return t.$critical&&(i+=" webix_gantt_critical"),t.$group&&(i+=" webix_gantt_group"),e&&(i+=" webix_gantt_last"),t.css&&"milestone"!=t.type&&(i+=" "+t.css),i},e.prototype.ContentCss=function(t){return t.css&&"milestone"==t.type?" "+t.css:""},e.prototype.TemplateEnd=function(){return'</div><div class="webix_gantt_link webix_gantt_link_right"></div></div>'},e.prototype.DragProgressTemplate=function(t){return'<div class="webix_gantt_progress_drag" style="left:'+t+'%">\n\t\t\t<span class="webix_gantt_progress_percent">'+t+"</span>\n\t\t</div>"},e.prototype.HandleDrag=function(){var t=this;G.call(this,this.Bars),this._mousemove_handler=webix.event(this.Bars.$view,"pointermove",(function(e){"mouse"==e.pointerType&&function(t,e){if(!webix.DragControl.active){var i=webix.html.locate(t,"webix_l_id");if(i&&"task"==e.getItem(i).type){var r=e.getItemNode(i),n=q(r,t.clientX);r.style.cursor="move"==n?"pointer":"ew-resize"}}}(e,t.Bars)}))},e.prototype.destroy=function(){this._mousemove_handler=webix.eventRemove(this._mousemove_handler),this._scroll_handler=webix.eventRemove(this._scroll_handler);var t=this.app.config.markers;if(t)for(var e=0;e<t.length;e++){var i=t[e];i.$interval&&(i.$interval=clearInterval(i.$interval))}},e.prototype.GetLinks=function(t){return this.Links.$view.querySelector(".webix_gantt_"+(t?"temp_line":"lines"))},e.prototype.HandleScroll=function(){var t=this;this._scroll_handler=webix.event(this.Bars.$view,"scroll",(function(e){var i=e.target,r=Math.round(i.scrollTop),n=Math.round(i.scrollLeft);if(t.holidaysContainer.style.height="0px",t.containerForMarkers.style.height="0px",t.app.config.links){var a=t.GetLinks(),s=t.GetLinks(!0),o={viewBox:n+" "+r+" "+i.scrollWidth+" "+i.scrollHeight,width:i.scrollWidth,height:i.scrollHeight};for(var l in o)a.setAttribute(l,o[l]),s.setAttribute(l,o[l])}t.SetHolidaysScroll(i.scrollHeight,n,r),t.containerForMarkers.style.height=i.scrollHeight+"px",t.getRoot().$view.style.backgroundPosition="-"+n+"px -"+r+"px",t.State.$batch({top:r,left:n})})),this.on(this.State.$changes,"top",(function(e){t.Bars.scrollTo(t.State.left,e)})),this.app.config.resources&&(this.on(this.State.$changes,"left",(function(e){t.State.resourcesDiagram&&t.Bars.scrollTo(e,t.State.top)})),this.on(this.app,"rdiagram:resize",(function(){t.holidaysContainer.style.height=t.Bars.$view.scrollHeight+"px",t.containerForMarkers.style.height=t.Bars.$view.scrollHeight+"px"})))},e.prototype.SetHolidaysScroll=function(t,e,i){this.holidaysContainer.style.height=t+"px",this.holidaysContainer.style.left=-e+"px",this.holidaysContainer.style.top=-i+"px",this.Calendars&&(this.resHolidaysContainer.style.height=t+"px",this.resHolidaysContainer.style.left=-e+"px",this.resHolidaysContainer.style.top=-i+"px")},e.prototype.HandleSelection=function(t){var e=this;this.selLine=webix.html.create("DIV",{class:"webix_gantt_bar_selection",style:"height:"+t.cellHeight+"px;width:"+t.width+"px"}),this.Bars.$view.insertBefore(this.selLine,this.Bars.$view.firstChild),this.on(this.State.$changes,"selected",(function(){return e.ApplySelection()}))},e.prototype.ApplySelection=function(t){var e=this.State.selected,i=-100;if(e&&this.Bars.data.order.length){var r=i=this.Bars.getIndexById(e),n=this.Bars.getItem(e);r<0&&("tasks"==this.State.display&&n&&0!=n.parent&&"split"===this.Bars.getItem(n.parent).type?r=this.Bars.getIndexById(n.parent):t&&!this.Bars.exists(e)&&(this.State.selected=null)),i=r*this.Local.getScales().cellHeight,this.ScrollToTask(n)}this.selLine.style.top=i+"px"},e.prototype.ScrollToTask=function(t){if(t){var e=this.Bars;(t.$x>e.$width-this.Local.getScales().cellWidth||t.$x<e.$view.scrollLeft)&&(this.State.left=t.$x-30)}this.Bars.scrollTo(this.State.left,this.State.top)},e.prototype.InitMarkers=function(){var t=this;this.containerForMarkers=webix.html.create("DIV",{class:"webix_gantt_markers",style:"height:"+this.Bars.$view.scrollHeight+"px"}),this.Bars.$view.insertBefore(this.containerForMarkers,this.Bars.$view.firstChild),this.RenderMarkers(this.app.config.markers),this.on(this.app,"onScalesUpdate",(function(){return t.RenderMarkers(t.app.config.markers)}))},e.prototype.RenderMarkers=function(t){var e=this;if(t){for(var i=[],r=0;r<t.length;r++){var n=t[r];n.now&&(n.start_date=new Date,n.$interval||(n.$interval=setInterval((function(t){e.containerForMarkers.querySelector('[gantt_now="'+t.$interval+'"]').style.left=e.GetMarkerPosition(new Date)+"px"}),3e5,n))),i.push(this.MarkerTemplate(t[r]))}this.containerForMarkers.innerHTML=i.join("")}},e.prototype.MarkerTemplate=function(t){var e=t.text?'<span class="webix_gantt_marker_text">'+t.text+"</span>":"";return'<div\n\t\t\tgantt_now="'+t.$interval+'"\n\t\t\tclass="webix_gantt_marker '+(t.css||"")+'"\n\t\t\tstyle="left:'+this.GetMarkerPosition(t.start_date)+'px">'+e+"</div>"},e.prototype.GetMarkerPosition=function(t){var e=this.Local.getScales(),i=e.start,r=e.end,n=e.cellWidth,a=e.diff,s=e.minUnit,o=this.Helpers.getUnitStart(s,i);return t<i||t>r?-100:Math.round(a(t,o,webix.Date.startOnMonday,!0)*n)},e.prototype.LinksTemplate=function(t,e){var i=this.Bars.$view;return'<svg\n\t\t\tclass="'+e+'"\n\t\t\tviewBox="'+this.State.left+" "+this.State.top+" "+i.scrollWidth+" "+i.scrollHeight+'"\n\t\t\twidth="'+i.scrollWidth+'"\n\t\t\theight="'+i.scrollHeight+'"\n\t\t>'+t+"</svg>"},e.prototype.RefreshLinks=function(){var t=this,e=[];if(this.LinksData.count()&&this.VisibleTasks.count()){var i=this.LinksData;i.order.each((function(r){var n=i.getItem(r);if(n.$p){var a=t.State.criticalPath&&t.Local.isLinkCritical(n);e.push('<polyline data-id="'+r+'" '+(a?"class='webix_gantt_line_critical'":"")+' points="'+n.$p+'" />')}}))}var r=this.LinksTemplate(e.join(""),"webix_gantt_lines")+this.LinksTemplate('<polyline points="" />',"webix_gantt_temp_line");this.Links.setHTML(r)},e.prototype.RefreshTaskLinks=function(t){var e=this;this.LinksData.find((function(e){return e.source==t||e.target==t})).forEach((function(t){var i=e.Links.$view.querySelector('[data-id="'+t.id+'"]');if(i){var r=e.VisibleTasks.getItem(t.source),n=e.VisibleTasks.getItem(t.target);e.Helpers.updateLink(t,r,n),i.setAttribute("points",t.$p)}}))},e.prototype.Resize=function(t){var e=this.Bars.$view.querySelector(".webix_scroll_cont");e.style.width=t+"px",e.style.minHeight="1px",this.selLine&&(this.selLine.style.width=t+"px")},e.prototype.Action=function(t){var e=this.app.getService("operations"),i=null;if("update-task-time"===t.action)t.time?i=e.updateTaskTime(t.id,t.mode,t.time):(this.Local.refreshTasks(t.id),"resources"===this.State.display&&this.VisibleTasks.refresh(t.id),this.RefreshTaskLinks(t.id));else if("update-task-progress"===t.action)if(webix.isUndefined(t.progress)){var r=this.VisibleTasks.getItem(t.id);this.Bars.render(t.id,r,"paint")}else i=e.updateTask(t.id,{progress:t.progress});else if("drag-task"===t.action){(r=this.VisibleTasks.getItem(t.id)).$x=parseInt(t.left),r.$w=parseInt(t.width),this.RefreshTaskLinks(t.id)}else if("add-link"===t.action){var n=t.source,a=t.target,s=t.type;i=e.addLink({source:n,target:a,type:s})}else if("temp-link"===t.action){var o=t.start,l=t.end,c=this.GetLinks(!0).firstChild;if(o){var u=this.app.getService("helpers").newLink(this.Links.$view.getBoundingClientRect(),o,l),p=u.left,h=u.top,d=u.p,f=[p,h],g=d.split(",").map((function(t,e){return 1*t+f[e%2]})).join(",");c.setAttribute("points",g)}else c.setAttribute("points","")}else if("add-task"===t.action){var v=this.Local.getScales(),m=v.precise?this.Helpers.getSmallerUnit(v.minUnit):v.minUnit;o=this.Helpers.addUnit(m,v.start,t.dates.start),l=this.Helpers.addUnit(m,o,t.dates.end);this.app.callEvent("task:add",[t.id,{start:o,end:l}])}else if("split-resize"===t.action&&"resources"!==this.State.display){if(0!=(r=this.VisibleTasks.getItem(t.id)).parent){var y=this.VisibleTasks.getItem(r.parent);if("split"===y.type){var _=this.Bars.$view.querySelector('[webix_s_id="'+r.parent+'"]');y.$data.sort((function(t,e){return e.$x-t.$x}));var w=this.GetSplitBox(y),b=w.width;p=w.left;_.style.width=b+"px",_.style.left=p+"px"}}}return i||webix.promise.resolve()},e.prototype.HandleHolidays=function(t){var e=this,i="<div class='webix_gantt_bar_holidays' style='height:"+this.Bars.$view.scrollHeight+"px'></div>";this.Calendars&&(i+="<div class='webix_gantt_bar_resource_holidays' style='height:"+this.Bars.$view.scrollHeight+"px'></div>"),this.Holidays.setHTML(i),this.holidaysContainer=this.Holidays.$view.querySelector(".webix_gantt_bar_holidays"),this.resHolidaysContainer=this.Holidays.$view.querySelector(".webix_gantt_bar_resource_holidays"),this.RenderHolidays(t),this.on(this.app,"onScalesUpdate",(function(t){return e.RenderHolidays(t)})),this.on(this.app.getRoot(),"onViewShow",(function(){e.refresh()}))},e.prototype.EachScaleDate=function(t,e){if("day"===t.minUnit||"hour"===t.minUnit){var i=webix.Date.copy(t.start),r=webix.Date.dayStart(t.end);t.end-r||(r=webix.Date.add(r,-1,"day",!0));for(var n=t.start.getHours();i<=r;)e.call(this,i,n),i=webix.Date.add(webix.Date.dayStart(i),1,"day",!0),n=webix.Date.equal(i,r)?24-Math.ceil(webix.Date.timePart(t.end)/60/60):0}},e.prototype.RenderHolidays=function(t){var e=this;if(this.holidaysContainer){var i="";this.EachScaleDate(t,(function(r,n){t.isHoliday(r)&&(i+=e.HolidayTemplate(t,r,n))})),this.holidaysContainer.innerHTML=i,this.Calendars&&this.RenderResourceHolidays(t)}},e.prototype.MarkResourceHolidays=function(t,e,i){var r=this,n=this.Bars.getIndexById(e);if(n<0)return"";var a="",s=0,o=null;return this.EachScaleDate(t,(function(e,l){var c=t.isHoliday(e);r.Helpers.isResourceHoliday(e,i)?c?s&&(a+=r.ResourceHolidayTemplate(t,o,l,n,s),s=0):(s||(o=e),s++):c&&(s&&(a+=r.ResourceHolidayTemplate(t,o,l,n,s),s=0),a+=r.ResourceWorkDayTemplate(t,e,l,n))})),a},e.prototype.RenderResourceHolidays=function(t){var e=this;this.resHolidaysContainer&&(t=t||this.Local.getScales(),this.Local.taskCalendarMap().then((function(i){var r="";if(i)for(var n in i)r+=e.MarkResourceHolidays(t,n,i[n]);e.resHolidaysContainer.innerHTML=r})))},e.prototype.GetDateBox=function(t,e,i,r){var n=this.Helpers.getUnitStart(t.minUnit,t.start),a={x:Math.round(t.diff(e,n)*t.cellWidth),w:("hour"===t.minUnit?24-i:1)*t.cellWidth};return(r||0===r)&&(a.y=t.cellHeight*r,a.h=t.cellHeight),a},e.prototype.HolidayTemplate=function(t,e,i){var r=this.GetDateBox(t,e,i);return"<div class='webix_gantt_holiday' style='"+("left:"+r.x+"px;width:"+r.w+"px;")+"'></div>"},e.prototype.ResourceHolidayTemplate=function(t,e,i,r,n){var a=this.GetDateBox(t,e,i,r),s=a.x,o=a.y;return"<div class='webix_gantt_holiday' style='"+("left:"+s+"px;width:"+a.w*n+"px;top:"+o+"px;height:"+a.h+"px;")+"'></div>"},e.prototype.ResourceWorkDayTemplate=function(t,e,i,r){var n=this.GetDateBox(t,e,i,r),a=n.x,s=n.y;return"<div class='webix_gantt_work_day' style='"+("left:"+(a+.2)+"px;width:"+(n.w-1.2)+"px;top:"+s+"px;height:"+(n.h-1)+"px;")+"'></div>"},e.prototype.GetTooltip=function(t,e){var i=webix.i18n.longDateFormatStr,r=(t.text||e("(no title)"))+"<br>\n\t\t\t<br>"+e("Start date")+": "+i(t.start_date);return"milestone"!=t.type&&(r+="<br>"+e("End date")+": "+i(t.end_date)+"\n\t\t\t<br>"+e("Lasts")+" "+t.duration+" "+(t.duration>1?e("days"):e("day"))),r},e}(u),Q=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.prototype.config=function(){return{view:"template",height:20,css:"webix_gantt_scale"}},e.prototype.init=function(){var t=this;this.State=this.getParam("state",!0),this.Local=this.app.getService("local");var e=this.Local.getScales();this.RenderScales(e),this.on(this.app,"onScalesUpdate",(function(e){return t.RenderScales(e)}))},e.prototype.ready=function(){var t=this.getRoot();this.on(this.State.$changes,"left",(function(e){return t.scrollTo(e,null)}))},e.prototype.RenderScales=function(t){var e=this,i=this.getRoot(),r=t.rows.map((function(i){var r=("hour"===i.type||"day"===i.type)&&1===i.step;return'<div class="webix_gantt_scale_row" style=\'height:'+i.height+"px;width:"+t.width+"px'>"+i.cells.map((function(t){return e.CellTemplate(t,r)})).join("")+"</div>"})).join("");i.config.height=t.height,i.setHTML(r),i.resize()},e.prototype.CellTemplate=function(t,e){return'<div class="webix_gantt_scale_cell '+t.css+(e&&this.app.config.isHoliday(t.date)?"webix_gantt_holiday_scale":"")+'" style="width:'+t.width+'px;">'+this.FormatDate(t.date,t.format)+"</div>"},e.prototype.FormatDate=function(t,e){return"string"==typeof e&&(e=webix.Date.dateToStr(e)),e(t)},e}(u),tt=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.prototype.config=function(){return{rows:[Q,Z]}},e.prototype.init=function(){var t=this;this.on(this.app,"bars:toggle",(function(e){e?t.getRoot().show():t.getRoot().hide()}))},e}(u),et=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.prototype.config=function(){return this.State=this.getParam("state",!0),{view:"abslayout",css:" webix_gantt_readonly",cells:[{view:"template",css:"webix_gantt_holidays",borderless:!0,relative:!0},{view:"tree",borderless:!0,type:this.WorkloadMarkersType(),css:"webix_gantt"+(webix.env.touch?"_touch":"")+"_bars webix_gantt_resdiagram_chart",scroll:"xy",relative:!0,filterMode:{showSubItems:!1,level:0}}]}},e.prototype.init=function(t){var e=this,i=t.getChildViews(),r=i[0],n=i[1];this.Holidays=r,this.Bars=n,this.LocalState=this.getParam("localState"),this.Unit="hours";var a=this.Local=this.app.getService("local"),s=this.Scales=a.getScales();this.RDCollection=this.app.getService("grouping").getRDCollection(),this.Helpers=this.app.getService("helpers"),this.on(this.Bars.data,"onSyncApply",(function(){e.Scales=e.Local.getScales(),e.RestoreTreeState(),e.Calendars&&e.RenderResourceHolidays()})),this.Bars.sync(this.RDCollection,(function(){this.filter((function(t){return t.$group}))})),this.Calendars=this.app.config.resourceCalendars,this.DrawGrid(t,s),this.HandleScroll(),this.HandleHolidays(s),this.on(this.app,"onScalesUpdate",(function(i){e.DrawGrid(t,i)})),this.on(this.app,"rdiagram:branch:toggle",(function(t,i){e.ToggleBranch(t,i)})),this.on(this.app,"rdiagram:resize",(function(){e.holidaysContainer.style.height=e.Bars.$view.scrollHeight+"px"})),this.on(this.app,"rdiagram:sort",(function(t,i,r){t?e.Bars.sort(t,i,r):e.Bars.sort(r,i)})),this.Calendars&&this.on(this.Local.assignments().data,"onStoreUpdated",(function(){e.RenderResourceHolidays()}))},e.prototype.ToggleBranch=function(t,e){var i=this;e?this.Bars.open(t):this.Bars.close(t);var r=this.Bars.data.getBranch("0"),n=this.Bars.getState().open.filter((function(t){return r.find((function(e){return e.id==t}))}));this._treeOpened=n.map((function(t){return i.Bars.getIndexById(t)})),this.holidaysContainer.style.height=this.Bars.$view.clientHeight+"px",this.Calendars&&(this.resHolidaysContainer.style.height=this.Bars.$view.clientHeight+"px",this.RenderResourceHolidays())},e.prototype.RestoreTreeState=function(){var t=this;if(this._treeOpened&&this._treeOpened.length){var e=this._treeOpened,i=this.Bars.data.getBranch("0");i.forEach((function(r){var n=i.indexOf(r);r.open=!e.indexOf(n),t.Bars.data.callEvent("onStoreUpdated",[r.id,0,"branch"])}))}else this.Bars.openAll()},e.prototype.HandleScroll=function(){var t=this;this._scroll_handler=webix.event(this.Bars.$view,"scroll",(function(e){var i=e.target,r=Math.round(i.scrollTop),n=Math.round(i.scrollLeft);t.getRoot().$view.style.backgroundPosition="-"+n+"px -"+r+"px",t.State.left=n,t.LocalState.top=r,t.SetHolidaysScroll(i.scrollHeight,n,r)})),this.on(this.LocalState.$changes,"top",(function(e){t.Bars.scrollTo(t.State.left,e)})),this.on(this.State.$changes,"left",(function(e){t.Bars.scrollTo(e,t.LocalState.top)})),this.on(this.app,"rdiagram:unit:change",(function(e){t.Unit=e,t.Bars.render()}))},e.prototype.WorkloadMarkersType=function(){var t=this;return{template:function(e){return t.MarkerTemplate(e)},templateStart:function(e,i){return t.MarkerStartTemplate(e,i)},templateEnd:function(){return"</div>"}}},e.prototype.MarkerStartTemplate=function(t,e){return'<div webix_tm_id="'+t.id+'" style="height:'+(this.Scales.cellHeight-8)+'px; padding: 4px;" class="'+e.classname(t,e)+' webix_gantt_diagram_line" '+e.aria(t)+">"},e.prototype.MarkerTemplate=function(t){if(2===t.$level){var e=this.GetMarkerData(t),i=[];for(var r in e)i.push(this.MarkerToHTML(e[r]));return i.join("")}return""},e.prototype.CheckResourceHoliday=function(t,e){if(this.Calendars){var i=this.Bars.getItem(e).resource_id;if(i){var r=this.Local.resources().getItem(i).calendar_id;if(r){var n=this.Local.calendars().getItem(r);return this.Helpers.isResourceHoliday(t,n)}}}return this.app.config.isHoliday(t)},e.prototype.GetMarkerData=function(t){for(var e={},i=0;i<t.duration.length;++i)for(var r=t.duration[i],n=t.units[i],a=t.$x[i]-Math.min.apply(Math,t.$x),s=this.Scales.cellHeight>40?28:20,o=this.Scales.cellWidth-s,l=Math.round(o/2),c=a?-2:l,u=webix.Date.copy(t.start_date[i]),p=0;p<r;++p,c+=o){if(this.app.config.excludeHolidays&&this.CheckResourceHoliday(u,t.id))++r;else{var h=0;h="hour"!==this.Scales.minUnit&&(p===r-1?n[1]:p?n[2]:n[0])||n[2];var d=t.$x[i]+p*this.Scales.cellWidth-2;e[d]?(e[d].hours+=h,e[d].count+=1):e[d]={hours:h,x:d+l,count:1},e[d].overloaded=this.CheckOverload(e[d],t)}webix.Date.add(u,1,this.Scales.minUnit)}return e},e.prototype.CheckOverload=function(t){return"hour"===this.Scales.minUnit?Math.round(24*t.hours)>this.Helpers.unitLoadNorm.day:t.hours>this.Helpers.unitLoadNorm[this.Scales.minUnit]},e.prototype.MarkerToHTML=function(t){var e=t.overloaded?"webix_gantt_overload":"",i="hours"===this.Unit?t.hours>=1?t.hours:" ":t.count;return'<div class="webix_gantt_diagram_marker '+e+'" style="left:'+t.x+'px;">'+i+"</div>"},e.prototype.RenderResourceHolidays=function(t){var e=this;t=t||this.Local.getScales();var i="";this.Bars.data.each((function(r){if(r.resource_id){var n=e.Local.resources().getItem(r.resource_id).calendar_id;n&&(i+=e.MarkResourceHolidays(t,r.id,e.Local.calendars().getItem(n)))}})),this.resHolidaysContainer.innerHTML=i},e}(Z);function it(t){return function(e,i){return e[t].localeCompare(i[t],void 0,{ignorePunctuation:!0,numeric:!0})}}function rt(t,e){return t&&t.length==e.length&&t.every((function(t){return e.includes(t)}))}var nt=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.prototype.config=function(){var t=this;this.State=this.getParam("state",!0);var e=this.app.getService("local").getScales(),i=this._=this.app.getService("locale")._,r=this.Compact=this.getParam("compact",!0),n=[{id:"name",css:"webix_gantt_title",header:r?"<span class='webix_icon gti-menu'>":i("Name"),template:function(e,i){return t.TreeTemplate(e,i)},fillspace:!0,sort:r?"":it("name"),minWidth:r?44:150},{id:"load",header:i("Hours"),hidden:r,batch:"hours",sort:"int",minWidth:50,resize:!1},{id:"count",header:i("Tasks"),batch:"tasks",sort:"int",minWidth:50,hidden:!0,resize:!1}],a=webix.skin.$name,s={view:"treetable",css:"webix_gantt_resdiagram_tree "+("material"==a||"mini"==a?"webix_header_border":""),prerender:!0,borderless:"contrast"===a,width:r?44:this.State.treeWidth,rowHeight:e.cellHeight,headerRowHeight:e.height,scroll:"xy",scrollAlignY:!1,sort:!0,resizeColumn:{headerOnly:!0,size:10},columns:n,tooltip:function(){return""},on:{onViewResize:function(){t.State.treeWidth=t.Tree.$width},onAfterOpen:function(e){return t.ToggleBranch(e,1)},onAfterClose:function(e){return t.ToggleBranch(e,0)},onAfterSort:function(e,i,r){return t.SortTasks(e,i,r)},onColumnResize:function(e,i,r,n){return t.NormalizeColumns(e,n)}},onClick:{"gti-menu":function(){return t.ToggleColumns()}},filterMode:{showSubItems:!1,level:0}},o=this.LocalState=this.getParam("localState");return s.on.onScrollY=s.on.onSyncScroll=s.on.onAfterScroll=function(){o.top=this.getScrollState().y},s},e.prototype.init=function(t){var e=this;this.Tree=t,this.Helpers=this.app.getService("helpers"),this.Local=this.app.getService("local"),this.RDCollection=this.app.getService("grouping").getRDCollection(),this._unit="hours",this._collapsed=!0,this.on(this.LocalState.$changes,"top",(function(t){e.Tree.scrollTo(null,t)})),this.on(this.Tree.data,"onSyncApply",(function(){return e.RestoreTreeState()})),t.sync(this.RDCollection,(function(){this.filter((function(t){return t.$group}))})),this.on(this.State.$changes,"treeWidth",(function(i){e.Compact||t.$width===i||(t.define({width:i}),t.resize())})),this.on(this.app,"rdiagram:unit:change",(function(t){return e.ShowInUnits(t)})),this.on(this.app,"onScalesUpdate",(function(t){var i=e.Tree.columnId(0);e.Tree.getColumnConfig(i).header[0].height=t.height,e.Tree.refreshColumns()}))},e.prototype.RestoreTreeState=function(){var t=this;if(this._treeOpened&&this._treeOpened.length){var e=this._treeOpened,i=this.Tree.data.getBranch("0");i.forEach((function(r){var n=i.indexOf(r);r.open=!e.indexOf(n),t.Tree.data.callEvent("onStoreUpdated",[r.id,0,"branch"])}))}else this.Tree.openAll()},e.prototype.TreeTemplate=function(t,e){var i=this.Compact&&this._collapsed;return 1==t.$level?i?e.icon(t):e.treetable(t,e)+t.category:i?this.Helpers.resourceAvatar(t):e.space(t)+this.Helpers.resourceAvatar(t)+t.name},e.prototype.ShowInUnits=function(t){this._unit=t;var e=this.Tree,i=e.config.columns,r=i[i.length-1].fillspace;this.Compact&&this._collapsed||e.showColumnBatch(t),this.SetColumns(0,r)},e.prototype.NormalizeColumns=function(t,e){e&&this.SetColumns(this.Tree.getColumnIndex(t),!0)},e.prototype.SetColumns=function(t,e){var i=this.Tree.config.columns,r=i.length-1;0===t?(i[r].fillspace=e,i[r].width=0,i[r].resize=!1):t===r&&(i[0].fillspace=!0,i[0].width=0),this.Tree.refreshColumns()},e.prototype.ToggleColumns=function(){var t=this.Tree,e=t.isColumnVisible("load"),i=t.isColumnVisible("count"),r=this._collapsed=e||i;r?(e&&t.hideColumn("load"),i&&t.hideColumn("count")):"hours"===this._unit?t.showColumn("load"):t.showColumn("count"),t.config.width=r?44:0,t.config.columns[0].minWidth=r?44:150,t.resize(),t.refreshColumns(),this.app.callEvent("rdiagram:tree:toggle",[r])},e.prototype.ToggleBranch=function(t,e){var i=this,r=this.Tree.data.getBranch("0"),n=this.Tree.getState().open.filter((function(t){return r.find((function(e){return e.id==t}))}));this._treeOpened=n.map((function(t){return i.Tree.getIndexById(t)})),this.app.callEvent("rdiagram:branch:toggle",[t,e])},e.prototype.SortTasks=function(t,e,i){this.app.callEvent("rdiagram:sort",[t,e,i])},e}(u),at=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.prototype.config=function(){var t=this,e=this.app.getService("locale")._,i=this.getParam("compact",!0),r="contrast"===webix.skin.$name,n=this.app.getService("local").getScales().minUnit;return{type:r?"clean":"line",rows:[{view:"toolbar",borderless:r,elements:[{},{view:"radio",width:330,value:"hours",localId:"radio",options:[{id:"hours",value:e("Hours per")+" "+e(n)},{id:"tasks",value:e("Tasks per")+" "+e(n)}],on:{onChange:function(e){t.app.callEvent("rdiagram:unit:change",[e])}}}]},{type:"clean",cols:[nt,{view:i?"spacer":"resizer",css:"webix_gantt_resizer",width:i?1:4},{localId:"diagram",rows:[Q,et]}]}]}},e.prototype.init=function(){var t=this,e=N({top:0});this.setParam("localState",e),this.on(this.app,"rdiagram:tree:toggle",(function(e){e?t.$$("diagram").show():t.$$("diagram").hide()}));var i=this.app.getService("locale")._,r=this.$$("radio");this.on(this.app,"onScalesUpdate",(function(t,e){t.minUnit!==e.minUnit&&(r.config.options.map((function(e){var r=e.value.split(" ");r[r.length-1]=i(t.minUnit),e.value=r.join(" ")})),r.refresh())}))},e}(u),st=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.prototype.config=function(){var t=this,e=this._=this.app.getService("locale")._,i={css:"webix_gantt_datepicker",type:"calendar",body:{height:270,width:250,icons:!0,events:function(e){return t.app.config.isHoliday(e)&&"webix_cal_event"}}};return{view:"form",localId:"form",borderless:!0,autoheight:!0,elementsConfig:{labelPosition:"top"},padding:{left:3,right:3},visibleBatch:"added",elements:[{batch:"added",rows:[{view:"datepicker",name:"planned_start",label:e("Start date"),suggest:webix.copy(i)},{view:"datepicker",name:"planned_end",label:e("End date"),suggest:webix.copy(i)},{view:"counter",name:"planned_duration",css:"webix_gantt_form_counter",min:1,max:1e3,label:e("Duration")}]},{batch:"none",cols:[{view:"button",type:"icon",icon:"wxi-plus",autowidth:!0,label:e("Add dates"),click:function(){return t.AddBtnClickHandler()},css:"webix_transparent"},{}]},{batch:"added",cols:[{},{view:"button",type:"icon",icon:"wxi-trash",autowidth:!0,label:e("Remove dates"),click:function(){return t.RemoveBtnClickHandler()},css:"webix_transparent"},{}]}],on:{onChange:function(e,i,r){t.Compact?t.UpdateTaskTime():"user"==r&&t.UpdateTask()}}}},e.prototype.init=function(){var t=this;this.State=this.getParam("state",!0),this.Ops=this.app.getService("operations"),this.Form=this.$$("form"),this.Tasks=this.app.getService("local").tasks(),this.on(this.State.$changes,"selected",(function(e){e&&t.FillData(e)})),this.on(this.Tasks.data,"onStoreUpdated",(function(e,i,r){"update"==r&&e==t.State.selected&&t.FillData(e)}))},e.prototype.FillData=function(t){this.Tasks.getItem(t).planned_start?this.$$("form").showBatch("added"):this.$$("form").showBatch("none"),this.Form.setValues(this.Tasks.getItem(t))},e.prototype.PrepareDates=function(t){var e=this._eventSource=this.Form.$eventSource.config.name,i=!0;return"planned_duration"==e||"planned_start"==e&&"project"==t.type?t.planned_end=null:"planned_end"==e||"planned_start"==e?t.planned_duration=null:i=!1,i},e.prototype.UpdateTaskTime=function(){var t=this.Form.getValues();if(this.PrepareDates(t)){var e=this._eventSource?this._eventSource.split("_")[1]:null;"duration"==e&&(e=null),this.Ops.updatePlannedTaskDuration(t,e),this.Form.blockEvent(),this.Form.setValues(t,!0),this.Form.unblockEvent()}},e.prototype.UpdateTask=function(){var t=this.State.selected,e=this.Form.getValues();this.Compact||this.PrepareDates(e);var i=this._eventSource?this._eventSource.split("_")[1]:null;"duration"==i&&(i=null),this.Ops.updateTask(t,e,i,!1,!0)},e.prototype.AddBtnClickHandler=function(){var t=this.State.selected,e=this.Form.getValues(),i={planned_start:e.start_date,planned_end:e.end_date,planned_duration:e.duration};this.Ops.updateTask(t,i,null,!1,!0)},e.prototype.RemoveBtnClickHandler=function(){var t=this,e=this.State.selected;webix.confirm(this._("Planned dates will be removed, are you sure?")).then((function(){t.Ops.updateTask(e,{planned_start:null,planned_end:null,planned_duration:null},null,!1,!0)}))},e}(u),ot=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.prototype.config=function(){var t=this,e=this.app.getService("locale")._,i={view:"treetable",css:"webix_gantt_tree webix_gantt_form_tree",header:!1,borderless:!0,localId:"links",autoheight:!0,editable:!0,scroll:!1,hover:"webix_gantt_link_table_hover",scheme:{$group:{by:"ttype"}},columns:[{id:"task",css:"webix_gantt_title",header:e("Task"),fillspace:!0,template:function(t){return t.$group?'<span class="webix_strong">'+e("source"==t.ttype?e("Successors"):e("Predecessors"))+"</span>":t.text||e("(no title)")}},{id:"type",css:"webix_gantt_type",header:e("Link"),width:140,template:function(t,e,i,r){return t.$group?"":r.collection.getItem(i).value+'<span class="webix_icon wxi-menu-down"></span>'},editor:"richselect",options:[{id:"0",value:e("End to start")},{id:"1",value:e("Start to start")},{id:"2",value:e("End to end")},{id:"3",value:e("Start to end")}]},{width:30,css:"webix_gantt_action",template:function(t){return t.$group?"":"<span class='webix_icon wxi-trash'></span>"}}],on:{onBeforeEditStart:function(t){return!this.getItem(t).$group},onBeforeEditStop:function(e,i){if(e.value!=e.old)return t.UpdateLink(i.row,{type:1*e.value}),!1},onAfterLoad:function(){this.openAll()}},onClick:{"wxi-trash":function(i,r){webix.confirm({container:t.app.getRoot().$view,title:e("Delete link"),text:e("The link will be deleted permanently, are you sure?")}).then((function(){return t.DeleteLink(r)}))}}};return{padding:{top:webix.skin.$active.layoutMargin.form,bottom:5},rows:[i]}},e.prototype.init=function(){var t=this;this.State=this.getParam("state",!0),this.Ops=this.app.getService("operations"),this.Links=this.$$("links"),this.on(this.State.$changes,"selected",(function(e){e&&t.FillData(e)}));var e=this.app.getService("local").links();this.on(e.data,"onStoreUpdated",(function(e,i){if(i){var r=t.State.selected;i.target!==r&&i.source!==r||t.FillData(r)}}))},e.prototype.FillData=function(t){var e=this.app.getService("local"),i=e.getLinks(t,"target").concat(e.getLinks(t,"source"));this.Links.clearAll(),i.length?(this.Links.parse(i),this.getRoot().show()):this.getRoot().hide()},e.prototype.UpdateLink=function(t,e){var i=this;this.Ops.updateLink(t,e).then((function(){i.Links.blockEvent(),i.Links.editCancel(),i.Links.unblockEvent(),e.type+="",i.Links.updateItem(t,e)}))},e.prototype.DeleteLink=function(t){var e=this;this.Ops.removeLink(t).then((function(){e.FillData(e.State.selected)}))},e}(u);webix.editors.gantt_numeditor=webix.extend({render:function(){var t=webix.editors.text.render.call(this),e=t.querySelector("input");return e.type="number",e.min=0,t}},webix.editors.text);var lt=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.prototype.config=function(){var t=this,e=this._=this.app.getService("locale")._;this.Local=this.app.getService("local"),this.Helpers=this.app.getService("helpers");var i=this.app.config,r=this.IsSingle="single"==i.resources||i.resourceCalendars,n={cols:[{view:"button",type:"icon",icon:"wxi-plus",autowidth:!0,localId:"addBtn",label:e("Add assignment"),click:function(){return t.AddBtnClickHandler()},css:"webix_transparent"},{}]},a={view:"treetable",css:"webix_gantt_resource_table webix_gantt_tree webix_gantt_form_tree",header:!1,borderless:!0,localId:"resources",autoheight:!0,editable:!0,editaction:"custom",scroll:!1,hover:"webix_gantt_table_hover",rowHeight:Math.max(webix.skin.$active.rowHeight,32),columns:[{id:"resource",css:"webix_gantt_title",fillspace:!0,template:function(e){return t.ResourceTemplate(e)},editor:"richselect",suggest:{width:250,css:"webix_gantt_select_editor_popup",padding:0,point:0,body:{width:250,type:{height:Math.max(webix.skin.$active.listItemHeight,32)},template:function(e){return r?t.OptionTemplate(e):t.EditorOptionTemplate(e)}}}},{id:"value",width:85,css:"webix_gantt_value",template:function(e){return t.ValueTemplate(e)},editFormat:function(t){return parseFloat(t)},editParse:function(t){return t=parseFloat(t),isNaN(t)?0:t},editor:"gantt_numeditor"},{id:"remove",width:30,css:"webix_gantt_action",template:function(e){return t.DeleteIconTemplate(e)}}],on:{onItemClick:function(e){t.Table.getItem(e).$group||"remove"==e.column||(t.Table.editRow(e),"value"==e.column&&t.Table.getEditor(e.row,"resource").getPopup().hide(),t.Table.getEditor(e.row,e.column).focus())},onBeforeEditStart:function(e){var i=t.Table.getItem(e.row);if(i.$group)return!1;if("resource"==e.column){t.Table.addCellCss(e.row,e.column,"webix_gantt_select_editor");var n=e&&!r?i.resource:null;t.FilterOptions(n)}return!0},onAfterEditStart:function(e){if("value"==e.column){var i=t.Table.getItem(e.row),r=t.Table.getEditor(e.row,"value").getInputNode(),n=t.GetRange(i);n&&t.ApplyEditorLimits(r,n);var a=t.GetValueStep(i);a&&t.ApplyEditorStep(r,a)}},onBeforeEditStop:function(e,i){if(t.Table.removeCellCss(i.row,"resource","webix_gantt_select_editor"),e.value!=e.old){var r={};if(r[i.column]=e.value,"value"==i.column){var n=t.Table.getItem(i.row),a=t.GetRange(n);a?t.ApplyValueRange(r,a):r.value<0&&(r.value=0),i.getInputNode().value=r.value}t.UpdateAssignment(i.row,r)}return!0},onAfterLoad:function(){this.openAll()}},onClick:{webix_gantt_remove_icon:function(i,r){webix.confirm({container:t.app.getRoot().$view,title:e("Delete assignment"),text:e("Are you sure to delete this assignment?")}).then((function(){return t.RemoveAssignment(r.row)}))}}};return r||(a.scheme={$group:{by:"category"}}),{margin:webix.skin.$active.layoutMargin.form,padding:{top:webix.skin.$active.layoutMargin.form,bottom:5},rows:[a,n]}},e.prototype.init=function(){var t=this;if(this.State=this.getParam("state",!0),this.Ops=this.app.getService("operations"),this.Helpers=this.app.getService("helpers"),this.Table=this.$$("resources"),this.Local=this.app.getService("local"),this.Resources=this.Local.resources(),!this.app.config.resources)return!1;this.on(this.State.$changes,"selected",(function(e){e&&t.FillData(e)}))},e.prototype.FillData=function(t){var e=this;if("task"!=this.Local.tasks().getItem(t).type)return!1;this.Local.getAssignments(t).then((function(t){if(!e.getRoot())return!1;e.Table.clearAll(),e.Table.getColumnConfig("resource").collection=e.Resources,t.length?(e.Table.show(),e.Table.parse(e.GetData(t)),e.IsSingle&&e.$$("addBtn").disable()):(e.IsSingle&&e.$$("addBtn").enable(),e.Table.hide())}))},e.prototype.GetData=function(t){return t.sort(this.app.getService("operations").sortResources),t},e.prototype.FilterOptions=function(t){var e=[],i=t?this.Resources.getItem(t).category_id:null;this.Table.data.each((function(t){e.push(t.resource)})),this.Resources.filter((function(r){return(!i||r.category_id==i)&&(e.indexOf(r.id)<0||t&&r.id==t)}))},e.prototype.UpdateAssignment=function(t,e){var i=this,r=this.Table.$view.querySelector(".webix_gantt_select_editor");if(r){var n=1*r.getAttribute("aria-rowindex");this.Table.removeCellCss(this.Table.data.getIdByIndex(n-1),"resource","webix_gantt_select_editor")}this.Ops.updateAssignment(t,e).then((function(){i.CloseEditor(t,e)}))},e.prototype.GetRange=function(t){var e=this.Resources.getItem(t.resource);return this.Helpers.getResourceValueRange(e)},e.prototype.ApplyValueRange=function(t,e){t.value<e[0]?t.value=e[0]:t.value>e[1]&&(t.value=e[1])},e.prototype.ApplyEditorLimits=function(t,e){t.min=e[0],t.max=e[1]},e.prototype.GetValueStep=function(t){var e=this.Resources.getItem(t.resource);return this.Helpers.getResourceValueStep(e)},e.prototype.ApplyEditorStep=function(t,e){t.step=e},e.prototype.CloseEditor=function(t,e){this.Table.blockEvent(),this.Table.editCancel(),this.Table.unblockEvent(),this.Table.updateItem(t,e)},e.prototype.RemoveAssignment=function(t){var e=this;this.Ops.removeAssignment(t).then((function(){e.FillData(e.State.selected)}))},e.prototype.AddBtnClickHandler=function(){var t=this;this.FilterOptions(),webix.delay((function(){t.ShowPopup()}))},e.prototype.AddAssignment=function(t){var e=this;this.IsSingle&&this.$$("addBtn").disable(),this.Ops.addAssignment({resource:t.id,value:this.Helpers.getDefaultResourceValue(t),task:this.State.selected}).then((function(){e.FillData(e.State.selected)}))},e.prototype.ResourceTemplate=function(t){if(t.$group)return'<span class="webix_strong">'+t.category+"</span>";if(t.resource){var e=this.Resources.getItem(t.resource);return this.EditorTemplate(e)}return""},e.prototype.ValueTemplate=function(t){if(t.$group)return"";var e=t.value;return(isNaN(e)?this.Helpers.getDefaultResourceValue(t):e)+this.GetUnitName(t)},e.prototype.GetUnitName=function(t){return this._(this.Helpers.getResourceUnit(t))},e.prototype.DeleteIconTemplate=function(t){return t.$group?"":"<span class='webix_icon wxi-trash webix_gantt_remove_icon'></span>"},e.prototype.GetPopupConfig=function(){var t=this;return{view:"suggest",localId:"popup",width:320,padding:0,point:0,fitMaster:!1,borderless:!0,css:"webix_gantt_select_editor_popup",body:{view:"list",minHeight:28,type:{height:Math.max(webix.skin.$active.listItemHeight,32)},data:this.Resources,template:function(e){return t.OptionTemplate(e)},on:{onItemClick:function(e){t.AddAssignment(t.Resources.getItem(e)),t.Popup.hide()}}}}},e.prototype.ShowPopup=function(){this.Popup&&this.Popup.$view||(this.Popup=this.ui(this.GetPopupConfig()),this.SetPopupPlaceholder()),this.Popup.show(this.$$("addBtn").$view,{x:1})},e.prototype.SetPopupPlaceholder=function(t){this.Popup.getBody().$view.firstChild.setAttribute("placeholder",t||this._("No resources to add"))},e.prototype.OptionTemplate=function(t){return"<div class='webix_gantt_avatar_option_box'>"+('<div class="webix_gantt_avatar_box_inline">'+(this.Helpers.resourceAvatar(t)+("<div class='webix_gantt_editor_avatar_name'>"+t.name+"</div>"))+"</div>")+("<span class='webix_gantt_resource_section'>"+t.category+"</span>")+"</div>"},e.prototype.EditorTemplate=function(t){return'<div class="webix_gantt_avatar_box">'+this.Helpers.resourceAvatar(t)+" "+("<div class='webix_gantt_editor_avatar_name'>"+t.name+"</div>")+"<span class='webix_icon wxi-menu-down'></span></div>"},e.prototype.EditorOptionTemplate=function(t){return'<div class="webix_gantt_avatar_box">'+this.Helpers.resourceAvatar(t)+" "+("<div class='webix_gantt_editor_avatar_name'>"+t.name+"</div>")+"</div>"},e}(u),ct=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.prototype.config=function(){var t=this;this.Compact=this.getParam("compact",!0);var e=this.app.getService("locale")._;this.isResources=this.app.config.resources,this.State=this.getParam("state",!0);var i=webix.skin.$active,r={view:"toolbar",css:"webix_subbar",borderless:!0,padding:{left:i.layoutPadding.form-(i.inputHeight-20)/2,right:i.layoutPadding.form},elements:[{view:"icon",icon:"wxi-close",click:function(){return t.Close()}},{},{view:"button",width:130,css:"webix_primary",value:e("Done"),click:function(){return t.Done()}}]},n={css:"webix_gantt_datepicker",type:"calendar",body:{height:270,width:250,icons:!0,events:function(e){return t.app.config.isHoliday(e)&&"webix_cal_event"}}},a=[{id:"task",value:e("Task")},{id:"milestone",value:e("Milestone")}];this.app.config.projects||a.splice(1,0,{id:"project",value:e("Project")});var s=[];this.app.config.links&&s.push({header:e("Related tasks"),body:ot,collapsed:!0}),this.isResources&&s.push({localId:"resourcesItem",header:"single"==this.isResources||this.app.config.resourceCalendars?e("Assignment"):e("Assignments"),body:{$subview:lt,name:"resources"},collapsed:!0,hidden:!0}),this.State.baseline&&s.push({localId:"baselineItem",header:e("Planned dates"),body:{$subview:st,name:"baseline"},collapsed:!0,hidden:!0});var o={multi:!0,view:"accordion",borderless:!0,type:"clean",margin:10,css:"webix_gantt_accordion",rows:s};return{view:"proxy",body:{margin:0,padding:{bottom:14},rows:[r,{view:"form",localId:"form",borderless:!0,autoheight:!1,scroll:!0,elementsConfig:{labelPosition:"top"},elements:[{view:"text",name:"text",label:e("Title")},{view:"richselect",localId:"types",name:"type",label:e("Type"),options:a,on:{onChange:function(e){return t.ToggleControls(e)}}},{view:"datepicker",name:"start_date",label:e("Start date"),suggest:webix.copy(n)},{view:"datepicker",name:"end_date",label:e("End date"),suggest:webix.copy(n)},{view:"counter",name:"duration",css:"webix_gantt_form_counter",min:1,max:1e3,label:e("Duration")},{view:"slider",name:"progress",title:webix.template("#value#%"),label:e("Progress")},o,{view:"textarea",name:"details",label:e("Notes"),height:150}],on:{onChange:function(e,i,r){t.Compact?t.UpdateTaskTime():"user"==r&&t.UpdateTask().then((function(){"type"!==t._eventSource||"user"!==r||"split"!==e&&"split"!==i||t.Tasks.data.callEvent("onStoreUpdated",[])}))}}}]}}},e.prototype.init=function(){var t=this;this.Ops=this.app.getService("operations"),this.Local=this.app.getService("local"),this.Tasks=this.Local.tasks(),this.Form=this.$$("form"),this.on(this.State.$changes,"selected",(function(e){e&&t.FillData(e)})),this.on(this.Tasks.data,"onStoreUpdated",(function(e,i,r){"update"==r&&e==t.State.selected&&t.FillData(t.State.selected)})),this.on(this.State.$changes,"display",(function(e){var i=t.$$("form").elements.type;"tasks"==e?i.enable():"resources"==e&&i.disable()})),this.app.config.resourceCalendars&&this.on(this.Local.assignments().data,"onStoreUpdated",(function(){return t.SetResourceHolidays()})),this.on(this.State.$changes,"baseline",(function(e,i){webix.isUndefined(i)||t.SetBaselineVisibility(t.Tasks.getItem(t.State.selected))}))},e.prototype.FillData=function(t){var e=this.Tasks.getItem(t),i=this.$$("types").getList();this.app.config.split&&e.$count?i.exists("split")||i.add({id:"split",value:this.app.getService("locale")._("Split task")}):i.exists("split")&&i.remove("split"),this.app.config.projects&&this.LimitTypeOptions(e),this.app.config.resourceCalendars&&this.SetResourceHolidays(),this.isResources&&this.SetResourcesVisibility(e),this.State.baseline&&this.SetBaselineVisibility(e),this.Form.setValues(e),this.Form.focus()},e.prototype.SetResourcesVisibility=function(t){var e=this.$$("resourcesItem");if("task"==t.type){if(!e.isVisible()){var i=this.getSubView("resources");i&&i.FillData(t.id),e.show()}}else e.isVisible()&&e.hide()},e.prototype.SetBaselineVisibility=function(t){var e=this.$$("baselineItem");if(!this.State.baseline||"task"!=t.type&&"project"!=t.type)e.isVisible()&&e.hide();else if(!e.isVisible()){var i=this.getSubView("baseline");i&&i.FillData(t.id),e.show()}},e.prototype.LimitTypeOptions=function(t){var e=this.Form.elements.type;"project"===t.type?e.hide():e.show()},e.prototype.PrepareDates=function(t){var e=this._eventSource=this.Form.$eventSource.config.name,i=!0;return"duration"==e||"start_date"==e&&"project"==t.type?t.end_date=null:"end_date"==e||"start_date"==e?t.duration=null:i=!1,i},e.prototype.UpdateTaskTime=function(){var t=this.Form.getValues(),e=this.PrepareDates(t);if("type"===this._eventSource&&"split"!==t.type&&(t.open=t.opened=1),this.RemoveTagsFromText(t)&&(this.Form.blockEvent(),this.Form.setValues(t,!0),this.Form.unblockEvent()),e){var i=this._eventSource?this._eventSource.split("_")[0]:null;this.Ops.updateTaskDuration(t,i),this.Form.blockEvent(),this.Form.setValues(t,!0),this.Form.unblockEvent()}},e.prototype.RemoveTagsFromText=function(t){return("text"===this._eventSource||"details"===this._eventSource)&&(t[this._eventSource]=(t[this._eventSource]||"").replace(/(<[^>]+>|^\s+|\s+$)/gi,""),!0)},e.prototype.UpdateTask=function(){var t=this,e=this.State.selected,i=this.Form.getValues();this.Compact||(this.PrepareDates(i),this.RemoveTagsFromText(i));var r=this._eventSource?this._eventSource.split("_")[0]:null;return"type"===this._eventSource&&"split"!==i.type&&(i.open=i.opened=1),this._inProgress=this.Ops.updateTask(e,i,r),this._inProgress.finally((function(){return t._inProgress=null})),this._inProgress},e.prototype.ToggleControls=function(t){if(this.Form.elements.end_date.show(),this.Form.elements.duration.show(),this.Form.elements.progress.show(),this.Form.elements.end_date.enable(),this.Form.elements.duration.enable(),this.Form.elements.progress.enable(),"project"==t||"milestone"==t){var e="project"==t?"disable":"hide";this.Form.elements.end_date[e](),this.Form.elements.duration[e](),this.Form.elements.progress[e]()}},e.prototype.Close=function(){var t=this;if(this.Compact&&this.Form.isDirty()){var e=this.app.getService("locale")._;webix.confirm({container:this.app.getRoot().$view,text:e("Save changes?")}).then((function(){return t.Done(!0)}),(function(){return t.Back(!0)}))}else this.Back(!0)},e.prototype.Back=function(t){t?this.State.$batch({edit:null,selected:null}):this.State.edit=null},e.prototype.Done=function(t){var e=this;this.Compact&&this.Form.isDirty()?this._inProgress?this._inProgress.then((function(){e.Back(t)})):this.UpdateTask().then((function(){return e.Back(t)})):this.Back(t)},e.prototype.SetResourceHolidays=function(){var t=this,e=[],i=this.Form.elements,r=this.app.getService("helpers");e.push(i.start_date,i.end_date);var n=this.Local.getTaskCalendar(this.State.selected);e.forEach((function(e){var i=e.getPopup().getBody();i.config.events=function(e){return(n?r.isResourceHoliday(e,n):t.app.config.isHoliday(e))&&"webix_cal_event"},i.refresh()}))},e}(u),ut=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.prototype.config=function(){var t=this,e=this._=this.app.getService("locale")._,i=this.State=this.getParam("state",!0),r={view:"button",width:130,label:e("Edit"),css:"webix_primary",click:function(){return t.EditTask()}},n=webix.skin.$active,a={view:"toolbar",css:"webix_subbar",borderless:!0,padding:{left:n.layoutPadding.form-(n.inputHeight-20)/2,right:n.layoutPadding.form},elements:[{view:"icon",icon:"wxi-close",click:function(){return t.Close()}},{},i.readonly?{}:r]},s={localId:"text",view:"template",css:"webix_gantt_task_info",template:function(e){return t.InfoTemplate(e)},borderless:!0},o={view:"button",label:e("Delete task"),css:"webix_danger webix_gantt_danger",align:"center",inputWidth:330,click:function(){webix.confirm({container:t.app.getRoot().$view,title:e("Delete task"),text:e("The task will be deleted permanently, are you sure?")}).then((function(){return t.DeleteTask()}))}};return{view:"proxy",body:{margin:0,rows:[a,{type:"form",borderless:!0,rows:[s,i.readonly?{}:o]}]}}},e.prototype.init=function(){var t=this;this.Local=this.app.getService("local"),this.Tasks=this.Local.tasks(),this.Text=this.$$("text"),this.isResources=this.app.config.resources,this.on(this.State.$changes,"selected",(function(e){e&&t.FillTemplate(e)})),this.on(this.Tasks.data,"onStoreUpdated",(function(e,i,r){"update"==r&&e==t.State.selected&&t.FillTemplate(t.State.selected)}));var e=this.Local.links();this.on(e.data,"onStoreUpdated",(function(e,i){if(i){var r=t.State.selected;i.target!==r&&i.source!==r||t.FillTemplate(r)}})),this.isResources&&this.on(this.Local.assignments().data,"onStoreUpdated",(function(e,i){i&&i.task==t.State.selected&&t.FillTemplate(i.task)})),this.on(this.State.$changes,"baseline",(function(e,i){webix.isUndefined(i)||t.FillTemplate(t.State.selected)}))},e.prototype.FillTemplate=function(t){var e=this,i=webix.copy(this.Tasks.getItem(t));i.sources=this.Local.getLinks(t,"source"),i.targets=this.Local.getLinks(t,"target"),this.isResources&&"task"==i.type?this.Local.getAssignments(t).then((function(t){if(!e.getRoot())return!1;i.resources=t.sort(e.app.getService("operations").sortResources),e.Text.setValues(i)})):this.Text.setValues(i)},e.prototype.EditTask=function(){this.State.edit=!0},e.prototype.DeleteTask=function(){this.app.getService("operations").removeTask(this.State.selected),this.Close()},e.prototype.Close=function(){this.State.$batch({edit:null,selected:null})},e.prototype.InfoTemplate=function(t){if(!t.start_date)return"";var e=this._,i='<span class="webix_gantt_task_title">'+(t.text||e("(no title)"))+"</span><br><br>";return i+=this.BaseTemplate(t),i+=this.LinkTemplate(t),this.State.baseline&&t.planned_start&&(i+=this.BaselineTemplateChunk(t,e("Planned dates"))),t.details&&(i+='<br><br><div class="webix_gantt_task_title">'+e("Notes")+'</div>\n\t\t\t\t<br><div class="webix_gantt_task_text">'+t.details.replace(/(?:\r\n|\r|\n)/g,"<br>")+"</div>"),i},e.prototype.BaseTemplate=function(t){var e=this._,i='<span class="webix_strong">'+e("Start date")+"</span>: "+this.DateFormat(t.start_date)+"<br>";return"milestone"!==t.type&&(i+='<span class="webix_strong">'+e("End date")+"</span>: "+this.DateFormat(t.end_date)+'<br>\n\t\t\t<span class="webix_strong">'+e("Duration")+"</span>: "+t.duration+'<br>\n\t\t\t<span class="webix_strong">'+e("Progress")+"</span>: "+t.progress+"%\n\t\t<br>"),i},e.prototype.LinkTemplate=function(t){var e="",i=this._;if(t.targets.length&&(e+=this.InfoTemplateChunk(t.targets,i("Predecessors"))),t.sources.length&&(e+=this.InfoTemplateChunk(t.sources,i("Successors"))),t.resources){var r="single"==this.isResources||this.app.config.resourceCalendars;e+=this.ResourcesTemplateChunk(t.resources,i(r?"Assignment":"Assignments"))}return e},e.prototype.ResourcesTemplateChunk=function(t,e){var i=this;if(!t||!t.length)return"";var r=130;return t.forEach((function(t){var e=webix.html.getTextSize(t.name,"webix_gantt_info_list_text"),i=webix.html.getTextSize(t.category,"webix_gantt_info_list_text webix_gantt_resource_section");r=Math.max(r,e.width,i.width)})),r=Math.min(200,r),'<br><span class="webix_strong">'+e+'</span>:<br><ul class="webix_gantt_info_list_resources">'+t.map((function(t){var e=i.app.getService("helpers"),n="<div>"+e.resourceAvatar(t,"webix_gantt_person_avatar_big")+"</div>",a="<div class=' webix_gantt_info_list_text webix_gantt_resource_section' style='min-width:"+r+"px'>"+t.category+"</div>",s="<div class='webix_gantt_resource_section'>"+t.value+i._(e.getResourceUnit(t))+"</div>";return"<div class='webix_gantt_info_resource'>"+n+("<div  >"+("<div class='webix_gantt_info_list_text_row'><div class='webix_gantt_info_list_text' style='min-width:"+r+"px'>"+t.name+"</div>"+s+"</div>")+a+"</div>")+"</div>"})).join("")+"</ul>"},e.prototype.InfoTemplateChunk=function(t,e){var i=this;return'<br><span class="webix_strong">'+e+"</span>:<br><ul>"+t.map((function(t){return"<li>"+(t.text||i._("(no title)"))+"</li>"})).join("")+"</ul>"},e.prototype.DateFormat=function(t){return webix.i18n.longDateFormatStr(t)},e.prototype.BaselineTemplateChunk=function(t,e){var i=this.app.getService("locale")._;return'<br><span class="webix_strong">'+e+'</span><br><div class="webix_gantt_info_list_planned">'+(i("Start date")+": "+this.DateFormat(t.planned_start)+"<br>"+i("End date")+": "+this.DateFormat(t.planned_end)+"<br>"+i("Duration")+": "+t.planned_duration+"<br>")+"</div>"},e}(u),pt=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.prototype.config=function(){return this.app.getService("jet-win").updateConfig({view:"window",borderless:!0,fullscreen:!0,head:!1,body:{$subview:!0}})},e}(u),ht=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.prototype.config=function(){var t=this,e=this.State=this.getParam("state",!0);this.Local=this.app.getService("local"),this.Helpers=this.app.getService("helpers");var i=this.Local.getScales(),r=this._=this.app.getService("locale")._,n=this.Compact=this.getParam("compact",!0);this.isResources=this.app.config.resources,this.maxAvatarNumber=3;var a={id:"action",css:"webix_gantt_action",header:{text:'<span webix_tooltip="'+r("Add task")+'" class="webix_icon wxi-plus-circle"></span>',css:"webix_gantt_action"},template:function(){return'<span webix_tooltip="'+r("Add task")+'" class="webix_icon wxi-plus"></span>'},width:44,minWidth:44},s=[{id:"text",css:"webix_gantt_title",header:r("Title"),template:function(e,i){return i.treetable(e,i)+t.TitleTemplate(e)},fillspace:!0,hidden:n,batch:"full",sort:it("text"),minWidth:150},{id:"start_date",header:r("Start date"),format:webix.i18n.dateFormatStr,hidden:n,batch:"full",sort:"date",minWidth:100}];this.isResources&&s.push({id:"resources",css:"webix_gantt_tree_column_resources",header:r("Assigned"),template:function(e){return t.ResourcesTemplate(e)},minWidth:100}),n?(a.header.text="<span class='webix_icon gti-menu'>",e.readonly&&(a.template=""),s.unshift(a)):e.readonly||s.push(a),s[s.length-1].resize=!1;var o=webix.skin.$name,l={view:"treetable",css:"webix_gantt_tree "+("material"==o||"mini"==o?"webix_header_border":""),prerender:!0,width:n?44:e.treeWidth,rowHeight:i.cellHeight,headerRowHeight:i.height,scroll:"xy",scrollAlignY:!1,select:"row",sort:"multi",resizeColumn:{headerOnly:!0,size:10},drag:!e.readonly&&"order",columns:s,tooltip:function(){return""},onClick:{"wxi-plus":function(e,i){return t.AddTask(i.row)},"wxi-plus-circle":function(){return t.AddTask("0")},"gti-menu":function(){return t.ToggleColumns()}},on:{onBeforeOpen:function(e){return t.HandleToggle(e)},onAfterOpen:function(e){t.ToggleBranch(e,1),t.ApplySelection()},onAfterClose:function(e){return t.ToggleBranch(e,0)},onBeforeSelect:function(e){return t.BeforeSelectHandler(e)},onItemClick:function(e){return t.ItemClickHandler(e)},onAfterSort:function(e,i,r){return t.SortTasks(e,i,r)},onColumnResize:function(e,i,r,n){return t.NormalizeColumns(e,n)},onBeforeDrag:function(e,i){return t.BeforeDragHandler(e,i)},onBeforeDrop:function(e){return t.BeforeDropHandler(e)},onViewResize:function(){t.State.treeWidth=t.Tree.$width}}};return l.on.onScrollY=l.on.onSyncScroll=l.on.onAfterScroll=function(){e.top=this.getScrollState().y},l},e.prototype.init=function(t){var e=this;this.Tree=t,this.State=this.getParam("state",!0),this.Ops=this.app.getService("operations"),this.Helpers=this.app.getService("helpers"),this.Tasks=this.Local.tasks(),this.on(this.State.$changes,"display",(function(t){e.Mode=t,e.State.top=0,e.SyncData()})),this.isResources&&(this.on(this.Assignments.data,"onStoreUpdated",(function(){e.Tree.refresh()})),this.on(this.Tree.data,"onStoreUpdated",(function(t){"resources"!=e.Mode||t||e.ApplySelection()}))),this.on(this.State.$changes,"top",(function(t){return e.Tree.scrollTo(null,t)})),this.on(this.State.$changes,"selected",(function(t){t?e.ApplySelection():e.Tree.unselect()})),this.on(this.app,"onScalesUpdate",(function(t){var i=e.Tree.columnId(0);e.Tree.getColumnConfig(i).header[0].height=t.height,e.Tree.refreshColumns()})),this.on(this.app,"task:add",(function(t,i){return e.AddTask(t||"0",i)})),this.on(this.State.$changes,"treeWidth",(function(i){e.Compact||t.$width===i||(t.define({width:i}),t.resize())}))},e.prototype.HandleToggle=function(t){var e=this.Tree.getItem(t);if("split"===e.type&&e.$data.length)return!1},e.prototype.ItemClickHandler=function(t){this.Tree.getItem(t).$group?this.app.callEvent("edit:stop"):this.State.$batch({parent:null,selected:t.row})},e.prototype.BeforeSelectHandler=function(t){return!this.Tree.getItem(t).$group},e.prototype.BeforeDragHandler=function(t,e){if("tasks"==this.Mode){var i=this.Tree.getItem(t.start);if("split"===i.type&&i.$data.length){var r=this.Tree.$dragHTML(this.Tree.getItem(t.start),e,t);t.html=r.replace("webix_dd_drag","webix_dd_drag webix_gantt_tree_no_icon")}return!0}return!1},e.prototype.BeforeDropHandler=function(t){return this.Ops.moveTask(t.start,t.parent,t.index),!1},e.prototype.SyncData=function(){var t=this;this.Tree.clearAll(),this.VisibleTasks=this.Local.getVisibleTasksCollection(),this.resDisplayed="resources"===this.State.display,this.resDisplayed&&!this.clearEvID&&(this.clearEvID=this.on(this.VisibleTasks.data,"onClearAll",(function(){t.resDisplayed&&t.RefreshData()}))),this.RefreshData()},e.prototype.GetLoaders=function(){var t=[this.VisibleTasks.waitData];return this.isResources&&(this.Resources=this.Local.resources(),this.Assignments=this.Local.assignments(),t.push(this.Resources.waitData,this.Assignments.waitData)),t},e.prototype.RefreshData=function(){var t=this,e=this.GetLoaders();webix.promise.all(e).then((function(){t.Tree.sync(t.VisibleTasks),t.ApplySelection(),t.ApplySorting()}))},e.prototype.ApplySelection=function(){var t=this.State.selected;if(t&&this.Tree.exists(t)&&this.Tree.getSelectedId()!=t){var e=void 0,i=this.Tree.getItem(t);if("tasks"===this.State.display){var r=i.parent,n=0!=r?this.Tree.getItem(r):null;n&&"split"===n.type?e=r:this.Local._isTaskVisible(i)&&(e=t)}else this.Local._isTaskVisible(i)&&(e=t);e&&(this.Tree.select(e),this.Tree.showItem(e))}},e.prototype.ApplySorting=function(){this.State.sort&&(this.Tree.data.blockEvent(),this.Tree.setState({sort:this.State.sort}),this.Tree.data.unblockEvent())},e.prototype.AddTask=function(t,e){var i=this;this.State.selected=null;var r,n=this.Tree.getItem(t),a=n?0:-1,s=this.GetNewTask(n,e);if("resources"==this.Mode&&n)r=this.AddTaskWithAssignment(s,t);else if(n&&e){var o=void 0;this.app.config.resources&&(o=this.Assignments.find((function(t){return t.task==n.id}))),r=o&&o.length?this.SplitTaskWithAssignment(s,a,t,n,o):this.Ops.splitTaskWithDnd(s,a,t,n)}else r=this.Ops.addTask(s,a,n?t:0);return this.app.callEvent("backend:operation",[r]),r.then((function(e){n&&"tasks"==i.Mode&&"split"!==n.type&&i.Tree.open(t),i.State.$batch({edit:!0,selected:e.id}),i.Tree.showItem(e.id)})),!1},e.prototype.GetNewTask=function(t,e){var i=this.GetDates(t,e),r=i.start,n=i.end;return{start_date:new Date(r),end_date:n||webix.Date.add(r,1,"day",!0),progress:0,text:""}},e.prototype.GetDates=function(t,e){if(e)return e;var i;if(t&&"split"===t.type){var r=t.$data&&t.$data.length?t.$data[0].end_date:t.end_date;i=this.Helpers.addUnit("day",r,1)}else if(t)i=t.start_date;else{var n=this.Local.getScales();i=webix.Date.add(n.start,1,n.minUnit)}return{start:i,end:void 0}},e.prototype.AddTaskWithAssignment=function(t,e){var i=this;this.Tasks.data.blockEvent(),this.Assignments.data.blockEvent();var r="0";e&&(r=this.Tree.getItem(e).$group?"0":e);var n=0;return this.Tasks.data.branch[r]&&(n=this.Tasks.data.branch[r].length),this.Ops.addTask(t,n,r).then((function(r){t.id=r.id;for(var n=[],a=null;"0"!=e&&!a;)(a=i.Tree.getItem(e).resources)||(e=i.Tree.getParentId(e));return a&&a.length&&a.forEach((function(e){var r=i.Local.resources().getItem(e);n.push(i.Ops.addAssignment({resource:e,value:i.Helpers.getDefaultResourceValue(r),task:t.id}))})),n.length?webix.promise.all(n).then((function(){return r})):webix.promise.resolve(r)})).finally((function(){i.Tasks.data.unblockEvent(),i.Assignments.data.unblockEvent(),i.Tasks.data.callEvent("onStoreUpdated",[t.id,t,"add"])}))},e.prototype.SplitTaskWithAssignment=function(t,e,i,r,n){var a=this;return this.Ops.splitTaskWithDnd(t,e,i,r).then((function(t){if(t.sibling){for(var e=[],i=0;i<n.length;++i)e.push(a.Ops.updateAssignment(n[i].id,{task:t.sibling}).then((function(){return t})));return webix.promise.all(e).then((function(){return t}))}return t}))},e.prototype.RefreshTasks=function(){this.Tasks.data.callEvent("onStoreUpdated",[])},e.prototype.SortTasks=function(t,e,i){var r=webix.isArray(t)?t:{by:t,dir:e,as:i},n=this.Tree.getState().sort;this.VisibleTasks.sort(r),this.State.sort=n},e.prototype.ToggleColumns=function(){var t=this.Tree.isColumnVisible("text");this.Tree.showColumnBatch("full",!t),this.Tree.config.width=t?44:0,this.Tree.resize(),this.app.callEvent("bars:toggle",[t])},e.prototype.NormalizeColumns=function(t,e){if(e){var i=this.Tree,r=i.config.columns,n=i.getColumnIndex(t),a=r.length-1;"action"===r[a].id&&(a-=1),0===n?(r[a].fillspace=!0,r[a].width=0):n===a&&(r[0].fillspace=!0,r[0].width=0),i.refreshColumns()}},e.prototype.ToggleBranch=function(t,e){if("resources"!=this.State.display)this.RefreshTasks(),this.State.readonly||this.Ops.updateTask(t,{opened:e});else{var i=this.VisibleTasks;i.getItem(t).open=!!e,i.data.callEvent("onStoreUpdated",[t,0,"branch"])}},e.prototype.TitleTemplate=function(t){return t.text||(t.$group?this._("Unassigned"):this._("(no title)"))},e.prototype.ResourcesTemplate=function(t){var e=this;if(this.Assignments.count()&&this.Resources.count()){var i=[];return this.Assignments.data.each((function(r){r.task==t.id&&i.push(e.Resources.getItem(r.resource))})),i.sort(this.Ops.sortResources),this.GetAssignmentsHTML(i)}return""},e.prototype.GetAssignmentsHTML=function(t){var e=this,i="";if(t.length>this.maxAvatarNumber){var r=t.length-this.maxAvatarNumber+1,n=(t=t.splice(0,this.maxAvatarNumber)).pop(),a=this.Helpers.resourceAvatar(n),s="<div class='webix_gantt_cell_remain_num'>+"+r+"</div>";i=t.map((function(t){return""+e.Helpers.resourceAvatar(t,null,!0)})).join(""),i+="<div class='webix_gantt_cell_assigned_last'>"+a+s+"</div>"}else{if(i=t.map((function(t){return""+e.Helpers.resourceAvatar(t,null,!0)})).join(""),1==t.length)i+="<span class='webix_gantt_cell_assigned_text'>"+t[0].name.split(" ")[0]+"</span>"}return"<div class='webix_gantt_avatar_box'>"+i+"</div>"},e}(u),dt=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.prototype.config=function(){var t=this;B||(B=!0,webix.protoUI({name:"r-layout",sizeTrigger:function(t,e,i){this._compactValue=i,this._compactHandler=e,this._app=t;var r=t.config;this._forceCompact=void 0!==r.params.forceCompact,this._compactWidth=r.compactWidth,this._forceCompact||this._checkTrigger(this.$view.width,i)},_checkTrigger:function(t,e){return!this._compactWidth||!(t<=this._compactWidth&&!e||t>this._compactWidth&&e)||(this._compactWidth=null,this._compactHandler(!e),!1)},$setSize:function(t,e){(this._forceCompact||this._checkTrigger(t,this._compactValue))&&webix.ui.layout.prototype.$setSize.call(this,t,e),this._app&&this._app.callEvent("view:resize",[])}},webix.ui.layout)),this.fCompact=this.getParam("forceCompact"),webix.isUndefined(this.fCompact)||this.setParam("compact",this.fCompact),this.Compact=this.getParam("compact"),this.State=this.getParam("state",!0);var e=this.Compact?{$subview:!0,name:"edit",popup:!0}:{view:"proxy",css:"webix_shadow_medium",borderless:!0,width:400,hidden:!0,localId:"edit",body:{$subview:!0,name:"edit"}},i=[ht,{view:this.Compact?"spacer":"resizer",css:"webix_gantt_resizer",width:this.Compact?1:4},tt];return this.app.config.resources?i=[{type:"clean",rows:[{type:"clean",cols:i,on:{onViewResize:function(){t.app.callEvent("rdiagram:resize",[])}}},{view:"resizer",css:"webix_gantt_resizer",localId:"rdResizer"},{view:"proxy",localId:"rdiagram",height:this.Compact?0:400,body:{$subview:!0,name:"rdiagram"}}]},e]:i.push(e),{view:"abslayout",css:"webix_gantt",cells:[{view:"r-layout",localId:"main",borderless:!0,relative:!0,type:"clean",cols:i},{css:"webix_gantt_absbutton",view:"icon",icon:"wxi-plus",localId:"add",hidden:!this.Compact||this.State.readonly,width:50,height:50,right:20,bottom:20,click:function(){t.app.callEvent("task:add",[])}}]}},e.prototype.init=function(t){var e=this;this.$$("main").sizeTrigger(this.app,(function(t){return e.SetCompactMode(t)}),!!this.Compact),this.on(this.State.$changes,"selected",(function(t,i){t?e.ShowTask(e.State.edit?"form":"info"):i&&e.HideTask()})),this.on(this.State.$changes,"edit",(function(t){e.State.selected&&e.ShowTask(t?"form":"info")})),webix.extend(t,webix.ProgressBar),this.on(this.app,"backend:operation",(function(e){t.showProgress({type:"top",delay:2e3}),e.finally((function(){t.hideProgress()}))})),this.app.config.resources&&this.on(this.State.$changes,"resourcesDiagram",(function(t){t?(e.$$("rdiagram").show(),e.$$("rdResizer").show(),e.show("rdiagram",{target:"rdiagram"})):(e.$$("rdiagram").hide(),e.$$("rdResizer").hide(),e.show("_blank",{target:"rdiagram"}).then((function(){e.app.callEvent("rdiagram:resize",[])})))}))},e.prototype.ShowTask=function(t){t="task."+t,this.Compact?this.show("task.popup/"+t,{target:"edit"}):(this.$$("edit").show(),this.show(t,{target:"edit"}))},e.prototype.HideTask=function(){this.show("_blank",{target:"edit"}),this.Compact||this.$$("edit").hide()},e.prototype.SetCompactMode=function(t){var e=this;webix.delay((function(){e.State.$batch({top:0,left:0}),e.setParam("compact",t),e.refresh()}))},e}(u),ft={JetView:u};ft["chart/bars"]=Z,ft.chart=tt,ft["chart/scale"]=Q,ft["rdiagram/diagram"]=et,ft.rdiagram=at,ft["rdiagram/tree"]=nt,ft["task/baseline"]=st,ft["task/form"]=ct,ft["task/info"]=ut,ft["task/links"]=ot,ft["task/popup"]=pt,ft["task/resources"]=lt,ft.top=dt,ft.tree=ht;var gt=function(){function t(t,e){this.app=t,this.state=t.getState(),this.Helpers=this.app.getService("helpers"),this.resetScales(e),this.dateToLocalStr=webix.Date.dateToStr(webix.i18n.parseFormat)}return t.prototype.setScales=function(t,e,i,r,n,a){var s=this._scales;r?(this._scaleBase={width:r,height:n,scales:a},e=webix.Date.add(e,1,"day")):(r=this._scaleBase.width,n=this._scaleBase.height,a=this._scaleBase.scales),this._scales=this.app.getService("helpers").setScales(t,e,i,r,n,a),this._taskHeight=this._scales.cellHeight-12;var o=this.getVisibleTasksCollection();o&&o.data.order.length&&("resources"===this.state.display?this.app.getService("grouping").refreshResourceTasks():this.refreshTasks(),this.refreshLinks()),this.app.callEvent("onScalesUpdate",[this._scales,s])},t.prototype.getScales=function(){return this._scales},t.prototype.resetScales=function(t){t=t||this.app.config;var e=webix.skin.$active,i=t.scaleStart||webix.Date.dayStart(new Date),r=t.scaleEnd||webix.Date.add(i,1,"month",!0);this.setScales(i,r,t.preciseTimeUnit,t.scaleCellWidth||80,e.barHeight-2*e.borderWidth,t.scales||[{unit:"day",step:1,format:"%d"}])},t.prototype.getTaskHeight=function(){return this._taskHeight},t.prototype.adjustScale=function(t){var e=t.start_date,i=t.end_date;this.state.baseline&&t.planned_start&&t.planned_end&&(e>t.planned_start&&(e=t.planned_start),i<t.planned_end&&(i=t.planned_end));var r=this.getScales();e=this.Helpers.addUnit(r.minUnit,e,-1),i=this.Helpers.addUnit(r.minUnit,i,1),(r&&r.start>e||r.end<i)&&this.setScales(r.start>e?e:r.start,r.end<i?i:r.end,r.precise)},t.prototype.tasks=function(t){var e=this;if(this._tasks&&!t)return this._tasks;this._tasks?this._tasks.clearAll():this._tasks=this.createTasks();var i=[this.app.getService("backend").tasks()];return this.app.config.resourceCalendars&&i.push(this.taskCalendarMap(!1,t)),this._tasks.parse(webix.promise.all(i).then((function(t){return e.app.getService("grouping").getTreeData(t[0],0)}))),this._tasks},t.prototype.createTasks=function(){var t=this,e=this.app.getService("operations"),i=new webix.TreeCollection({on:{"data->onStoreLoad":function(){t.app.config.scaleStart||t.updateScaleMinMax(i),i.data.each((function(e){t.app.config.projects&&e.$count&&(e.type="project")}))},"data->onStoreUpdated":function(e,i,r){e="update"==r?e:null,t.refreshTasks(e),t.refreshLinks(),!r&&t.state.criticalPath&&(t.app.config.links?t._links.waitData.then((function(){return t.showCriticalPath()})):t.showCriticalPath())}},scheme:{$change:function(i){i.start_date=webix.i18n.parseFormatDate(i.start_date),i.end_date=webix.i18n.parseFormatDate(i.end_date),i.type=i.type||"task",t.app.config.split||"split"!==i.type||(i.type="task"),e.updateTaskDuration(i),i.planned_start&&(i.planned_start=webix.i18n.parseFormatDate(i.planned_start),i.planned_end=webix.i18n.parseFormatDate(i.planned_end),e.updatePlannedTaskDuration(i)),"split"===i.type?(i.open=i.opened=0,i.$css="webix_gantt_split_task"):(delete i.$css,i.open=1*(i.open||i.opened)||0)},$sort:{by:"position",dir:"asc",as:"int"},$serialize:function(e){return t.taskOut(e)},$export:function(e){return t.taskOut(e)}}});return i},t.prototype.refreshTasks=function(t,e){var i=this;if(t){var r=this._tasks.getItem(t);(e=webix.isUndefined(e)?this._tasks.getIndexById(t):e)<0&&(e=this._tasks.getIndexById(r.parent)),"split"===r.type&&(r.$data=this._tasks.find((function(t){return t.parent==r.id})).sort((function(t,e){return e.start_date-t.start_date||e.end_date-t.end_date}))),this.Helpers.updateTask(r,e),this.state.baseline&&r.planned_start&&this.refreshBaseline(r,e)}else this._tasks.data.order.forEach((function(t,e){i.refreshTasks(t,e)}))},t.prototype.refreshBaseline=function(t,e){var i=r({},t);i.start_date=t.planned_start,i.duration=t.planned_duration,i.end_date=t.planned_end,this.Helpers.updateTask(i,e,this._scales,this._taskHeight),t.$x0=i.$x,t.$w0=i.$w},t.prototype.links=function(t){return this._links&&!t||(this._links?this._links.clearAll():this._links=this.createLinks(),this.app.config.links&&this._links.parse(this.app.getService("backend").links())),this._links},t.prototype.createLinks=function(){var t=this;return new webix.DataCollection({on:{"data->onStoreUpdated":function(e,i,r){r&&t.refreshLinks(e)}},scheme:{$init:function(t){t.type=1*t.type}}})},t.prototype.refreshLinks=function(t){var e=this,i=this.getVisibleTasksCollection();this._links&&i&&(this._links.data.each((function(t){var r=i.getItem(t.source),n=i.getItem(t.target);r&&n&&e._isTaskVisible(r)&&e._isTaskVisible(n)?e.Helpers.updateLink(t,r,n):t.$p=""})),this.state.criticalPath&&t&&this.showCriticalPath())},t.prototype.getLinks=function(t,e){for(var i=this._links.find((function(i){return i[e]==t})),r=[],n=0;n<i.length;n++){var a=i[n],s=this._tasks.getItem(a["source"==e?"target":"source"]);s&&r.push({id:a.id,type:a.type.toString(),text:s.text,ttype:e})}return r},t.prototype.taskOut=function(t){t=webix.copy(t);var e=this.dateToLocalStr;for(var i in t.start_date&&(t.start_date=e(t.start_date)),t.end_date&&(t.end_date=e(t.end_date)),t)0===i.indexOf("$")&&delete t[i];return t},t.prototype._isTaskVisible=function(t,e){var i=this.getVisibleTasksCollection(e),r=t.$parent,n="split"===t.type&&!t.open;if(n&&!r)return!1;for(;t.$parent;)if(!(r==(t=i.getItem(t.$parent)).id&&"split"==t.type||t.open)||t.open&&n)return!1;return!0},t.prototype.categories=function(t){return this._categories&&!t||(this._categories?this._categories.clearAll():this._categories=new webix.DataCollection({}),this._categories.parse(this.app.getService("backend").categories())),this._categories},t.prototype.resources=function(t){var e=this;if(this._resources&&!t)return this._resources;this._resources?this._resources.clearAll():this._resources=new webix.DataCollection({});var i=[this.app.getService("backend").resources(),this.categories(t).waitData];return this.app.config.resourceCalendars&&i.push(this.calendars(t).waitData),this._resources.parse(webix.promise.all(i).then((function(t){var i=t[0];return i.forEach((function(t){if(t.category_id){var i=e.categories().getItem(t.category_id);t.category=i.name,!t.unit&&i.unit&&(t.unit=i.unit)}})),i.sort(e.app.getService("operations").sortResources),i}))),this._resources},t.prototype.assignments=function(t){return this._assignments&&!t||(this._assignments?this._assignments.clearAll():this._assignments=new webix.DataCollection({}),this._assignments.parse(this.app.getService("backend").assignments())),this._assignments},t.prototype.getAssignments=function(t){var e=this;return webix.promise.all([this.resources().waitData,this.assignments().waitData]).then((function(){var i=e.resources();return e.assignments().data.find((function(e){return e.task==t})).map((function(t){var e=Object.assign({},t),r=Object.assign({},i.getItem(t.resource));return delete r.id,Object.assign(e,r)}))}))},t.prototype.calendars=function(t){return this._calendars&&!t||(this._calendars?this._calendars.clearAll():this._calendars=this.createCalendars(),this._calendars.parse(this.app.getService("backend").calendars())),this._calendars},t.prototype.createCalendars=function(){return new webix.DataCollection({scheme:{$change:function(t){"string"==typeof t.weekDays&&(t.weekDays=t.weekDays.split(",").map((function(t){return 1*t}))),t.holidays&&("string"==typeof t.holidays&&(t.holidays=t.holidays.split(",")),t.holidays=t.holidays.map((function(t){return webix.Date.datePart(new Date(t))})))}}})},t.prototype.showCriticalPath=function(t){var e=this;if(t)this._tasks.data.order.forEach((function(t){delete e._tasks.getItem(t).$critical}));else{var i=this._tasks.data.getRange().sort((function(t,e){return e.end_date-t.end_date||(t.parent==e.id?1:e.parent==t.id?-1:0)||e.start_date-t.start_date})),r=webix.Date.copy(i[0].end_date);i.forEach((function(t){t.$critical=e.isTaskCritical(t,r)}))}this._tasks.data.callEvent("onStoreUpdated",[null,null,"paint"])},t.prototype.isTaskCritical=function(t,e){if(e&&webix.Date.equal(e,t.end_date))return!0;for(var i=this._links.find((function(e){return e.source==t.id&&0==e.type})),r=0;r<i.length;++r){var n=this._tasks.getItem(i[r].target);if(n.$critical&&this.isNoSlack(n.start_date,t.end_date,t.id))return!0}if(0!=t.parent){var a=this._tasks.getItem(t.parent);return a.$critical&&t.end_date>=a.end_date}return!1},t.prototype.isNoSlack=function(t,e,i){if(this.app.config.excludeHolidays){if(e>=t)return!0;for(var r=webix.Date.copy(e);r<t;){if(!this.isHoliday(r,i))return!1;webix.Date.add(r,1,"day")}return!0}return e>=t},t.prototype.isLinkCritical=function(t){var e=!1;if(0==t.type){var i=this.tasks(),r=i.getItem(t.source),n=i.getItem(t.target);e=r&&n&&r.$critical&&n.$critical}return e},t.prototype.getVisibleTasksCollection=function(t){if(!t&&"resources"==this.state.display){var e=this.app.getService("grouping");return e?e.getResourceTree():null}return this._tasks},t.prototype.taskCalendarMap=function(t,e){var i=this;if(t)return this._calendarMap||null;this._calendarMap||(this.assignments().data.attachEvent("onStoreUpdated",(function(){i.refreshCalendarMap()})),this.resources().data.attachEvent("onStoreUpdated",(function(){i.refreshCalendarMap()})),this.calendars().data.attachEvent("onStoreUpdated",(function(){i.refreshCalendarMap()})));var r=[this.assignments(e).waitData,this.resources(e).waitData];return e||r.push(this.calendars().waitData),webix.promise.all(r).then((function(){return i._calendarMap||i.refreshCalendarMap(),i._calendarMap}))},t.prototype.refreshCalendarMap=function(){var t=this.resources(),e=this.calendars(),i={};return this.assignments().data.each((function(r){var n=t.getItem(r.resource);if(n){var a=n.calendar_id,s=a?e.getItem(a):null;s&&!i[r.task]&&(i[r.task]=s)}})),this._calendarMap=i},t.prototype.getTaskCalendar=function(t){var e=this.taskCalendarMap(!0);return e?e[t]:null},t.prototype.isHoliday=function(t,e){if(e&&this._calendarMap){var i=this._calendarMap[e];if(i)return this.Helpers.isResourceHoliday(t,i)}return this.app.config.isHoliday(t)},t.prototype.clearAll=function(){var t=this,e=this.app.getService("grouping");(this.state.$batch({edit:null,selected:null,sort:null,top:0,left:0}),this.app.config.resourcesDiagram)&&e.getRDCollection().clearAll();this.app.config.resources&&e.getResourceTree().clearAll();["tasks","links","resources","categories","assignments","calendars"].forEach((function(e){var i="_"+e;t[i]&&t[i].clearAll()})),this.resetScales()},t.prototype.reload=function(){var t=this;this.clearAll();var e=this.app.getService("grouping"),i=["tasks","links"],r=[];this.app.config.resources&&!this.app.config.resourceCalendars&&i.push("resources","assignments"),i.forEach((function(e){var i=t[e](!0);r.push(i.waitData)})),this.app.config.resourcesDiagram&&e.getRDCollection(!0),webix.promise.all(r).then((function(){t.app.refresh()}))},t.prototype.updateScaleMinMax=function(t){var e=this,i=1/0,r=-1/0;if(t.data.each((function(t){t.start_date<i&&(i=t.start_date),t.end_date>r&&(r=t.end_date),e.state.baseline&&t.planned_start&&t.planned_end&&(t.planned_start<i&&(i=t.planned_start),t.planned_end>r&&(r=t.planned_end))})),"object"==typeof i){var n=this.getScales();this.setScales(this.Helpers.addUnit(n.minUnit,i,-1),this.Helpers.addUnit(n.minUnit,r,1),n.precise)}},t}(),vt=function(){function t(t,e){this.app=t,this._url=e}return t.prototype.url=function(t){return this._url+t},t.prototype.tasks=function(){return webix.ajax(this.url("tasks")).then((function(t){return t.json()}))},t.prototype.links=function(){return webix.ajax(this.url("links")).then((function(t){return t.json()}))},t.prototype.resources=function(){return webix.ajax(this.url("resources")).then((function(t){return t.json()}))},t.prototype.categories=function(){return webix.ajax(this.url("categories")).then((function(t){return t.json()}))},t.prototype.assignments=function(){return webix.ajax(this.url("assignments")).then((function(t){return t.json()}))},t.prototype.calendars=function(){return webix.ajax(this.url("calendars")).then((function(t){return t.json()}))},t.prototype.addTask=function(t,e,i){var n=webix.ajax().post(this.url("tasks"),r(r({},t),{mode:e,parent:i})).then((function(t){return t.json()}));return this.app.callEvent("backend:operation",[n]),n},t.prototype.removeTask=function(t){var e=webix.ajax().del(this.url("tasks/"+t)).then((function(t){return t.json()}));return this.app.callEvent("backend:operation",[e]),e},t.prototype.updateTask=function(t,e,i){var r=webix.ajax().put(this.url("tasks/"+t+(i?"/split":"")),e).then((function(t){return t.json()}));return this.app.callEvent("backend:operation",[r]),r},t.prototype.reorderTask=function(t,e){var i=webix.ajax().put(this.url("tasks/"+t+"/position"),e).then((function(t){return t.json()}));return this.app.callEvent("backend:operation",[i]),i},t.prototype.addLink=function(t){var e=webix.ajax().post(this.url("links"),t).then((function(t){return t.json()}));return this.app.callEvent("backend:operation",[e]),e},t.prototype.updateLink=function(t,e){var i=webix.ajax().put(this.url("links/"+t),e).then((function(t){return t.json()}));return this.app.callEvent("backend:operation",[i]),i},t.prototype.removeLink=function(t){var e=webix.ajax().del(this.url("links/"+t)).then((function(t){return t.json()}));return this.app.callEvent("backend:operation",[e]),e},t.prototype.addAssignment=function(t){var e=webix.ajax().post(this.url("assignments"),t).then((function(t){return t.json()}));return this.app.callEvent("backend:operation",[e]),e},t.prototype.updateAssignment=function(t,e){var i=webix.ajax().put(this.url("assignments/"+t),e).then((function(t){return t.json()}));return this.app.callEvent("backend:operation",[i]),i},t.prototype.removeAssignment=function(t){var e=webix.ajax().del(this.url("assignments/"+t)).then((function(t){return t.json()}));return this.app.callEvent("backend:operation",[e]),e},t}(),mt=function(){function t(t){this.app=t,this._local=this.app.getService("local"),this._helpers=this.app.getService("helpers"),this._back=this.app.getService("backend"),this._state=this.app.getState()}return t.prototype.addTask=function(t,e,i,n){var a=this;this.updateTaskDuration(t,n),t.planned_start&&this.updatePlannedTaskDuration(t,n);var s=0==e?"first":"last";return this._back.addTask(this.cleanData(t),s,i).then((function(n){return a._local.adjustScale(t),a._local.tasks().add(r(r({},t),{id:n.id,parent:i}),e,i),a.completeAdd(i,n)}))},t.prototype.splitTaskWithDnd=function(t,e,i,n){var a=this;return this.updateTaskDuration(t),this._back.updateTask(i,r(r({},t),{position:e,parent:i}),!0).then((function(s){a._local.adjustScale(t);var o=a._local.tasks();return o.updateItem(i,{type:"split",duration:n.duration||1,progress:n.progress||0}),(s.sibling&&0!=s.sibling||!o.find((function(t){return t.parent==i}),!0))&&(o.add(r(r({},n),{type:"task",parent:i,id:s.sibling,duration:n.duration||1,progress:n.progress||0}),0,i),++e),o.add(r(r({},t),{id:s.id,parent:i,position:e}),e,i),a.completeAdd(i,s,s.sibling)}))},t.prototype.completeAdd=function(t,e,i){var r=this;return t?this.syncProject(t).then((function(){return r._state.criticalPath&&r._local.showCriticalPath(),i&&(e.sibling=i),e})):webix.promise.resolve(e)},t.prototype.updateTask=function(t,e,i,n){var a=this,s=this._local.tasks(),o=webix.copy(s.getItem(t)),l=r(r({},o),e),c=!(webix.Date.equal(o.start_date,l.start_date)&&webix.Date.equal(o.end_date,l.end_date));c&&this.updateTaskDuration(l,i);var u=l.planned_start&&!(webix.Date.equal(o.planned_start,l.planned_start)&&webix.Date.equal(o.planned_end,l.planned_end));return u&&this.updatePlannedTaskDuration(l,i),n||"project"!=l.type||"project"==o.type?this._back.updateTask(t,this.cleanData(l)).then((function(){var e=a._local.getScales(),i=e.start,r=e.end;if((i>l.start_date||r<l.end_date||u&&(i>l.planned_start||r<l.planned_end))&&a._local.adjustScale(l),s.updateItem(t,l),"task"!=l.type&&"task"==o.type&&a.removeAssignments(l),!n&&(c||o.progress!=l.progress||o.parent!=l.parent)){(o.$count&&"project"==o.type?a.syncTasks(t,o.start_date,l.start_date).then((function(){return a.syncProject(o.parent)})):o.parent!=l.parent?webix.promise.all([a.syncProject(l.parent),a.syncProject(o.parent)]):a.syncProject(l.parent)).then((function(){a._state.criticalPath&&(s.updateItem(t,{$critical:!1}),a._local.showCriticalPath())}))}return l})):this.syncProject(t,l)},t.prototype.updateTaskDuration=function(t,e){var i=this;if(this.app.config.excludeHolidays){var r=void 0;if(e){var n=(e="move"==e?"start":e)+("start"===e||"end"===e?"_date":"");r=this._local.tasks().getItem(t.id)[n]>t[n]?-1:1,"start"!=e&&(e="end")}var a=webix.copy(this._local.getScales());a.isHoliday=function(e){return i._local.isHoliday(e,t.id)},this._helpers.updateTaskDuration(t,a,e,r)}else this._helpers.updateTaskDuration(t)},t.prototype.updatePlannedTaskDuration=function(t,e){var i=this;if(this.app.config.excludeHolidays){var r=void 0;if(e){var n="planned_"+e;r=this._local.tasks().getItem(t.id)[n]>t[n]?-1:1}var a=webix.copy(this._local.getScales());a.isHoliday=function(e){return i._local.isHoliday(e,t.id)},this._updatePlannedTaskDuration(t,a,e,r)}else this._updatePlannedTaskDuration(t)},t.prototype._updatePlannedTaskDuration=function(t,e,i,n){var a=r({},t);a.start_date=t.planned_start,a.duration=t.planned_duration,a.end_date=t.planned_end,this._helpers.updateTaskDuration(a,e,i,n),t.planned_start=a.start_date,t.planned_end=a.end_date,t.planned_duration=a.duration},t.prototype.syncTasks=function(t,e,i){var n=this,a=i-e;if(this.app.config.excludeHolidays&&(a=this.getWorkDateDiff(a,e,t)),a){var s=[];return this._local.tasks().data.eachSubItem(t,(function(t){var e=t.start_date.valueOf()+a;if(n.app.config.excludeHolidays){var i=a-n.getWorkDateDiff(a,t.start_date,t.id);i&&(e+=i)}var o=r(r({},t),{start_date:new Date(e),end_date:null});s.push(n.updateTask(t.id,o,"move",!0))})),webix.promise.all(s)}return webix.promise.resolve()},t.prototype.getWorkDateDiff=function(t,e,i){for(var r=Math.sign(t),n=r*Math.floor(t/864e5),a=0,s=e;a<n;++a)webix.Date.add(s,r,"day"),this._local.isHoliday(s,i)&&(t-=864e5*r);return t},t.prototype.syncProject=function(t,e){var i=this,r=this._local.tasks();if(!e)if(e=r.getItem(t),this.app.config.projects&&e&&"split"!=e.type)e.type=e.$count?"project":"task",this.removeAssignments(e);else for(;e&&"project"!=e.type;)t=r.getParentId(t),e=r.getItem(t);return e&&e.$count&&(e=this.setProjectData(e)),e?this.updateTask(t,e,"start",!0).then((function(){return i.syncProject(e.parent),e})):webix.promise.resolve()},t.prototype.setProjectData=function(t,e,i){i||(t=webix.copy(t));var r=1/0,n=0,a=0,s=0,o=function(t){r=t.start_date<r?t.start_date:r,n=t.end_date>n?t.end_date:n,!t.duration||"project"==t.type&&t.$count||(a+=t.duration*t.progress,s+=1*t.duration)};i?i.forEach(o):(e||this._local.tasks()).data.eachSubItem(t.id,o);return webix.Date.equal(t.start_date,r)||(t.start_date=r,t.duration=null),webix.Date.equal(t.end_date,n)||(t.end_date=n,t.duration=null),t.progress=a?Math.round(a/s):a,t},t.prototype.updateTaskTime=function(t,e,i){var r=this._local.tasks().getItem(t),n={},a=this._local.getScales(),s=a.precise?this._helpers.getSmallerUnit(a.minUnit):a.minUnit;if("start"===e||"move"===e){var o=a.precise?r.start_date:this._helpers.getUnitStart(s,r.start_date);n.start_date=this._helpers.addUnit(s,o,i),"start"===e&&n.start_date>r.end_date&&(n.start_date=this._helpers.addUnit(s,r.end_date,-1))}else if("end"===e){var l=this._helpers.getUnitStart(s,r.end_date);o=a.precise||webix.Date.equal(l,r.end_date)?r.end_date:this._helpers.addUnit(s,l,1);n.end_date=this._helpers.addUnit(s,o,i),n.end_date<r.start_date&&(n.end_date=this._helpers.addUnit(s,r.start_date,1))}return"move"===e?n.end_date=null:n.duration=0,this.updateTask(t,n,e)},t.prototype.removeTask=function(t){var e=this,i=this._local.tasks(),r=this._local.links();return r.find((function(e){return e.source==t||e.target==t})).forEach((function(t){return r.remove(t.id)})),this._back.removeTask(t).then((function(r){var n=i.getItem(t).parent;return i.remove(t),e.app.config.split&&0!=n&&"split"===i.getItem(n).type&&!i.find((function(t){return t.parent==n}),!0)?e.updateTask(n,{type:"task"}).then((function(){return e.completeRemoval(r,n)})):e.completeRemoval(r,n)}))},t.prototype.completeRemoval=function(t,e){var i=this;return this.syncProject(e).then((function(){return i._state.criticalPath&&i._local.showCriticalPath(),t}))},t.prototype.addLink=function(t){var e=this;return this.linkExists(t)?webix.promise.reject():this._back.addLink(t).then((function(i){return t.id=i.id,e._local.links().add(t),t}))},t.prototype.linkExists=function(t){return this._local.links().find((function(e){return e.target==t.target&&e.source==t.source&&e.type==t.type}),!0)},t.prototype.updateLink=function(t,e){var i=this;return this._back.updateLink(t,e).then((function(n){var a=i._local.links(),s=i.linkExists(r(r({},a.getItem(t)),e));return a.updateItem(t,e),s?i.removeLink(s.id).then((function(){return n})):n}))},t.prototype.removeLink=function(t){var e=this;return this._back.removeLink(t).then((function(i){return e._local.links().remove(t),i}))},t.prototype.moveTask=function(t,e,i){var r=this;e=e||0;var n=this._local.tasks(),a=n.data.branch[e],s=n.getItem(t).parent,o=n.data.getBranchIndex(t);return e==s&&(i===o||-1===i&&t===a[a.length-1])?webix.promise.reject():(n.move(t,i,null,{parent:e}),this._back.reorderTask(t,{parent:e,mode:0===i?"first":-1===i?"last":"after",target:n.data.branch[e][i-1]}).then((function(i){return e!==s?(n.updateItem(t,{parent:e}),webix.promise.all([r.syncProject(e),r.syncProject(s)]).then((function(){return r._state.criticalPath&&r._local.showCriticalPath(),i}))):i})))},t.prototype.updateAssignment=function(t,e){var i=this;return this._back.updateAssignment(t,e).then((function(r){return i._local.assignments().updateItem(t,e),r}))},t.prototype.addAssignment=function(t){var e=this;return this._back.addAssignment(t).then((function(i){return t.id=i.id,e._local.assignments().add(t),t}))},t.prototype.removeAssignment=function(t){var e=this;return this._back.removeAssignment(t).then((function(i){return e._local.assignments().remove(t),i}))},t.prototype.sortResources=function(t,e){return t.category==e.category?t.name>e.name?1:-1:t.category>e.category?1:-1},t.prototype.removeAssignments=function(t){var e=this;if(this.app.config.resources){var i=this._local.assignments(),r=[];return i.waitData.then((function(){return i.data.each((function(i){i.task==t.id&&r.push(e.removeAssignment(i.id))})),r.length?webix.promise.all(r):webix.promise.resolve(!1)}))}return webix.promise.resolve(!1)},t.prototype.cleanData=function(t){var e={};for(var i in t)0!==i.indexOf("$")&&(e[i]=t[i]);return e},t.prototype.updateAssignedTaskDates=function(t){var e=webix.copy(t);this.updateTaskDuration(e),!(webix.Date.equal(t.start_date,e.start_date)&&webix.Date.equal(t.end_date,e.end_date))&&this.updateTask(t.id,e,null,!0)},t}();function yt(t){if(null===t||!0===t||!1===t)return NaN;var e=Number(t);return isNaN(e)?e:e<0?Math.ceil(e):Math.floor(e)}function _t(t,e){if(e.length<t)throw new TypeError(t+" argument"+(t>1?"s":"")+" required, but only "+e.length+" present")}function wt(t){_t(1,arguments);var e=Object.prototype.toString.call(t);return t instanceof Date||"object"==typeof t&&"[object Date]"===e?new Date(t.getTime()):"number"==typeof t||"[object Number]"===e?new Date(t):("string"!=typeof t&&"[object String]"!==e||"undefined"==typeof console||(console.warn("Starting with v2.0.0-beta.1 date-fns doesn't accept strings as date arguments. Please use `parseISO` to parse strings. See: https://git.io/fjule"),console.warn((new Error).stack)),new Date(NaN))}function bt(t,e){_t(2,arguments);var i=wt(t),r=yt(e);return isNaN(r)?new Date(NaN):r?(i.setDate(i.getDate()+r),i):i}function xt(t,e){_t(2,arguments);var i=wt(t),r=yt(e);if(isNaN(r))return new Date(NaN);if(!r)return i;var n=i.getDate(),a=new Date(i.getTime());a.setMonth(i.getMonth()+r+1,0);var s=a.getDate();return n>=s?a:(i.setFullYear(a.getFullYear(),a.getMonth(),n),i)}function kt(t,e){_t(2,arguments);var i=wt(t).getTime(),r=yt(e);return new Date(i+r)}function St(t,e){_t(1,arguments);var i=e||{},r=i.locale,n=r&&r.options&&r.options.weekStartsOn,a=null==n?0:yt(n),s=null==i.weekStartsOn?a:yt(i.weekStartsOn);if(!(s>=0&&s<=6))throw new RangeError("weekStartsOn must be between 0 and 6 inclusively");var o=wt(t),l=o.getDay(),c=(l<s?7:0)+l-s;return o.setDate(o.getDate()-c),o.setHours(0,0,0,0),o}function Tt(t){var e=new Date(Date.UTC(t.getFullYear(),t.getMonth(),t.getDate(),t.getHours(),t.getMinutes(),t.getSeconds(),t.getMilliseconds()));return e.setUTCFullYear(t.getFullYear()),t.getTime()-e.getTime()}function $t(t){_t(1,arguments);var e=wt(t);return e.setHours(0,0,0,0),e}function Dt(t,e){_t(2,arguments);var i=wt(t),r=wt(e),n=i.getTime()-r.getTime();return n<0?-1:n>0?1:n}function Ct(t,e){_t(2,arguments);var i=wt(t),r=wt(e),n=i.getFullYear()-r.getFullYear(),a=i.getMonth()-r.getMonth();return 12*n+a}function Rt(t,e){_t(2,arguments);var i=wt(t),r=wt(e);return i.getFullYear()-r.getFullYear()}function Ht(t,e){return _t(2,arguments),wt(t).getTime()-wt(e).getTime()}var It={ceil:Math.ceil,round:Math.round,floor:Math.floor,trunc:function(t){return t<0?Math.ceil(t):Math.floor(t)}};function Lt(t){return t?It[t]:It.trunc}function Pt(t){_t(1,arguments);var e=wt(t);return e.setHours(23,59,59,999),e}function At(t){_t(1,arguments);var e=wt(t),i=e.getMonth();return e.setFullYear(e.getFullYear(),i+1,0),e.setHours(23,59,59,999),e}function Et(t){_t(1,arguments);var e=wt(t);return Pt(e).getTime()===At(e).getTime()}function Mt(t,e){_t(2,arguments);var i,r=wt(t),n=wt(e),a=Dt(r,n),s=Math.abs(Ct(r,n));if(s<1)i=0;else{1===r.getMonth()&&r.getDate()>27&&r.setDate(30),r.setMonth(r.getMonth()-a*s);var o=Dt(r,n)===-a;Et(wt(t))&&1===s&&1===Dt(t,n)&&(o=!1),i=a*(s-Number(o))}return 0===i?0:i}function Ut(t,e){var i=t.getDay();return e&&(0===i?i=6:i--),i}var Bt={year:function(t,e){_t(2,arguments);var i=wt(t),r=wt(e),n=Dt(i,r),a=Math.abs(Rt(i,r));i.setFullYear(1584),r.setFullYear(1584);var s=Dt(i,r)===-n,o=n*(a-Number(s));return 0===o?0:o},quarter:function(t,e,i){_t(2,arguments);var r=Mt(t,e)/3;return Lt(null==i?void 0:i.roundingMethod)(r)},month:Mt,week:function(t,e,i){return function(t,e,i){_t(2,arguments);var r=St(t,i),n=St(e,i),a=r.getTime()-Tt(r),s=n.getTime()-Tt(n);return Math.round((a-s)/6048e5)}(t,e,{weekStartsOn:i?1:0})},day:function(t,e){_t(2,arguments);var i=$t(t),r=$t(e),n=i.getTime()-Tt(i),a=r.getTime()-Tt(r);return Math.round((n-a)/864e5)},hour:function(t,e,i){_t(2,arguments);var r=Ht(t,e)/36e5;return Lt(null==i?void 0:i.roundingMethod)(r)},minute:function(t,e,i){_t(2,arguments);var r=Ht(t,e)/6e4;return Lt(null==i?void 0:i.roundingMethod)(r)}};var jt={year:["quarter",4],quarter:["month",3],month:["day",function(t){if(!t)return 30;var e=t.getMonth();if(1===e){var i=t.getFullYear();return i%4?28:i%100?29:i%400?28:29}return e%2&&e<7||!(e%2)&&e>7?30:31}],week:["day",7],day:["hour",24],hour:["minute",60],minute:["minute",1]},Vt={year:function(t,e){_t(2,arguments);var i=yt(e);return xt(t,12*i)},quarter:function(t,e){_t(2,arguments);var i=yt(e),r=3*i;return xt(t,r)},month:xt,week:function(t,e){_t(2,arguments);var i=yt(e),r=7*i;return bt(t,r)},day:bt,hour:function(t,e){_t(2,arguments);var i=yt(e);return kt(t,36e5*i)},minute:function(t,e){_t(2,arguments);var i=yt(e);return kt(t,6e4*i)}};function Ot(t,e,i,r,n,a){var s=t;if(n){var o=jt[t][0];"number"!=typeof o&&"function"!=typeof o&&(s=o)}var l=i,c=e;if(a&&(l=Wt(s,l,r),(c=Wt(s,c,r))<e&&(c=zt(s)(c,1))),n){var u=Bt[s](c,l),p=jt[t][1],h=0;return"function"==typeof p?h=p(i):"number"==typeof p&&(h=p),u/h}return Bt[s](c,l,r)}function Ft(t){return function(e,i,r,n,a){return"month"===t&&n?function(t,e,i){if(Nt(e,t))return Ot("month",t,e,null,!0,i);var r=0;if(e.getDate()>1){var n=new Date(e.getFullYear(),e.getMonth()+1,1);r=Ot("month",n,e,null,!0),e=n}var a=0;Nt(e,t)||(a=Ot("month",Wt("month",t),e),e=zt("month")(e,a));return r+a+Ot("month",t,e,null,!0)}(e,i,a):Ot(t,e,i,r,n,a)}}function Nt(t,e){return Wt("month",t).valueOf()===Wt("month",e).valueOf()}function zt(t){return Vt[t]}function Wt(t,e,i){var r;switch(t){case"year":return new Date(e.getFullYear(),0,1);case"quarter":return new Date(e.getFullYear(),3*Math.floor(e.getMonth()/3),1);case"month":return new Date(e.getFullYear(),e.getMonth(),1);case"week":return(r=new Date(e.getFullYear(),e.getMonth(),e.getDate())).setDate(e.getDate()-Ut(e,i)),r;case"day":return(r=new Date(e.getFullYear(),e.getMonth(),e.getDate())).setHours(0,0,0,0),r;case"hour":return(r=new Date(e.getFullYear(),e.getMonth(),e.getDate())).setHours(e.getHours(),0,0,0),r;default:return new Date(e)}}function Gt(t,e,i,r,n,a,s,o){var l=function(t){var e=new Date;return t.map((function(t){return{item:t,len:zt(t.unit)(e,1)}})).sort((function(t,e){return t.len<e.len?-1:1}))[0].item.unit}(a),c=Ft(l),u=Wt(l,e,o);t=Wt(l,t,o),e=u<e?zt(l)(u,1):u;var p=c(e,t,o)*r,h=n*a.length;return{rows:a.map((function(i){for(var a=[],s=zt(i.unit),u=i.step||1,p="week"===l&&"week"!==i.unit,h=Wt(i.unit,t,o);h<e;){var d=s(h,u);h<t&&(h=t),d>e&&(d=e);var f=h,g=d;p&&(Ut(h,o)>3&&(f=zt("week")(h,1)),Ut(d,o)>3&&(g=zt("week")(d,1)));var v=(c(g,f,o)||1)*r,m="";i.css&&(m+="function"==typeof i.css?i.css(h):i.css),a.push({width:v,css:m,date:h,format:i.format}),h=d}return{cells:a,add:s,height:n,type:i.unit,step:i.step||1}})),width:p,height:h,cellWidth:r,cellHeight:n,diff:c,start:t,end:e,minUnit:l,precise:i=!!("day"===l?i:0!=i),isHoliday:s,startOnMonday:o}}function qt(t,e,i,r,n){var a=i.start,s=i.end,o=i.cellWidth,l=i.cellHeight,c=i.diff,u=i.minUnit,p=i.precise,h=t.start_date<a?a:t.start_date,d=t.end_date>s?s:t.end_date,f=Wt(u,a,i.startOnMonday),g="milestone"==t.type;t.$h=r,t.$x=Math.round(c(h,f,i.startOnMonday,p)*o)-(g?t.$h/2:0),t.$w=g?t.$h:Math.round(c(d,h,i.startOnMonday,p,!0)*o),t.$y=void 0===n?l*e+(l-r)/2:n}function Yt(t,e,i,r){t.start_date&&t.end_date&&t.start_date.valueOf()>=t.end_date.valueOf()&&(t.end_date=null,t.duration=1,i&&(i="move")),e?function(t,e,i,r){if("milestone"==t.type)return t.start_date=i?ee(t.start_date,!1,e,r):Qt(t.start_date,e),Xt(t);i?"start"==i||"move"==i?(t.start_date=ee(t.start_date,!1,e,r),t.duration||(t.duration=Zt(t,e)),t.end_date||(t.end_date=Jt(t,e))):(t.end_date||(t.end_date=Jt(t,e)),t.duration||(t.end_date=ee(t.end_date,!0,e,r),t.duration=Zt(t,e))):(t.start_date=Qt(t.start_date,e),t.end_date=Jt(t,e),t.duration=Zt(t,e))}(t,e,i,r):"milestone"==t.type?Xt(t):(t.duration||(t.duration=Zt(t)),t.end_date||(t.end_date=Kt(t)))}function Xt(t){t.duration=0,t.end_date=t.start_date}function Kt(t){return t.duration<1?zt("hour")(t.start_date,Math.floor(24*t.duration)):zt("day")(t.start_date,t.duration)}function Jt(t,e){if(t.duration<1)return Kt(t);for(var i=function(t,e){e&&(t=new Date(t.valueOf()));var i=new Date(t.valueOf());return i.setHours(0),i.getDate()!=t.getDate()?t.setHours(1):t.setHours(0),t.setMinutes(0),t.setSeconds(0),t.setMilliseconds(0),t}(t.start_date),r=0,n=0;r<t.duration;)e.isHoliday(i)?30==++n&&te():(++r,n=0),i=zt("day")(i,1);return i}function Zt(t,e){var i=Ft("day")(t.end_date,t.start_date,!0);if(i<1)return parseFloat(i.toFixed(2));if(!e)return Math.floor(i);for(var r=t.start_date,n=0;r<t.end_date;)e.isHoliday(r)||++n,r=zt("day")(r,1);return n}function Qt(t,e){for(var i,r=t,n=t,a=0;a<30&&(i=e.isHoliday(n))&&e.isHoliday(r);)r=zt("day")(r,-1),n=zt("day")(n,1),a++;return 30===a&&te(),i?r:n}function te(){throw alert("No work days found within 30 days, check your isHoliday function!"),"Wrong isHoliday function"}function ee(t,e,i,r){for(var n=0;n<30&&i.isHoliday(ie(t,e));)t=zt("day")(t,r),n++;return 30===n&&te(),t}function ie(t,e){return e&&!function(t,e){return e&&(t=new Date(t.valueOf())),(t.valueOf()/1e3-60*t.getTimezoneOffset())%86400}(t)?zt("day")(t,-1):t}function re(t,e,i,r){var n=Math.round(r/2);if(!e||!i)return t.$p="",t;var a=!1,s=!1;switch(t.type){case 0:s=!0;break;case 1:a=!0,s=!0;break;case 3:a=!0}var o,l,c=a?e.$x:e.$x+e.$w,u=e.$y,p=s?i.$x:i.$x+i.$w,h=i.$y;if(function(t,e,i,r,n){return"milestone"===t.type||"milestone"===e.type?Math.abs(i-r)>n/2:i!==r}(e,i,c,p,r)||u!==h){var d=function(t,e,i,r,n,a,s){var o=t+20*(n?-1:1),l=i+20*(a?-1:1),c=[t,e,o,e,0,0,0,0,l,r,i,r],u=l-o,p=r-e,h=a===n;!h&&(l<=t+20-2&&a||l>t&&!a)&&(p-=s);h&&a&&o>l||h&&!a&&o<l?(c[4]=c[2]+u,c[5]=c[3],c[6]=c[4],c[7]=c[5]+p):(c[4]=c[2],c[5]=c[3]+p,c[6]=c[4]+u,c[7]=c[5]);return c.join(",")}(c,u+n,p,h+n,a,s,19),f=(o=p,l=h+n,s?o-5+","+(l-3)+","+(o-5)+","+(l+3)+","+o+","+l:o+5+","+(l+3)+","+(o+5)+","+(l-3)+","+o+","+l);t.$p=d+","+f}else t.$p="";return t}var ne=function(){function t(t){this.app=t,this.defaultResourceUnit="hour",this.defaultResourceValues={hour:8},this.resourceValueRanges={hour:[.5,24]},this.resourceValueSteps={hour:.5},this.unitLoadNorm={day:8,week:40,month:170,quarter:510,year:2040}}return t.prototype.initials=function(t){var e=t.match(/\b\w/g)||[];return 1==e.length?t.charAt(0).toUpperCase()+t.charAt(1):((e.shift()||"")+(e.pop()||"")).toUpperCase()},t.prototype.avatarCss=function(t){return" webix_gantt_person_avatar_"+(t.charCodeAt(1)+t.length%10)%10},t.prototype.resourceAvatar=function(t,e,i){var r="webix_gantt_person_avatar";if("string"==typeof e&&(r+=" "+e),t.avatar)return'<img class="'+r+'" src="'+t.avatar+'" webix_tooltip="'+(i?t.name:"")+'"/>';var n=t.name;return"<div class='"+r+" "+(n?this.avatarCss(n):"")+"' webix_tooltip=\""+(i?t.name:"")+'">'+(n?this.initials(n):"")+"</div>"},t.prototype.getDefaultResourceValue=function(t){var e=this.getResourceUnit(t);return this.defaultResourceValues[e]},t.prototype.getResourceUnit=function(t){return t.unit||this.defaultResourceUnit},t.prototype.getResourceValueRange=function(t){var e=this.getResourceUnit(t);return this.resourceValueRanges[e]||[1,100]},t.prototype.getResourceValueStep=function(t){var e=this.getResourceUnit(t);return this.resourceValueSteps[e]||null},t.prototype.isResourceHoliday=function(t,e){var i=!1;return e.holidays&&(i=e.holidays.find((function(e){return e.getTime()==t.getTime()}))),e.weekDays&&(i=i||-1==e.weekDays.indexOf(t.getDay())),i},t.prototype.addUnit=function(t,e,i){return zt(t)(e,i)},t.prototype.getDifference=function(t,e,i){return Ft(t)(e,i,webix.Date.startOnMonday)},t.prototype.getUnitStart=function(t,e){return Wt(t,e,webix.Date.startOnMonday)},t.prototype.updateTask=function(t,e){var i=this.app.getService("local");return function(t,e,i,r,n){return"split"===t.type&&t.$data&&t.$data.length?t.$data.forEach((function(t){return qt(t,e,i,r)})):qt(t,e,i,r,n),t}(t,e,i.getScales(),i.getTaskHeight())},t.prototype.setScales=function(t,e,i,r,n,a){return Gt(t,e,i,r,n,a,this.app.config.isHoliday,webix.Date.startOnMonday)},t.prototype.updateLink=function(t,e,i){return re(t,e,i,this.app.getService("local").getTaskHeight())},t.prototype.updateTaskDuration=function(t,e,i,r){return Yt(t,e,i,r)},t.prototype.getSmallerUnit=function(t){return jt[t][0]},t.prototype.getSmallerCount=function(t){return jt[t][1]},t.prototype.newLink=function(t,e,i){return function(t,e,i){if(e&&i){var r=i.x-e.x,n=i.y-e.y,a=(r>0?e.x:i.x)-t.left,s=(n>0?e.y:i.y)-t.top,o=(r>0?0:-r)+","+(n>0?0:-n)+","+(r>0?r:0)+","+(n>0?n:0);return{width:Math.abs(r),height:Math.abs(n),left:a,top:s,p:o}}return null}(t,e,i)},t.prototype.drawGridInner=function(t,e,i){return function(t,e,i){var r=document.createElement("canvas");r.setAttribute("width",t+""),r.setAttribute("height",e+"");var n=r.getContext("2d");return n.strokeStyle=i,n.moveTo(0,e),n.lineTo(t,e),n.lineTo(t,0),n.stroke(),r.toDataURL()}(t,e,i)},t}(),ae=function(){function t(t){this.app=t,this.local=t.getService("local"),this.helpers=t.getService("helpers"),this.closedResources=null}return t.prototype.getTreeData=function(t,e){var i=this,r=t.filter((function(t){return t.parent==e}));return r.forEach((function(e){var r=i.getTreeData(t,e.id);r&&(e.data=r)})),r},t.prototype.getRDCollection=function(t){var e=this;if(this._rdCollection&&!t)return this._rdCollection;var i=this.local.tasks(),r=this.local.assignments(),n=this.local.resources();return this._rdCollection?this._rdCollection.clearAll():(this._rdCollection=new webix.TreeCollection({}),webix.extend(this._rdCollection,webix.Group),this.syncRDWithData()),webix.promise.all([i.waitData,r.waitData,n.waitData]).then((function(){var t=[],i=e.local.getScales();r.data.each((function(r){var n=e.getDiagramItemData(r,i);n&&t.push(n)})),e._rdCollection.parse(t),e.groupResourceDiagram()})),this._rdCollection},t.prototype.syncRDWithData=function(){var t=this;this.app.on("onScalesUpdate",(function(e,i){t._rdCollection&&t._rdCollection.data.order.length&&(t.refreshTaskDiagram(),e.minUnit!==i.minUnit&&(t.updateUnitDurations(),t.groupResourceDiagram()))})),this.local.tasks().data.attachEvent("onStoreUpdated",(function(e,i,r){r&&i&&("update"==r||"delete"==r||t.local.assignments().find((function(t){return t.task===i.id}),!0))&&(t.updateTaskDiagram(i,r),t.groupResourceDiagram())})),this.local.assignments().data.attachEvent("onStoreUpdated",(function(e,i,r){e&&(t.refreshResourceDiagram(e,i,r),t.groupResourceDiagram())}))},t.prototype.updateUnitDurations=function(){var t=this,e=this.local.tasks(),i=this.local.assignments(),n=this.local.getScales();this._rdCollection.data.each((function(a){if(a.task){var s=e.getItem(a.task),o=i.getItem(a.id);s&&o&&(a.duration=t.calculateUnitDuration(s,n),a.value=t.calculateLoad(r(r({},s),o),n.minUnit))}}))},t.prototype.calculateUnitDuration=function(t,e){return"day"===e.minUnit?t.duration:e.diff(t.end_date,t.start_date,webix.Date.startOnMonday,!1,!0)},t.prototype.getDiagramItemData=function(t,e){var i=this.local.tasks().getItem(t.task);if(i){this.local._isTaskVisible(i,!0)||this.helpers.updateTask(i,0);var n=this.local.resources().getItem(t.resource),a=r(r(r({},i),n),t);return a.duration=this.calculateUnitDuration(i,e),a.value=this.calculateLoad(a,e.minUnit),a.$x=this.truncateX(a.$x,e),a}return null},t.prototype.calculateLoad=function(t,e){var i=this.getUnitLoad(t);if("hour"===e)return[0,0,i/24];if("day"===e)return[0,0,i];var r,n=[],a=webix.Date.copy(t.start_date),s=this.helpers.getUnitStart(e,a),o=webix.Date.copy(t.end_date),l=this.helpers.getUnitStart(e,o);if(webix.Date.datePart(a,!0)>s)if(o>(r=this.helpers.addUnit(e,s,1))){var c=this.findUnitDuration(a,r,t);n.push(c),a=r}else n.push(0);else n.push(0);if(!webix.Date.equal(s,l)&&webix.Date.datePart(o,!0)>=l){var u=this.findUnitDuration(l,o,t);n.push(u),o=l}else n.push(0);var p=this.helpers.addUnit(e,a,1),h=this.findUnitDuration(a,new Date(Math.min(p,o)),t);return n.push(h),n.map((function(t){return t*i}))},t.prototype.findUnitDuration=function(t,e,i){var r=this.helpers.getDifference("day",e,t);if(this.app.config.excludeHolidays){var n=void 0,a=webix.Date.copy(t),s=r;for(n=0;n<s;n++)this.checkHoliday(a,i)&&r--,webix.Date.add(a,1,"day")}return r},t.prototype.checkHoliday=function(t,e){if(this.app.config.resourceCalendars){var i=this.local.resources().getItem(e.resource).calendar_id;if(i){var r=this.local.calendars().getItem(i);return this.helpers.isResourceHoliday(t,r)}}return this.app.config.isHoliday(t)},t.prototype.getUnitLoad=function(t){return t.value},t.prototype.truncateX=function(t,e){return!1!==e.precise?Math.floor(t/e.cellWidth)*e.cellWidth:t},t.prototype.refreshResourceDiagram=function(t,e,i){var n=this._rdCollection,a=this.local.getScales();switch(i){case"update":if(n.exists(t)){var s=this.local.tasks().getItem(e.task),o=r({},this.local.resources().getItem(e.resource));delete o.id;var l=this.calculateLoad(r(r({},s),e),a.minUnit);n.updateItem(t,r(r(r({},e),o),{value:l}))}break;case"add":n.add(this.getDiagramItemData(e,a));break;case"delete":n.exists(t)&&n.remove(t)}},t.prototype.updateTaskDiagram=function(t,e){var i=this,n=this._rdCollection,a=this.local.getScales();if("delete"===e)this.pruneDiagram();else if("add"===e){var s=this.local.assignments().find((function(e){return e.task===t.id}),!0);n.add(this.getDiagramItemData(s,a))}else if("update"===e){n.find((function(e){return e.task===t.id})).forEach((function(e){var s=i.local.assignments().getItem(e.id);n.updateItem(e.id,{start_date:t.start_date,id:e.id,duration:i.calculateUnitDuration(t,a),$x:i.truncateX(t.$x,a),value:i.calculateLoad(r(r({},t),s),a.minUnit)})}))}},t.prototype.pruneDiagram=function(){var t=this.local.tasks(),e=[];this._rdCollection.data.eachLeaf(0,(function(i){t.exists(i.task)||e.push(i.id)})),e.length&&this._rdCollection.remove(e)},t.prototype.refreshTaskDiagram=function(){var t=this,e=this.local.getScales();this._rdCollection.data.each((function(i){var r=t.local.tasks().getItem(i.task);r&&(i.$x=t.truncateX(r.$x,e))}))},t.prototype.groupResourceDiagram=function(){var t=this._rdCollection;t.group({by:function(t){return t.name+"-"+t.category},map:{resource_id:["resource"],value:["name"],name:["name"],category:["category"],avatar:["avatar"],load:["value",oe],duration:["duration",se],units:["value",se],$x:["$x",se],count:["value","count"],start_date:["start_date",se]}}),t.group({by:"category",map:{value:["category"],name:["category"],duration:["duration","sum"],load:["load","sum"],count:["count","sum"]}},0)},t.prototype.getResourceTree=function(){var t=this;return this._resourcesTree||(this._resourcesTree=new webix.TreeCollection({on:{"data->onStoreUpdated":function(e,i,r){e="update"==r||"paint"==r?e:null,t.refreshResourceTasks(e),t.local.refreshLinks()}},scheme:{$sort:{by:"start_date",dir:"asc",as:"int"}}}),this._resourcesTree.parse(this.resourceTaskLoader().finally((function(){t.syncResourceTree()})))),this._resourcesTree},t.prototype.tasksWithResources=function(){var t=this;return webix.promise.all([this.local.tasks().waitData,this.local.assignments().waitData]).then((function(){var e=[];return t.local.tasks().data.each((function(i){if("task"==i.type||!i.type){var r=Object.assign({},i),n=t.local.assignments().data.find((function(t){return t.task==r.id}));r.resources=n.length?n.map((function(t){return t.resource})):null,e.push(r)}}),"",!0),e}))},t.prototype.resourceTaskLoader=function(){var t=this,e=this.app.getService("operations");return webix.promise.all([this.tasksWithResources(),this.local.resources().waitData]).then((function(i){var r=t.getResourceTaskData(i[0]);return r.forEach((function(t){e.setProjectData(t,null,t.data)})),r}))},t.prototype.refreshResourceTree=function(){var t=this;this._resourcesTree.count()?(this.closedResources=[],this._resourcesTree.data.eachChild("0",(function(e){e.open||t.closedResources.push(e.resources)}))):this.closedResources=null,this.resourceTaskLoader().then((function(e){return t._resourcesTree.clearAll(),t._resourcesTree.parse(e),e}))},t.prototype.syncResourceTree=function(){var t=this,e=this._resourcesTree;this.local.tasks().data.attachEvent("onStoreUpdated",(function(i,r,n){if("update"==n){var a=e.exists(i)&&"task"==e.getItem(i).type,s="task"==r.type;if(a&&s){e.updateItem(i,{text:r.text,details:r.details,start_date:r.start_date,end_date:r.end_date,duration:r.duration,progress:r.progress});var o=e.getParentId(i),l=e.getItem(o);return l&&(l=t.app.getService("operations").setProjectData(l,e),e.updateItem(o,l)),!0}a^s&&t.refreshResourceTree()}else t.refreshResourceTree()})),this.local.assignments().data.attachEvent("onStoreUpdated",(function(){t.refreshResourceTree()}))},t.prototype.getResourceTaskData=function(t){var e=this,i=[],r=null,n=this.app.getService("operations");return t.forEach((function(t){var a,s=t.resources;(a=s?i.find((function(t){return rt(t.resources,s)})):r||null)||((a={id:s?webix.uid():"unassigned",type:"project",text:"",data:[],$group:!0,open:e.checkResourceOpen(s)}).resources=s,s&&(a.text=s.map((function(t){return e.local.resources().getItem(t)})).sort(n.sortResources).map((function(t){return t.name})).join(", ")),s?i.push(a):(a.id="unassigned",r=a)),a.data.push(webix.copy(t))})),r&&i.push(r),i},t.prototype.refreshResourceTasks=function(t,e){var i=this,r=this._resourcesTree;if(t){var n=r.getItem(t);e=webix.isUndefined(e)?r.getIndexById(t):e,this.helpers.updateTask(n,e)}else r.data.order.forEach((function(t,e){i.refreshResourceTasks(t,e)}))},t.prototype.checkResourceOpen=function(t){return!this.closedResources||(t?!this.closedResources.find((function(e){return rt(e,t)})):-1==this.closedResources.indexOf(null))},t}();function se(t,e){for(var i=[],r=0;r<e.length;r++)i.push(t(e[r]));return i}function oe(t,e){for(var i=0,r=0;r<e.length;r++)for(var n=t(e[r]),a=parseInt(e[r].duration),s=n.length-1,o=0;o<n.length;++o){var l=n[o];l&&(i+=(o===s?a:1)*l,a--)}return i}var le=function(t){function e(e){var i,n,a,s=this,o=N({top:0,left:0,selected:null,edit:null,readonly:e.readonly||!1,sort:null,display:e.resources&&"resources"==e.display?"resources":"tasks",criticalPath:e.criticalPath||!1,resourcesDiagram:!(!e.resources||!e.resourcesDiagram),treeWidth:e.treeWidth||(e.resources?400:500),baseline:e.baseline||!1}),l=e.isHoliday||function(t){var e=t.getDay();return 0===e||6===e},c={router:_,version:"10.1.0",debug:!0,start:"/top",compactWidth:650,markers:[{css:"webix_gantt_today_marker",now:!0}],params:{state:o,forceCompact:e.compact},links:!0,isHoliday:l},u=function(t){return s.config.override&&s.config.override.get(t)||t};return(s=t.call(this,r(r({},c),e))||this).setService("helpers",new(u(ne))(s,e)),s.setService("local",new(u(gt))(s,e)),s.setService("backend",new(u(vt))(s,e.url)),s.setService("operations",new(u(mt))(s)),s.setService("grouping",new(u(ae))(s)),a={updateConfig:function(t){var e=i.getRoot(),r=e.$view;n?n&&!r.id&&(r.id=n):(r.id?n=r.id:r.id=n="webix_"+webix.uid(),webix.html.addStyle(".webix_win_inside *:not(.webix_modal_box):not(.webix_modal_cover){ z-index: 0; }"),webix.html.addStyle("#"+n+"{ position: relative; }"),webix.html.addStyle("#"+n+" .webix_window{ z-index:2 !important; }"),webix.html.addStyle("#"+n+" .webix_disabled{ z-index:1 !important; }")),t.container=n,t.fullscreen&&(t._fillApp=!0,delete t.fullscreen),t.on||(t.on={});var a=!0,s=t.on.onShow;return t.on.onShow=function(){var t=this;s&&s.apply(this,arguments),a&&(this.$setSize=function(i,r){j(t,e,!0),webix.ui.window.prototype.$setSize.apply(t,[i,r])},V(this,i),a=null),webix.callEvent("onClick",[]),webix.html.addCss(r,"webix_win_inside"),e.disable(),j(this,e)},t}},(i=s).setService("jet-win",a),s.use(M,s.config.locale||{lang:"en",webix:{en:"en-US"}}),s}return i(e,t),e.prototype.require=function(t,e){return"jet-views"===t?ft[e]:"jet-locales"===t?ue[e]:null},e.prototype.getState=function(){return this.config.params.state},e}(y);webix.protoUI({name:"gantt",app:le,getState:function(){return this.$app.getState()},getService:function(t){return this.$app.getService(t)},$init:function(){var t=this,e=this.$app.getState();for(var i in e)F(e,this.config,i);this.$app.attachEvent("bars:beforedrag",(function(e,i){return t.callEvent("onBeforeDrag",[e,i])})),this.$app.attachEvent("bars:beforedrop",(function(e,i){return t.callEvent("onBeforeDrop",[e,i])}))},$exportView:function(t){return"png"===t.export_mode||"pdf"===t.export_mode&&"image"===t.display?this.$app.getRoot():this.$app.getService("local").tasks()},clearAll:function(){this.$app.getService("local").clearAll()},reload:function(){this.$app.getService("local").reload()}},webix.ui.jetapp);var ce={Local:gt,Backend:vt,Operations:mt,Helpers:ne,Grouping:ae},ue={en:{Edit:"Edit",Done:"Done","Delete task":"Delete task","Delete link":"Delete link","The task will be deleted permanently, are you sure?":"The task will be deleted permanently, are you sure?","The link will be deleted permanently, are you sure?":"The link will be deleted permanently, are you sure?",Predecessors:"Predecessors",Successors:"Successors",Title:"Title","Start date":"Start date","End date":"End date",Duration:"Duration",Progress:"Progress",Notes:"Notes",Type:"Type",Project:"Project",Milestone:"Milestone","Add task":"Add task","Add project":"Add project","(no title)":"(no title)","Save changes?":"Save changes?","Related tasks":"Related tasks",Task:"Task",Link:"Link","End to start":"End to start","Start to start":"Start to start","End to end":"End to end","Start to end":"Start to end",Lasts:"Lasts",day:"day",days:"days","Add assignment":"Add assignment",Assignment:"Assignment",Assignments:"Assignments",Assigned:"Assigned","Delete assignment":"Delete assignment","Are you sure to delete this assignment?":"Are you sure to delete this assignment?","No resources to add":"No resources to add",Unassigned:"Unassigned",hour:"h","Hours per":"Hours per","Tasks per":"Tasks per",Name:"Name",Hours:"Hours",Tasks:"Tasks",month:"month",week:"week",quarter:"quarter",year:"year","Split task":"Split task","Planned dates":"Planned dates","Planned dates will be removed, are you sure?":"Planned dates will be removed, are you sure?","Add dates":"Add dates","Remove dates":"Remove dates"}};t.App=le,t.locales=ue,t.services=ce,t.views=ft,Object.defineProperty(t,"__esModule",{value:!0})}));
//# sourceMappingURL=gantt.min.js.map
